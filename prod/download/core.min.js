/* Mathigon JavaScript Tools */
/* MIT License (https://github.com/Mathigon/core.js/blob/master/LICENSE) */

!function(){{var M={core:!0},_arrayPush=Array.prototype.push,_arraySlice=Array.prototype.slice,_arrayShift=Array.prototype.shift;Array.prototype.join}"object"==typeof module&&"object"==typeof module.exports?(module.exports=M,global.M=M):"function"==typeof define&&define.amd?define(M):window.M=M,M.noop=function(){},M.trueop=function(){return!0},M.run=function(obj,args,_this){return obj instanceof Function?obj.apply(_this||null,args):obj},M.isOneOf=function(x){for(var i=1;i<arguments.length;++i)if(x===arguments[i])return!0;return!1},function(){function makePrototype(obj,name,fn){Object.defineProperty(obj,name,{enumerable:!1,writable:!0,value:fn})}M.object={},M.has=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},M.object.keys=Object.keys||function(obj){var keys=[];for(var key in obj)M.has(obj,key)&&keys.push(key);return keys},M.object.invert=function(obj){for(var result={},keys=M.keys(obj),i=0,l=keys.length;l>i;++i)result[obj[keys[i]]]=keys[i];return result},M.object.create=Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}(),M.each=function(collection,fn){var result,i,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1))for(result=[],i=0;l>i;++i)M.has(collection,i)&&result.push(fn(collection[i],i));else{result={};for(i in collection)M.has(collection,i)&&(result[i]=fn(collection[i],i))}return result},M.some=function(collection,fn){var i,x,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1)){for(i=0;l>i;++i)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x}else for(i in collection)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x},M.extend=function(obj,properties,nonEnumerable){for(var p in properties)M.has(properties,p)&&(void 0===properties[p]?delete obj[p]:nonEnumerable?makePrototype(obj,p,properties[p]):obj[p]=properties[p])},M.merge=function(){for(var result={},i=0;i<arguments.length;++i)M.each(arguments[i],function(value,property){result[property]=value});return result},M.watch=function(obj,prop,handler){var value=obj[prop],getter=function(){return value},setter=function(newVal){var oldVal=value;return value=newVal,newVal=handler.call(this,newVal,oldVal)};delete obj[prop]&&Object.defineProperty(obj,prop,{get:getter,set:setter,enumerable:!0,configurable:!0})},M.unwatch=function(obj,prop){var val=obj[prop];delete obj[prop],obj[prop]=val}}(),function(){var typeCache={},typeRegexp=/\s([a-zA-Z]+)/;M.typeof=function(obj){if(null==obj)return""+obj;if(M.isNaN(obj))return"nan";var type=toString.call(obj);return typeCache[type]||(typeCache[type]=type.match(typeRegexp)[1].toLowerCase())},M.isType=function(x,type){return M.typeof(x)===type},M.isString=function(x){return x instanceof String||"string"==typeof x},M.isArray=Array.isArray||function(x){return"[object Array]"===Object.prototype.toString.call(x)},M.isNumber=function(x){return x instanceof Number||"number"==typeof x},M.isInteger=function(x){return x%1===0},M.isDate=function(x){return"[object Date]"===Object.prototype.toString.call(x)},M.isNaN=function(x){return x!==x},M.isFunction=function(x){return x instanceof Function},M.isBoolean=function(x){return x instanceof Boolean||"boolean"==typeof x},M.isObject=function(x){return x===Object(x)}}(),function(){function deepCopyStoreLookup(obj){for(var i=0;i<deepCopyStore.length;++i)if(deepCopyStore[i][0]===obj)return deepCopyStore[i][1];return null}function deepCopyHelper(obj){var type=typeof obj;if(null==obj||M.isOneOf(type,"number","string","boolean"))return obj;if(obj instanceof Number)return new Number(obj.valueOf());if(obj instanceof String)return new String(obj.valueOf());if(obj instanceof Boolean)return new Boolean(obj.valueOf());if(obj instanceof Date)return new Date(obj.valueOf());if(obj instanceof RegExp)return new RegExp(obj);var x=deepCopyStoreLookup(obj);if(x)return x;var copy=obj;if(M.isArray(obj)){copy=[],deepCopyStore.push([obj,copy]);for(var i=0,l=obj.length;l>i;++i)copy[i]=deepCopyHelper(obj[i])}else if(obj instanceof Object){copy={},deepCopyStore.push([obj,copy]);for(var attr in obj)M.has(obj,attr)&&(copy[attr]=deepCopyHelper(obj[attr]))}return copy}M.shallowCopy=function(obj){var type=typeof obj;return null==obj||M.isOneOf(type,"number","string","boolean")?obj:obj instanceof Number?new Number(obj.valueOf()):obj instanceof String?new String(obj.valueOf()):obj instanceof Boolean?new Boolean(obj.valueOf()):obj instanceof Date?new Date(obj.valueOf()):obj instanceof RegExp?new RegExp(obj):M.each(obj,function(val){return val})};var deepCopyStore=[];M.deepCopy=function(obj){deepCopyStore=[];var copy=deepCopyHelper(obj);return deepCopyStore=[],copy},M.shallowEquals=function(){},M.deepEquals=function(){}}(),function(){M.inherit=function(ChildClass,ParentClass){ChildClass.prototype=new ParentClass,ChildClass.prototype.constructor=this},M.Class=function(){this._events={}},M.extend(M.Class.prototype,{on:function(event,fn){this._events[event]?this._events[event].has(fn)||this._events[event].push(fn):this._events[event]=[fn]},off:function(event,fn){if(this._events[event]){var index=this._events[event].indexOf(fn);index>=0&&this._events.splice(index,1)}},trigger:function(event,args){if(this._events[event]){var _this=this;M.each(this._events[event],function(fn){fn.call(_this,args)})}}}),M.Class.extend=function(props){var parent=this,NewClass=function(){this._events={},props.init&&props.init.apply(this,arguments)};NewClass.prototype={};for(var i in parent.prototype)NewClass.prototype[i]=parent.prototype[i];for(i in props)"init"!==i&&(NewClass.prototype[i]=props[i]);return NewClass.extend=M.Class.extend,NewClass.prototype.constructor=NewClass,NewClass.parent=parent,NewClass}}(),function(){M.extend(String.prototype,{strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(){return this.trim().replace(/\s+/g," ")},toTitleCase:function(){return this.replace(/\S+/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},words:function(){return this.strip().split(/\s+/)}},!0),String.prototype.endsWith||M.extend(String.prototype,{endsWith:function(search){var end=this.length,start=end-search.length;return this.substring(start,end)===search}},!0),String.prototype.contains||M.extend(String.prototype,{contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},!0)}(),function(){function getLength(array){return array.length}function tabulateWith(fn,vals,args){if(!args.length)return M.run(fn,vals);for(var newArgs=_arraySlice.call(args,0),x=newArgs.shift(),result=[],i=0;x>i;++i)result.push(tabulateWith(fn,vals.concat([i]),newArgs));return result}M.tabulate=function(fn){var indices=M.toArray(arguments);return _arrayShift.call(indices),tabulateWith(fn,[],indices)},M.list=function(a,b,step){step||(step=1);var i,arr=[];if(null==b&&a>=0)for(i=0;a>i;i+=step)arr.push(i);else if(null==b)for(i=0;i>a;i-=step)arr.push(i);else if(b>=a)for(i=a;b>=i;i+=step)arr.push(i);else for(i=a;i>=b;i-=step)arr.push(i);return arr};var unsliceable=["undefined","null","number","boolean","string","function"];M.toArray=function(obj){return unsliceable.has(M.typeof(obj))?[obj]:Array.prototype.slice.call(obj,0)},M.map=function(fn){var arrays=M.toArray(arguments);_arrayShift.call(arrays);var maxLength=Math.max.apply(Math,M.each(arrays,getLength));return M.tabulate(function(i){return fn.apply(null,M.each(arrays,function(x){return x[i]}))},maxLength)},M.extend(Array.prototype,{each:function(fn,reverse){var i,x=[],n=this.length;if(reverse)for(i=n-1;i>=0;--i)M.has(this,i)&&(x[i]=fn(this[i],i));else for(i=0;n>i;++i)M.has(this,i)&&(x[i]=fn(this[i],i));return x},has:function(x){return-1!==this.indexOf(x)},total:function(){for(var total=0,n=this.length,i=0;n>i;++i)total+=+this[i]||0;return total},first:function(){return this[0]},last:function(){return this[this.length-1]},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},range:function(){return[this.min(),this.max()]},clean:function(){for(var b=[],n=this.length,i=0;n>i;++i)null!=this[i]&&b.push(this[i]);return b},unique:function(){for(var b=[],n=this.length,i=0;n>i;++i)-1===b.indexOf(this[i])&&b.push(this[i]);return b},without:function(x){for(var b=[],n=this.length,i=0;n>i;++i)this[i]!==x&&b.push(this[i]);return b},chunk:function(n){for(var chunks=[],lastChunk=[],count=0,l=this.length,i=0;l>i;++i)lastChunk.push(this[i]),++count,count>=n&&(chunks.push(lastChunk),lastChunk=[],count=0);return lastChunk.length&&_arrayPush.call(chunks,lastChunk),chunks},rotate:function(offset){var n=this.length;offset=(offset%n+n)%n;var start=this.slice(0,offset),end=this.slice(offset);return _arrayPush.apply(end,start),end},flatten:function(){for(var flat=_arraySlice.call(this,0);M.isArray(flat[0]);){for(var next=[],i=0,n=flat.length;n>i;++i)next=next.concat.apply(next,flat[i]);flat=next}return flat},sortBy:function(p){return this.sort(function(a,b){return a[p]-b[p]})}},!0)}(),function(){M.Queue=function(){this._toResolve=0,this._flushing=!1,this._stack=[]},M.Queue.prototype.require=function(fn){var _this=this;this._toResolve+=1,fn.call(this,function(){_this._toResolve-=1,_this._toResolve<=0&&_this.flush()})},M.Queue.prototype.unrequire=function(){},M.Queue.prototype.timeout=function(t){this.require(function(resolve){setTimeout(function(){resolve()},t)})},M.Queue.prototype.untimeout=function(){},M.Queue.prototype.flush=function(){if(!this._flushing){this._flushing=!0;for(var i=0;i<this._stack.length;++i)this._stack[i]();this._stack=[],this._flushing=!1}},M.Queue.prototype.wait=function(fn){this._flushing||this._toResolve<=0?fn():this._stack.push(fn)},M.Queue.prototype.unwait=function(){},M.Queue.prototype.clear=function(){}}()}();