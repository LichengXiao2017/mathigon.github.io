/* Mathigon JavaScript Tools */
/* MIT License (https://github.com/Mathigon/core.js/blob/master/LICENSE) */

!function(){{var M={core:!0},_arrayPush=Array.prototype.push,_arraySlice=Array.prototype.slice,_arrayShift=Array.prototype.shift;Array.prototype.join}"object"==typeof module&&"object"==typeof module.exports?(module.exports=M,global.M=M):"function"==typeof define&&define.amd?define(M):window.M=M,M.noop=function(){},M.trueop=function(){return!0},M.run=function(obj,args,_this){return obj instanceof Function?obj.apply(_this||null,args):obj},M.isOneOf=function(x){for(var i=1;i<arguments.length;++i)if(x===arguments[i])return!0;return!1},function(){function makePrototype(obj,name,fn){Object.defineProperty(obj,name,{enumerable:!1,writable:!0,value:fn})}M.object={},M.has=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},M.object.keys=Object.keys||function(obj){var keys=[];for(var key in obj)M.has(obj,key)&&keys.push(key);return keys},M.object.invert=function(obj){for(var result={},keys=M.keys(obj),i=0,l=keys.length;l>i;++i)result[obj[keys[i]]]=keys[i];return result},M.object.create=Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}(),M.each=function(collection,fn){var result,i,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1))for(result=[],i=0;l>i;++i)M.has(collection,i)&&result.push(fn(collection[i],i));else{result={};for(i in collection)M.has(collection,i)&&(result[i]=fn(collection[i],i))}return result},M.some=function(collection,fn){var i,x,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1)){for(i=0;l>i;++i)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x}else for(i in collection)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x},M.extend=function(obj,properties,nonEnumerable){for(var p in properties)M.has(properties,p)&&(void 0===properties[p]?delete obj[p]:nonEnumerable?makePrototype(obj,p,properties[p]):obj[p]=properties[p])},M.merge=function(){for(var result={},i=0;i<arguments.length;++i)M.each(arguments[i],function(value,property){result[property]=value});return result},M.watch=function(obj,prop,handler){var value=obj[prop],getter=function(){return value},setter=function(newVal){var oldVal=value;return value=newVal,newVal=handler.call(this,newVal,oldVal)};delete obj[prop]&&Object.defineProperty(obj,prop,{get:getter,set:setter,enumerable:!0,configurable:!0})},M.unwatch=function(obj,prop){var val=obj[prop];delete obj[prop],obj[prop]=val}}(),function(){var typeCache={},typeRegexp=/\s([a-zA-Z]+)/;M.typeof=function(obj){if(null==obj)return""+obj;if(M.isNaN(obj))return"nan";var type=toString.call(obj);return typeCache[type]||(typeCache[type]=type.match(typeRegexp)[1].toLowerCase())},M.isType=function(x,type){return M.typeof(x)===type},M.isString=function(x){return x instanceof String||"string"==typeof x},M.isArray=Array.isArray||function(x){return"[object Array]"===Object.prototype.toString.call(x)},M.isNumber=function(x){return x instanceof Number||"number"==typeof x},M.isInteger=function(x){return x%1===0},M.isDate=function(x){return"[object Date]"===Object.prototype.toString.call(x)},M.isNaN=function(x){return x!==x},M.isFunction=function(x){return x instanceof Function},M.isBoolean=function(x){return x instanceof Boolean||"boolean"==typeof x},M.isObject=function(x){return x===Object(x)}}(),function(){function deepCopyStoreLookup(obj){for(var i=0;i<deepCopyStore.length;++i)if(deepCopyStore[i][0]===obj)return deepCopyStore[i][1];return null}function deepCopyHelper(obj){var type=typeof obj;if(null==obj||M.isOneOf(type,"number","string","boolean"))return obj;if(obj instanceof Number)return new Number(obj.valueOf());if(obj instanceof String)return new String(obj.valueOf());if(obj instanceof Boolean)return new Boolean(obj.valueOf());if(obj instanceof Date)return new Date(obj.valueOf());if(obj instanceof RegExp)return new RegExp(obj);var x=deepCopyStoreLookup(obj);if(x)return x;var copy=obj;if(M.isArray(obj)){copy=[],deepCopyStore.push([obj,copy]);for(var i=0,l=obj.length;l>i;++i)copy[i]=deepCopyHelper(obj[i])}else if(obj instanceof Object){copy={},deepCopyStore.push([obj,copy]);for(var attr in obj)M.has(obj,attr)&&(copy[attr]=deepCopyHelper(obj[attr]))}return copy}M.shallowCopy=function(obj){var type=typeof obj;return null==obj||M.isOneOf(type,"number","string","boolean")?obj:obj instanceof Number?new Number(obj.valueOf()):obj instanceof String?new String(obj.valueOf()):obj instanceof Boolean?new Boolean(obj.valueOf()):obj instanceof Date?new Date(obj.valueOf()):obj instanceof RegExp?new RegExp(obj):M.each(obj,function(val){return val})};var deepCopyStore=[];M.deepCopy=function(obj){deepCopyStore=[];var copy=deepCopyHelper(obj);return deepCopyStore=[],copy},M.shallowEquals=function(){},M.deepEquals=function(){}}(),function(){M.inherit=function(ChildClass,ParentClass){ChildClass.prototype=new ParentClass,ChildClass.prototype.constructor=this},M.Class=function(){this._events={}},M.extend(M.Class.prototype,{on:function(event,fn){this._events[event]?this._events[event].has(fn)||this._events[event].push(fn):this._events[event]=[fn]},off:function(event,fn){if(this._events[event]){var index=this._events[event].indexOf(fn);index>=0&&this._events.splice(index,1)}},trigger:function(event,args){if(this._events[event]){var _this=this;M.each(this._events[event],function(fn){fn.call(_this,args)})}}}),M.Class.extend=function(props){var parent=this,NewClass=function(){this._events={},props.init&&props.init.apply(this,arguments)};NewClass.prototype={};for(var i in parent.prototype)NewClass.prototype[i]=parent.prototype[i];for(i in props)"init"!==i&&(NewClass.prototype[i]=props[i]);return NewClass.extend=M.Class.extend,NewClass.prototype.constructor=NewClass,NewClass.parent=parent,NewClass}}(),function(){M.extend(String.prototype,{strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(){return this.trim().replace(/\s+/g," ")},toTitleCase:function(){return this.replace(/\S+/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},words:function(){return this.strip().split(/\s+/)}},!0),String.prototype.endsWith||M.extend(String.prototype,{endsWith:function(search){var end=this.length,start=end-search.length;return this.substring(start,end)===search}},!0),String.prototype.contains||M.extend(String.prototype,{contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},!0)}(),function(){function getLength(array){return array.length}function tabulateWith(fn,vals,args){if(!args.length)return M.run(fn,vals);for(var newArgs=_arraySlice.call(args,0),x=newArgs.shift(),result=[],i=0;x>i;++i)result.push(tabulateWith(fn,vals.concat([i]),newArgs));return result}M.tabulate=function(fn){var indices=M.toArray(arguments);return _arrayShift.call(indices),tabulateWith(fn,[],indices)},M.list=function(a,b,step){step||(step=1);var i,arr=[];if(null==b&&a>=0)for(i=0;a>i;i+=step)arr.push(i);else if(null==b)for(i=0;i>a;i-=step)arr.push(i);else if(b>=a)for(i=a;b>=i;i+=step)arr.push(i);else for(i=a;i>=b;i-=step)arr.push(i);return arr};var unsliceable=["undefined","null","number","boolean","string","function"];M.toArray=function(obj){return unsliceable.has(M.typeof(obj))?[obj]:Array.prototype.slice.call(obj,0)},M.map=function(fn){var arrays=M.toArray(arguments);_arrayShift.call(arrays);var maxLength=Math.max.apply(Math,M.each(arrays,getLength));return M.tabulate(function(i){return fn.apply(null,M.each(arrays,function(x){return x[i]}))},maxLength)},M.extend(Array.prototype,{each:function(fn,reverse){var i,x=[],n=this.length;if(reverse)for(i=n-1;i>=0;--i)M.has(this,i)&&(x[i]=fn(this[i],i));else for(i=0;n>i;++i)M.has(this,i)&&(x[i]=fn(this[i],i));return x},has:function(x){return-1!==this.indexOf(x)},total:function(){for(var total=0,n=this.length,i=0;n>i;++i)total+=+this[i]||0;return total},first:function(){return this[0]},last:function(){return this[this.length-1]},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},range:function(){return[this.min(),this.max()]},clean:function(){for(var b=[],n=this.length,i=0;n>i;++i)null!=this[i]&&b.push(this[i]);return b},unique:function(){for(var b=[],n=this.length,i=0;n>i;++i)-1===b.indexOf(this[i])&&b.push(this[i]);return b},without:function(x){for(var b=[],n=this.length,i=0;n>i;++i)this[i]!==x&&b.push(this[i]);return b},chunk:function(n){for(var chunks=[],lastChunk=[],count=0,l=this.length,i=0;l>i;++i)lastChunk.push(this[i]),++count,count>=n&&(chunks.push(lastChunk),lastChunk=[],count=0);return lastChunk.length&&_arrayPush.call(chunks,lastChunk),chunks},rotate:function(offset){var n=this.length;offset=(offset%n+n)%n;var start=this.slice(0,offset),end=this.slice(offset);return _arrayPush.apply(end,start),end},flatten:function(){for(var flat=_arraySlice.call(this,0);M.isArray(flat[0]);){for(var next=[],i=0,n=flat.length;n>i;++i)next=next.concat.apply(next,flat[i]);flat=next}return flat},sortBy:function(p){return this.sort(function(a,b){return a[p]-b[p]})}},!0)}(),function(){M.Queue=function(){this._toResolve=0,this._flushing=!1,this._stack=[]},M.Queue.prototype.require=function(fn){var _this=this;this._toResolve+=1,fn.call(this,function(){_this._toResolve-=1,_this._toResolve<=0&&_this.flush()})},M.Queue.prototype.unrequire=function(){},M.Queue.prototype.timeout=function(t){this.require(function(resolve){setTimeout(function(){resolve()},t)})},M.Queue.prototype.untimeout=function(){},M.Queue.prototype.flush=function(){if(!this._flushing){this._flushing=!0;for(var i=0;i<this._stack.length;++i)this._stack[i]();this._stack=[],this._flushing=!1}},M.Queue.prototype.wait=function(fn){this._flushing||this._toResolve<=0?fn():this._stack.push(fn)},M.Queue.prototype.unwait=function(){},M.Queue.prototype.clear=function(){}}()}(),function(){function caching(fn){if(fn.memo)return fn.memo;var cache={};return fn.memo=function(){var key=_arrayJoin.call(arguments);return void 0!==cache[key]?cache[key]:cache[key]=fn.apply(this,arguments)},fn.memo}function toNumberArray(array){for(var newArray=[],i=0,n=array.length;n>i;++i)newArray.push(+array[i]);return newArray}function findInArray(array,x){for(var i=0,n=array.length;n>i;++i)if(array[i]===x)return i;return-1}function concatArrays(a1,a2){return Array.prototype.concat.apply(a1,a2)}if("object"!=typeof M||!M.core)throw new Error("fermat.js requires core.js.");M.fermat=!0;var EPS=1e-6;M.PHI=1.618033988749895,M.SQRT2=1.4142135623730951,M.setPrecision=function(eps){EPS=eps||1e-6};var _arrayJoin=Array.prototype.join,_arraySlice=(Array.prototype.push,Array.prototype.slice);!function(){M.nearlyEquals=function(x,y,tolerance){return Math.abs(x-y)<(tolerance||EPS)},M.sign=Math.sign||function(x){return x>0?1:0>x?-1:0},M.square=function(x){return x*x},M.cube=function(x){return x*x*x},M.bound=function(x,min,max){return null==max&&(max=1/0),null==min&&(min=-1/0),Math.min(max,Math.max(min,x))},M.between=function(x,a,b){return x>=a&&b>=x},M.numberFormat=function(x){x=(""+x).split(".");for(var n=x[0],rgx=/(\d+)(\d{3})/;rgx.test(n);)n=n.replace(rgx,"$1,$2");return n+(x.length>1?"."+x[1]:"")},M.toOrdinal=function(x){if(Math.abs(x)%100>=11&&Math.abs(x)%100<=13)return x+"th";switch(x%10){case 1:return x+"st";case 2:return x+"nd";case 3:return x+"rd";default:return x+"th"}},M.digits=function(n){if(0===n)return[0];for(var digits=[];n>0;)digits.push(n%10),n=Math.floor(n/10);return digits},M.fractionalDigits=function(n){var str=""+Math.abs(n-Math.floor(n));return toNumberArray(str.split(""))},M.decimalPlaces=function(n){var str=""+Math.abs(n);return str=str.split("."),1===str.length?0:str[1].length},M.round=function(n,precision){var factor=Math.pow(10,precision||0);return Math.round(n*factor)/factor},M.roundTo=function(n,increment){return increment||(increment=1),Math.round(n/increment)*increment},M.roundTowardsZero=function(x){return 0>x?Math.ceil(x-1e-5):Math.floor(x+1e-5)},M.toFraction=function(decimal,precision){precision=precision||1e-4;for(var n=[1,0],d=[0,1],a=Math.floor(decimal),rem=decimal-a;d[0]<=1/precision;){if(M.nearlyEquals(n[0]/d[0],precision))return[n[0],d[0]];n=[a*n[0]+n[1],n[0]],d=[a*d[0]+d[1],d[0]],a=Math.floor(1/rem),rem=1/rem-a}return[decimal,1]},M.add=function(){for(var sum=0,i=0;i<arguments.length;++i)sum+=+arguments[i]||0;return sum},M.mult=function(){for(var sum=0,i=0;i<arguments.length;++i)sum*=+arguments[i]||1;return sum},M.subtr=function(a,b){return a-b},M.div=function(a,b){return a/b},M.mod=function(a,m){return(a%m+a)%m},M.log=function(x,b){return M.isNumber(b)?Math.log(x)/Math.log(b):Math.log(x)},M.log10=Math.log10||function(x){return Math.log(x)/Math.log(10)},M.log2=Math.log2||function(x){return Math.log(x)/Math.log(2)},M.cosh=Math.cosh||function(x){return(Math.exp(x)+Math.exp(-x))/2},M.sinh=Math.sinh||function(x){return(Math.exp(x)-Math.exp(-x))/2}}(),function(){var smallPrimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97];M.gcd=function gcd(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return gcd(a,gcd.apply(null,rest))}var mod;for(a=Math.abs(a),b=Math.abs(b);b;)mod=a%b,a=b,b=mod;return a},M.lcm=function lcm(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return lcm(a,lcm.apply(null,rest))}return Math.abs(a*b)/M.gcd(a,b)},M.isPrime=function(n){if(1>=n||!M.isInt(n))return!1;if(101>n)return findInArray(smallPrimes,n)>=0;if(n%2===0)return!1;for(var sqrt=Math.sqrt(n),i=3;sqrt>=i;i+=2)if(n%i===0)return!1;return!0},M.isOdd=function(n){return n%2===1},M.isEven=function(n){return n%2===0},M.primeFactorization=function fact(n){if(1===n)return[];if(M.isPrime(n))return[n];for(var maxf=Math.sqrt(n),f=2;maxf>=f;++f)if(n%f===0)return concatArrays(fact(f),fact(n/f))},M.primeFactors=function(n){return M.primeFactorization(n).unique()},M.listPrimes=function(n){if(2>n)return[];for(var result=[2],i=3;n>=i;i++){var notMultiple=!1;for(var j in result)M.has(result,j)&&(notMultiple=notMultiple||0===i%result[j]);notMultiple||result.push(i)}return result}}(),function(){function getSubsets(arr){if(1===arr.length)return[[],arr];for(var last=arr.pop(),subsets=getSubsets(arr),result=[],i=0;i<subsets.length;++i){var a2=_arraySlice.call(subsets[i],0);a2.push(last),result.push(subsets[i],a2)}return result}M.factorial=caching(function(x){return 0>x?0/0:0===x?1:1>=x?x:x*M.factorial(x-1)}),M.binomial=caching(function(n,k){if(0===k)return 1;if(2*k>n)return M.binomial(n,n-k);for(var coeff=1,i=k;i>0;--i)coeff*=n-i+1,coeff/=i;return coeff}),M.permutations=function(arr){function permute(input){for(var i=0;i<input.length;i++){var term=input.splice(i,1)[0];usedChars.push(term),0===input.length&&permArr.push(usedChars.slice()),permute(input),input.splice(i,0,term),usedChars.pop()}return permArr}var permArr=[],usedChars=[];return permute(arr)},M.subsets=function(arr,length){var myArr=_arraySlice.call(arr,0),subsets=getSubsets(myArr);return length&&(subsets=subsets.filter(function(x){return x.length===length})),subsets},M.coinFlips=function(n){for(var str="",i=0;n>i;++i)str+=Math.random()>=.5?"H":"T";return str}}(),function(){M.random={},M.random.integer=function(a,b){return(null==b?0:a)+Math.floor((null==b?a:b-a+1)*Math.random())},M.random.integerArray=function(n){for(var a=[],i=0;n>i;++i)a.push(i);return M.shuffle(a)},M.random.weighted=function(obj,setTotal){var total=0;null==setTotal?M.each(obj,function(x){total+=+x}):total=setTotal;var rand=Math.random()*total,curr=0;return M.some(obj,function(x,i){return curr+=obj[i],curr>=rand?i:void 0})},M.shuffle=function(a){a=_arraySlice.call(a,0);for(var j,tmp,i=a.length-1;i;--i)j=Math.floor(Math.random()*(i+1)),tmp=a[j],a[j]=a[i],a[i]=tmp;return a},M.random.bernoulli=function(p){return null==p&&(p=.5),p=Math.max(0,Math.min(1,p)),Math.random()<p?1:0},M.random.binomial=function(n,p){null==n&&(n=1),null==p&&(p=.5);for(var t=0,i=0;n>i;++i)t+=M.random.bernoulli(p);return t},M.random.poisson=function(l){if(null==l&&(l=1),0>=l)return 0;for(var L=Math.exp(-l),p=1,k=0;p>L;++k)p*=Math.random();return k-1},M.random.uniform=function(a,b){return null==a&&(a=0),null==b&&(b=1),a+(b-a)*Math.random()},M.random.normal=function(m,v){null==m&&(m=0),null==v&&(v=1);var u1=Math.random(),u2=Math.random(),rand=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);return rand*Math.sqrt(v)+m},M.random.exponential=function(l){return null==l&&(l=1),0>=l?0:-Math.log(Math.random())/l},M.random.geometric=function(p){return null==p&&(p=.5),0>=p||p>1?null:Math.floor(Math.log(Math.random())/Math.log(1-p))},M.random.cauchy=function(){var rr,v1,v2;do v1=2*Math.random()-1,v2=2*Math.random()-1,rr=v1*v1+v2*v2;while(rr>=1);return v1/v2},M.normalPDF=function(x,m,v){return Math.exp(-M.square(x-m)/(2*v))/Math.sqrt(2*Math.PI*v)}}(),function(){M.mean=M.average=function(a){return a.length?M.total(a)/a.length:0},M.median=function(values){var n=values.length;if(!n)return 0;var sorted=values.slice(0).sort();return n%2===1?sorted[Math.floor(n/2)]:(sorted[n/2-1]+sorted[n/2])/2},M.mode=function(values){for(var mode,numInstances=[],modeInstances=-1,i=0;i<values.length;i++)numInstances[values[i]]?(numInstances[values[i]]+=1,numInstances[values[i]]>modeInstances&&(modeInstances=numInstances[values[i]],mode=values[i])):numInstances[values[i]]=1;for(i=0;i<numInstances.length;i++)if(numInstances[i]&&i!==mode&&numInstances[i]>=modeInstances)return null;return mode},M.variance=function(values){var n=values.length;if(!n)return 0;for(var mean=M.mean(values),sum=0,i=0;n>i;++i)sum+=M.square(values[i]-mean);return sum/(n-1)},M.stdDev=function(values){return Math.sqrt(M.variance(values))},M.covariance=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");for(var n=aX.length,total=0,i=0;n>i;i++)total+=aX[i]*aY[i];return(total-aX.total()*aY.total()/n)/n},M.correlation=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");var covarXY=M.covariance(aX,aY),stdDevX=aX.standardDev(),stdDevY=aY.standardDev();return covarXY/(stdDevX*stdDevY)},M.rSquared=function(source,regression){var residualSumOfSquares=source.each(function(d,i){return M.square(d-regression[i])}).sum(),totalSumOfSquares=source.each(function(d){return M.square(d-source.average())}).sum();return 1-residualSumOfSquares/totalSumOfSquares},M.linearRegression=function(aX,aY){var n=aX.length,sumX=aX.sum(),sumY=aY.sum(),sumXY=aX.each(function(d,i){return d*aY[i]}).sum(),sumXSquared=aX.each(function(d){return d*d}).sum(),meanX=aX.average(),meanY=aY.average(),b=(sumXY-1/n*sumX*sumY)/(sumXSquared-1/n*sumX*sumX),a=meanY-b*meanX;return function(x){return a+b*x}}}(),function(){M.Complex=function(re,im){this.re=re||0,this.im=im||0},M.extend(M.Complex.prototype,{toString:function(){return this.real?this.imaginary?this.real+" + "+this.imaginary+"i":this.real:this.imaginary+"i"},magnitude:function(){return Math.sqrt(this.re*this.re+this.im*this.im)},phase:function(){return Math.atan2(this.im,this.re)},conjugate:function(){return new M.complex(this.re,-this.im)}},!0),M.complex={},M.complex.add=function(c1,c2){return c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),new M.Complex(c1.re+c2.re,c1.im+c2.im)},M.complex.subtr=function(c1,c2){return c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),new M.Complex(c1.re-c2.re,c1.im-c2.im)},M.complex.mult=function(c1,c2){c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0));var re=c1.re*c2.re-c1.im*c2.im,im=c1.im*c2.re+c1.re*c2.im;return new M.complex(re,im)},M.complex.div=function(c1,c2){if(c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),Math.abs(c2.re)<EPS&&Math.abs(c2.im)<EPS)return new M.Complex(1/0,1/0);var denominator=c2.re*c2.re+c2.im*c2.im,re=(c1.re*c2.re+c1.im*c2.im)/denominator,im=(c1.im*c2.re-c1.re*c2.im)/denominator;return new M.Complex(re,im)}}(),function(){var setPrototype=Object.setPrototypeOf||function(obj,proto){obj.__proto__=proto};M.Vector=function(a,b){var array;if(Array.isArray(a))array=a.slice(0);else{array=[],void 0===b&&(b=null);for(var i=0;a>i;++i)array.push(b)}return setPrototype(array,M.Vector.prototype),array},M.Vector.prototype=new Array,M.extend(M.Vector.prototype,{total:function(){return M.total(this)},average:function(){return this.total()/this.length},norm:function(){for(var n=0,i=0;i<this.length;++i)n+=M.square(this[i]);return Math.sqrt(n)},normalize:function(){for(var a=[],n=this.length,total=this.norm(),i=0;n>i;++i)a.push(this[i]/total);return M.Vector(a)},toString:function(){return"("+_arrayJoin.call(this,", ")+")"}},!0),M.vector={},M.vector.dot=function(v1,v2){for(var n=Math.max(v1.length,v2.length),d=0,i=0;n>i;++i)d+=(v1[i]||0)*(v2[i]||0);return d},M.vector.cross2D=function(x,y){return x[0]*y[1]-x[1]*y[0]},M.vector.cross=function(v1,v2){return M.Vector([v1[1]*v2[2]-v1[2]*v2[1],v1[2]*v2[0]-v1[0]*v2[2],v1[0]*v2[1]-v1[1]*v2[0]])},M.vector.mult=function(v,s){return M.Vector(M.map(function(x){return x*s},v))}}(),function(){M.Matrix=function(a,b,c){if(!(this instanceof M.Matrix))return new M.Matrix(a,b,c);var isArray=M.isArray(a);this.rows=isArray?a.length:a,this.columns=isArray?Math.max.call(Math,a.map(function(x){return x.length})):null!=b?b:a;for(var i=0;i<this.rows;++i){this[i]=[];for(var j=0;j<this.columns;++j){var val=isArray?a[i][j]:c;this[i][j]=null!=val?val:null}}},M.Matrix.prototype.isSquare=function(){return this.rows===this.cols},M.Matrix.prototype.row=function(i){return new M.Vector(this[i])},M.Matrix.prototype.column=function(j){for(var c=[],i=0;i<this.rows;++i)c.push(this[i][j]);return new M.Vector(c)},M.Matrix.prototype.transpose=function(){for(var newMatrix=[],i=0;i<this.columns;++i){this[i]=[];for(var j=0;j<this.rows;++j)newMatrix[i][j]=this[j][i]}return new M.Matrix(newMatrix)},M.Matrix.prototype.determinant=function(){if(!this.isSquare())throw new Error("Not a square matrix.");var n=this.rows,det=0;if(1===n)return this[0][0];if(2===n)return this[0][0]*this[1][1]-this[0][1]*this[1][0];for(var col=0;col<this.cols;++col){for(var diagLeft=this[0][col],diagRight=this[0][col],row=1;rows>row;++row)diagRight*=this[row][M.mod(col+row,n)],diagLeft*=this[row][M.mod(col-row,n)];det+=diagRight-diagLeft}return det},M.Matrix.prototype.scalarMultiply=function(val){for(var result=[],i=0;i<this.rows;i++){result[i]=[];for(var j=0;j<this.columns;j++)result[i][j]=val*this[i][j]}return M.Matrix(result)},M.Matrix.prototype.inverse=function(){},M.matrix={},M.matrix.identity=function(){for(var x=new M.Matrix(n,n,0),i=0;n>i;++i)x[i][i]=1;return x},M.matrix.add=function(m1,m2){if(m1.rows!==m2.rows||m1.cols!==m2.cols)throw new Error("Matrix size mismatch");for(var result=[],i=0;i<m1.length;++i){result[i]=[];for(var j=0;j<m1[i].length;++j)result[i][j]=m1[i][j]+m2[i][j]}return M.Matrix(result)},M.matrix.rotation=function(){},M.matrix.shear=function(){},M.matrix.reflection=function(){},M.matrix.projection=function(){};var vMultM=function(v,m){return mMultV(m.transpose(),v)},mMultV=function(){},mMultM=function(){};M.matrix.mult=function(a,b){if(a instanceof M.Vector&&b instanceof M.Matrix)return vMultM(a,b);if(a instanceof M.Matrix&&b instanceof M.Vector)return mMultV(a,b);if(a instanceof M.Matrix&&b instanceof M.Matrix)return mMultM(a,b);throw new Error("Can't multiply two vectors; use .dot or .cross instead.")}}(),function(){M.geo={},M.geo.Point=function(x,y){this.x=this[0]=+x||0,this.y=this[1]=+y||0,this.length=2},M.geo.Line=function(p1,p2){this.p1=p1,this.p2=p2},M.geo.Curve=function(p1,p2,q1,q2){null==q1&&(q1=p1),null==q2&&(q1=p2),this.p1=p1,this.p2=p2,this.q1=q1,this.q2=q2},M.geo.Circle=function(c,r){this.c=null==r?new M.Point(0,0):c,this.r=null==r?1:r},M.geo.Rect=function(x,y,w,h){this.x=x||0,this.y=y||0,this.w=null==w?w:1,this.h=null==h?h:1},M.geo.Polygon=function(points){this.points=points};var getGeoType=function(x){return x instanceof M.geo.Point?"point":x instanceof M.geo.Line?"line":x instanceof M.geo.Circle?"circle":x instanceof M.geo.Rect?"rect":x instanceof M.geo.Polygon?"polygon":""};M.geo.angle=function(a,b,c){var phiA=Math.atan2(a.y-b.y,a.x-b.x),phiC=Math.atan2(c.y-b.y,c.x-b.x),phi=phiC-phiA;return 0>phi&&(phi+=2*Math.PI),phi},M.geo.Rect.prototype.toPolygon=function(){var a=new M.geo.Point(this.x,this.y),b=new M.geo.Point(this.x+this.w,this.y),c=new M.geo.Point(this.x+this.w,this.y+this.h),d=new M.geo.Point(this.x,this.y+this.h);return new M.geo.Polygon([a,b,c,d])},M.geo.isParallel=function(l1,l2){var x1=l1.p2.x-l1.p1.x,y1=l1.p2.y-l1.p1.y,x2=l2.p2.x-l2.p1.x,y2=l2.p2.y-l2.p1.y;return 0===x1&&0===x2||0===y1&&0===y2||M.nearlyEquals(y1/x1,y2/x2)},M.geo.Line.prototype.contains=function(p){var grad1=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),grad2=(p.y-this.p1.y)/(p-this.p1.x);return M.nearlyEquals(grad1,grad2)},M.geo.Line.prototype.normalVector=function(){var l=this.length(),x=(this.p2.x-this.p1.x)/l,y=(this.p2.y-this.p1.y)/l;return new M.Point(x,y)},M.geo.project=function(p,l){var k=M.vector.dot(M.vector.subtr(p,l.p1),l.normalVector());return new M.geo.Point(l.p1.x+k.x,l.p1.y+k.y)},M.geo.lineToPointDistance=function(p,l){return M.geo.distance(p,M.geo.project(p,l))},M.geo.Polygon.prototype.centroid=function(){},M.geo.Line.prototype.at=function(t){var x=t*this.p1.x+(1-t)*this.p2.x,y=t*this.p1.y+(1-t)*this.p2.y;return new M.geo.Point(x,y)},M.geo.Circle.prototype.at=function(){},M.geo.Rect.prototype.at=function(){},M.geo.Polygon.prototype.at=function(){},M.geo.Curve.prototype.at=function(t){var x=M.cube(1-t)*this.p1.x+3*t*(1-t)*(1-t)*this.q1.x+3*t*t*(1-t)*this.q2.x+M.cube(t)*this.p2.x,y=M.cube(1-t)*this.p1.y+3*t*(1-t)*(1-t)*this.q1.y+3*t*t*(1-t)*this.q2.y+M.cube(t)*this.p2.y;return new M.geo.Point(x,y)},M.geo.distance=function(p1,p2){return Math.sqrt(M.square(p1.x-p2.x)+M.square(p1.y-p2.y))},M.geo.manhatten=function(p1,p2){return Math.abs(p1.x-p2.x)+Math.abs(p1.y-p2.y)},M.geo.Line.prototype.length=function(){return M.geo.distance(this.p1,this.p2)},M.geo.Curve.prototype.length=function(){},M.geo.Circle.prototype.circumference=function(){return 2*Math.PI*this.r},M.geo.Rect.prototype.circumference=function(){return 2*this.w+2*this.h},M.geo.Polygon.prototype.circumference=function(){for(var C=0,p=this.points,n=p.length,i=1;n>i;++i)C+=M.geo.distance(p[i-1],p[i]);return C+=M.geo.distance(p[n-1],p[0])},M.geo.Circle.prototype.area=function(){return Math.PI*M.square(this.r)},M.geo.Rect.prototype.area=function(){return Math.abs(this.w*this.h)},M.geo.Polygon.prototype.area=function(){for(var p=this.points,n=p.length,A=p[0].x*p[n-1].y-p[n-1].x*p[0].y,i=1;n>i;++i)A+=p[i-1].x*p[i].y-p[i].x*p[i-1].y;return Math.abs(A/2)};var same={point:function(p1,p2){return M.nearlyEquals(p1.x,p2.x)&&M.nearlyEquals(p1.y,p2.y)},line:function(l1,l2,unoriented){return same.point(l1.p1,l2.p1)&&same.point(l1.p2,l2.p2)||unoriented&&same.point(l1.p1,l2.p2)&&same.point(l1.p2,l2.p1)},rect:function(){},circle:function(){},polygon:function(){}};M.geo.same=function same(a,b,unOriented){var type=getGeoType(a);if(type!==getGeoType(b))return!1;var sameFn=same[type];return sameFn?sameFn(a,b,unOriented):void 0};var scalePoint=function(p,sx,sy){return new M.geo.Point(p.x*sx,p.y*sy)};M.geo.scale=function(x,sx,sy){null==sy&&(sy=sx),x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return scalePoint(x,sx,sy);case"line":return new M.geo.Line(scalePoint(x.p1,sx,sy),scalePoint(x.p2,sx,sy));case"circle":return new M.geo.Circle(scalePoint(x.c,sx,sy),x.r*(sx+sy)/2);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return scalePoint(p,sx,sy)}))}};var reflectPoint=function(p,l){var v=l.p2.x-l.p1.x,w=l.p2.y-l.p1.y,x0=p.x-l.p1.x,y0=p.y-l.p1.y,mu=(v*y0-w*x0)/(v*v+w*w),x=p.x+2*mu*w,y=p.y-2*mu*v;return new M.geo.Point(x,y)};M.geo.reflection=function(x,l){x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return reflectPoint(x,l);case"line":return new M.geo.Line(reflectPoint(x.p1,l),reflectPoint(x.p2,l));case"circle":return new M.geo.Circle(reflectPoint(x.c,l),x.r);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return reflectPoint(p,l)}))}};var rotatePoint=function(p,c,phi){var x0=p.x-c.x,y0=p.y-c.y,cos=Math.cos(phi),sin=Math.sin(phi),x=x0*cos-y0*sin+c.x,y=x0*sin+y0*cos+c.y;return new M.geo.Point(x,y)};M.geo.rotation=function(x,c,phi){x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return rotatePoint(x,c,phi);case"line":return new M.geo.Line(rotatePoint(x.p1,c,phi),rotatePoint(x.p2,c,phi));case"circle":return new M.geo.Circle(rotatePoint(x.c,c,phi),x.r);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return rotatePoint(p,c,phi)}))}},M.geo.angleBisector=function(a,b,c){var phiA=Math.atan2(a.y-b.y,a.x-b.x),phiC=Math.atan2(c.y-b.y,c.x-b.x),phi=(phiA+phiC)/2;phiA>phiC&&(phi+=Math.PI);var x=Math.cos(phi)+b.x,y=Math.sin(phi)+b.y;return new M.geo.Point(x,y)},M.geo.perpendicular=function(l,p){var dx,dy;if(M.geo.same(p,l.p1))dx=l.p2.y-l.p1.y,dy=l.p1.x-l.p2.x;else if(M.geo.same(p===l.p2))dx=l.p1.y-l.p2.y,dy=l.p2.x-l.p1.x;else if(l.contains(p))dx=l.p1.y-p.y,dy=p.x-l.p1.x;else{var b=M.geo.project(p,l);dx=b.x,dy=b.y}return new M.geo.Line(new M.geo.Point(p.x,p.y),new M.geo.Point(p.x+dx,p.y+dy))},M.geo.sortVertices=function(){},M.geo.convexHull=function(){},M.geo.travellingSalesman=function(dist){var n=dist.length,cities=M.list(n),minLength=1/0,minPath=null;return M.permutations(cities).each(function(path){for(var length=0,i=0;n-1>i;++i)if(length+=dist[path[i]][path[i+1]],length>minLength)return;minLength>length&&(minLength=length),minPath=path}),{path:minPath,length:minLength}};var lineLineIntersect=function(l1,l2){var d1=M.map(M.subtr,l1.p2,l1.p1),d2=M.map(M.subtr,l2.p2,l2.p1),d=M.map(M.subtr,l2.p1,l1.p1),denominator=M.vector.cross2D(d2,d1);if(0!==denominator){var n1=M.vector.cross2D(d1,d),n2=M.vector.cross2D(d2,d),x=n2/denominator,y=n1/denominator;if(M.bound(x,0,1)&&M.bound(y,0,1)){var intersectionX=l1.p1.x+x*(l1.p2.x-l1.p1.x),intersectionY=l1.p1.y+y*(l1.p2.y-l1.p1.y);return[intersectionX,intersectionY]}}},lineCircleIntersect=function(){},linePolygonIntersect=function(){},rectRectIntersect=function(){},polygonPolygonIntersect=function(){};M.geo.intersect=function(x,y){if(arguments.length>2){var rest=_arraySlice.call(arguments,1);return M.geo.intersect(x,M.geo.intersect.apply(null,rest))}if(x instanceof M.geo.Rect&&y instanceof M.geo.Rect)return rectRectIntersect(x,y);switch(x instanceof M.geo.Rect&&(x=x.toPolygon()),y instanceof M.geo.Rect&&(y=y.toPolygon()),getGeoType(x)+"-"+getGeoType(y)){case"line-line":return lineLineIntersect(x,y);case"line-circle":return lineCircleIntersect(x,y);case"line-polygon":return linePolygonIntersect(x,y);case"circle-line":return lineCircleIntersect(y,x);case"polygon-line":return linePolygonIntersect(y,x);case"polygon-polygon":return polygonPolygonIntersect(x,y)}throw new Error("Can't intersect "+getGeoType(x)+"s and "+getGeoType(y)+".")}}(),function(){var LOWER_CASE="abcdefghijklmnopqrstuvwxyz",UPPER_CASE="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ENGLISH_FREQUENCY={a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00154,k:.00772,l:.04024,m:.02406,n:.06749,o:.07507,p:.01929,q:95e-5,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.0236,x:.0015,y:.01974,z:74e-5};M.caesarCypher=function(msg,shift){for(var cipher="",i=0,len=msg.length;len>i;i++)cipher+=msg[i]>="a"&&msg[i]<="z"?LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26]:msg[i]>="A"&&msg[i]<="Z"?UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26]:msg[i];return cipher},M.vigenereCypher=function(msg,key){for(var cipher="",shift=0,count=0,k=key.toLowerCase(),i=0,len=msg.length,keyLen=k.length;len>i;i++)shift=LOWER_CASE.indexOf(k[count%keyLen]),msg[i]>="a"&&msg[i]<="z"?(cipher+=LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26],count++):msg[i]>="A"&&msg[i]<="Z"?(cipher+=UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26],count++):cipher+=msg[i];return cipher},M.letterFreqency=function(letter){return ENGLISH_FREQUENCY[letter.toLowerCase()]},M.cipherLetterFreq=function(cipher){for(var msg=cipher.toLowerCase(),freq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0,len=msg.length;len>i;++i)msg[i]>="a"&&msg[i]<="z"&&freq[LOWER_CASE.indexOf(msg[i])]++;
return freq}}(),function(){M.bisect=function(fn,precision,l,h){null==precision&&(precision=3);var p=Math.pow(10,-precision),q=Math.pow(10,precision);l||(l=0);var lf=fn(l),ls=Math.sign(lf);if(0===ls)return l;var hf,hs;if(null==h){h=.5;do h*=2,hf=fn(h),hs=Math.sign(hf);while(hs===ls);if(0===hs)return h}for(var x=0;Math.abs(lf)>p&&200>x;){var c=(l+h)/2,cf=fn(c),cs=Math.sign(cf);if(0===cs)return c;cs===ls?(l=c,lf=cf):(h=c,hf=cf),++x}return Math.round(l*q)*p}}(),function(){var prefixes={da:{name:"deca",value:10},h:{name:"hecto",value:100},k:{name:"kilo",value:1e3},M:{name:"mega",value:1e6},G:{name:"giga",value:1e9},T:{name:"tera",value:1e12},P:{name:"peta",value:1e15},E:{name:"exa",value:1e18},Z:{name:"zetta",value:1e21},Y:{name:"yotta",value:1e24},d:{name:"deci",value:.1},c:{name:"centi",value:.01},m:{name:"milli",value:.001},u:{name:"micro",value:1e-6},n:{name:"nano",value:1e-9},p:{name:"pico",value:1e-12},f:{name:"femto",value:1e-15},a:{name:"atto",value:1e-18},z:{name:"zepto",value:1e-21},y:{name:"yocto",value:1e-24}},units={m:{name:"meter",type:"length",value:1},"in":{name:"inch",type:"length",value:.0254},ft:{name:"foot",type:"length",value:.3048},yd:{name:"yard",type:"length",value:.9144},mi:{name:"mile",type:"length",value:1609.344},AA:{name:"angstrom",type:"length",value:1e-10},m2:{name:"m2",type:"surface",power:2,value:1},sqin:{name:"sqin",type:"surface",power:2,value:64516e-8},sqft:{name:"sqft",type:"surface",power:2,value:.09290304},sqyd:{name:"sqyd",type:"surface",power:2,value:.83612736},sqmi:{name:"sqmi",type:"surface",power:2,value:2589988.110336},m3:{name:"m3",type:"volume",value:1},l:{name:"litre",type:"volume",value:.001},cup:{name:"cup",type:"volume",value:.0002365882},pint:{name:"pint",type:"volume",value:.0004731765},quart:{name:"quart",type:"volume",value:.0009463529},gallon:{name:"gallon",type:"volume",value:.003785412},barrel:{name:"barrel",type:"volume",value:.1589873},g:{name:"gram",type:"mass",value:.001},ton:{name:"ton",type:"mass",value:907.18474},oz:{name:"ounce",type:"mass",value:.028349523125},lbm:{name:"pound",type:"mass",value:.45359237},s:{name:"second",type:"time",value:1},min:{name:"minute",type:"time",value:60},h:{name:"hour",type:"time",value:3600},d:{name:"day",type:"time",value:86400},w:{name:"week",type:"time",value:604800},mon:{name:"month",type:"time",value:2629740},y:{name:"year",type:"time",value:31556900},rad:{name:"rad",type:"angle",value:1},deg:{name:"deg",type:"angle",value:.017453292519943295},grad:{name:"grad",type:"angle",value:.015707963267948967},cyc:{name:"cycle",type:"angle",value:6.283185307179586},A:{name:"ampere",type:"current",value:1},K:{name:"kelvin",type:"temperature",value:1},degC:{name:"celsius",type:"temperature",value:1,offset:273.15},degF:{name:"fahrenheit",type:"temperature",value:1/1.8,offset:459.67},mol:{name:"mole",type:"substance",value:1},N:{name:"newton",type:"force",value:1},lbf:{name:"poundforce",type:"force",value:4.4482216152605},b:{name:"bits",type:"data",value:1},B:{name:"bytes",type:"data",value:8}};M.unit={};var prefixRegexp=M.object.keys(prefixes).join("|"),unitRegexp=M.object.keys(units).join("|"),regexp=new RegExp("^("+prefixRegexp+")?("+unitRegexp+")$");M.unit.to=function(val,from,to){var f=from.match(regexp),prefix=f[1],unit=f[2],prefixValue=prefix?prefixes[prefix].value||0:1,unitValue=units[unit].value||1,unitOffset=units[unit].offset||0,newVal=(val*unitValue+unitOffset)*prefixValue;return null==to?newVal:(f=to.match(regexp),prefix=f[1],unit=f[2],prefixValue=prefix?prefixes[prefix].value||0:1,unitValue=units[unit].value||1,unitOffset=units[unit].offset||0,(newVal/prefixValue-unitOffset)/unitValue)},M.unit.define=function(unit){unit=unit.match(regexp);var prefix=unit[1]?prefixes[unit[1]].name:"",name=units[unit[2]].name;return prefix+name}}(),function(){function bracketsMatch(a,b){return brackets[a]===b||brackets[b]===a}function ExpressionParser(){this.current="",this.result=[],this.currentParser=null,this.currentBracket=null,this.currentFn=null}function ExpressionFn(fn,args){this.fn=fn,this.args=args}function ExpressionVal(val){this.val=val}var brackets={"(":")","[":"]","{":"}","|":"|"};ExpressionParser.prototype.send=function(x){if('"'===this.currentBracket&&'"'!==x)this.current+=x;else if(this.currentBracket||'"'!==x)if('"'===this.currentBracket&&'"'===x)this.result.push(new Expression('"',[this.current]));else{if("@&\\?<>=~`±§".contains(x))throw new Error('Unexpected "'+x+'".');if(this.currentParser)if(")]}|".contains(x)&&this.currentParser.isReady()){if(!bracketsMatch(x,this.currentBracket))throw new Error('Unexpected "'+x+'".');var completed=this.currentParser.complete();if(this.currentFn)this.result.push(new ExpressionFn(this.currentFn,completed));else if("]"===x)this.result.push(new ExpressionFn("[]",completed));else if("|"===x)this.result.push(new ExpressionFn("abs",completed));else{if(1!==completed.length)throw new Error('Unexpected ",".');this.result.push(new ExpressionVal(completed[0]))}this.current="",this.currentBracket=this.currentParser=this.currentFn=null}else this.currentParser.send(x);else"([{|".contains(x)?("("===x&&isNaN(+this.current)&&!"+-*/!^%,".contains(this.current)?(this.currentFn=this.current,this.current=""):this.pushCurrent(),this.currentParser=new ExpressionParser,this.currentBracket=x):"+-*/!^%,".contains(x)?(this.pushCurrent(),","!==x&&this.result.push(x)):x.match(/\s\n\t/)?this.pushCurrent():this.current+=x.trim()}else this.pushCurrent(),this.currentBracket='"'},ExpressionParser.prototype.isReady=function(){return null==this.currentParser},ExpressionParser.prototype.pushCurrent=function(){if(this.current){var num=+this.current;this.result.push(new ExpressionVal(num===num?num:this.current)),this.current=""}},ExpressionParser.prototype.complete=function(){this.pushCurrent();var i;for(i=0;i<this.result.length;++i)"!"===this.result[i]?(this.result.splice(i-1,2,new ExpressionFn("!",[this.result[i-1]])),i-=1):"%"===this.result[i]&&(this.result.splice(i-1,2,new ExpressionFn("/",[this.result[i-1],100])),i-=1);for(i=0;i<this.result.length;++i)"^"===this.result[i]&&(this.result.splice(i-1,3,new ExpressionFn("^",[this.result[i-1],this.result[i+1]])),i-=2);for("-"===this.result[0]&&this.result.splice(0,2,new ExpressionFn("-",[this.result[1]])),i=0;i<this.result.length;++i)"/"===this.result[i]?(this.result.splice(i-1,3,new ExpressionFn("/",[this.result[i-1],this.result[i+1]])),i-=2):"*"===this.result[i]&&(this.result.splice(i-1,3,new ExpressionFn("*",[this.result[i-1],this.result[i+1]])),i-=2);for(i=0;i<this.result.length;++i)"-"===this.result[i]?(this.result.splice(i-1,3,new ExpressionFn("-",[this.result[i-1],this.result[i+1]])),i-=2):"+"===this.result[i]&&(this.result.splice(i-1,3,new ExpressionFn("+",[this.result[i-1],this.result[i+1]])),i-=2);return this.result},ExpressionFn.prototype.simplify=function(){return this},ExpressionFn.prototype.toString=function(){for(var newArgs=[],i=0;i<this.args.length;++i)newArgs.push(this.args[i].toString());var fn=strings[this.fn];return fn?fn.apply(null,newArgs):this.fn+"("+this.args.join(", ")+")"},ExpressionFn.prototype.evaluate=function(vars){null==vars&&(vars={});for(var newArgs=[],i=0;i<this.args.length;++i){var newArg=this.args[i].evaluate();if(newArg instanceof Expression)return this;newArgs.push(newArg)}var fn=vars[this.fn]||functions[this.fn]||Math[this.fn]||M[this.fn];return fn instanceof Function?fn.apply(null,newArgs):this},ExpressionVal.prototype.simplify=function(){return this},ExpressionVal.prototype.toString=function(){return this.val.toString()},ExpressionVal.prototype.evaluate=function(vars){return null==vars&&(vars={}),void 0===vars[this.val]?this.val:vars[this.val]};var functions={"+":function(a,b){return a+b},"-":function(a,b){return void 0===b?-a:a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"!":function(n){return M.factorial(n)},"^":function(a,b){return Math.pow(a,b)},"[]":function(){return arguments},'"':function(str){return""+str},mod:function(a,b){return M.mod(a,b)}},strings={"+":function(){return M.toArray(arguments).join(" + ")},"-":function(a,b){return void 0===b?"-"+a:a+" - "+b},"*":function(){return M.toArray(arguments).join(" * ")},"/":function(a,b){return a+" / "+b},"!":function(n){return n+"!"},"^":function(a,b){return a+" ^ "+b},"[]":function(){return"["+M.toArray(arguments).join(", ")+"]"},'"':function(str){return'"'+str+'"'},mod:function(a,b){return a+" mod "+b}};M.expression={},M.expression.parse=function(str){for(var parser=new ExpressionParser,n=str.length,i=0;n>i;++i)parser.send(str[i]);return parser.complete()[0].simplify()}}()}();