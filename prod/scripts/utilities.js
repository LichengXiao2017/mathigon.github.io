// (c) 2014, Mathigon

function $(selector){if("string"==typeof selector){var $el=document.getElementById(selector);if($el)return new M.$($el)}else if(selector instanceof Node||selector===window)return new M.$(selector)}function $C(selector,context){context=context?context.$el:document;var $els=context.getElementsByClassName(selector);return M.each($els,function($el){return new M.$($el)})}function $T(selector,context){context=context?context.$el||context:document;var $els=context.getElementsByTagName(selector);window.X=$els;var t=M.each($els,function($el){return new M.$($el)});return window.Y=t,t}function $$(selector,context){context=context?context.$el:document;var $els=context.querySelectorAll(selector);return M.each($els,function($el){return new M.$($el)})}function $N(tag,attributes,parent){var t=document.createElement(tag);for(var a in attributes)"id"===a?t.id=attributes.id:"class"===a?t.className=attributes.class:"html"===a?t.innerHTML=attributes.html:t.setAttribute(a,attributes[a]);var $el=new M.$(t);return parent&&parent.append($el),$el}function $$N(html){var tempDiv=$N("div",{html:html});return tempDiv.children()}var M=M||{};M.noop=function(){},M.proto=function(obj,name,fn,enumerable){Object.defineProperty(obj.prototype,name,{enumerable:enumerable||!1,writable:!0,value:fn})},M.each=function(collection,fn){var result,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1)){result=[];for(var i=0;l>i;++i)collection.hasOwnProperty(i)&&result.push(fn(collection[i],i))}else{result={};for(var i in collection)collection.hasOwnProperty(i)&&(result[i]=fn(collection[i],i))}return result},M.include=function(object,prototypes,enumerable){prototypes instanceof Object&&M.each(prototypes,function(val,key){M.proto(object,key,val,enumerable)})},M.extend=function(dest){for(var j=1,l=arguments.length;l>j;j++)for(var i in arguments[j])dest[i]=arguments[j][i];return dest},M.inherit=function(ChildClass,ParentClass){ChildClass.prototype=new ParentClass,ChildClass.prototype.constructor=this},M.run=function(obj,args,_this){return obj instanceof Function?obj.apply(_this||null,args):obj},M.merge=function(){for(var result={},i=0;i<arguments.length;++i)M.each(arguments[i],function(value,property){result[property]=value});return result},M.Class=function(){this._events={}},M.include(M.Class,{on:function(event,fn){this._events[event]?this._events[event].indexOf(fn)<0&&this._events[event].push(fn):this._events[event]=[fn]},off:function(event,fn){if(this._events[event]){var index=this._events[event].indexOf(fn);index>=0&&this._events.splice(index,1)}},trigger:function(event,args){if(this._events[event]){var _this=this;M.each(this._events[event],function(fn){fn.call(_this,args)})}},include:function(props){M.include(this,props)}},!0),M.Class.extend=function(props){var parent=this,NewClass=function(){this._events={},props.init&&props.init.apply(this,arguments)};NewClass.prototype={};for(var i in parent.prototype)NewClass.prototype[i]=parent.prototype[i];for(i in props)"init"!==i&&(NewClass.prototype[i]=props[i]);return NewClass.extend=M.Class.extend,NewClass.prototype.constructor=NewClass,NewClass.parent=parent,NewClass},M.isArray=function(arr){return"[object Array]"===Object.prototype.toString.call(arr)},M.include(Array,{clone:function(){return this.slice(0)},first:function(){return this[0]},last:function(){return this.length?this[this.length-1]:void 0},each:function(fn){for(var x=[],i=0,l=this.length;l>i;++i)this.hasOwnProperty(i)&&(x[i]=fn(this[i],i));return x},eachReverse:function(fn){for(var x=[],i=this.length-1;i>=0;--i)this.hasOwnProperty(i)&&(x[i]=fn(this[i],i));return x},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},total:function(){for(var total=0,i=0,l=this.length;l>i;++i)total+=Number(this[i])||0;return total},clean:function(){for(var a=[],i=0,l=this.length;l>i;++i)null!==this[i]&&void 0!==this[i]&&a.push(this[i]);return a},unique:function(){for(var a=[],i=0,l=this.length;l>i;++i)-1===a.indexOf(this[i])&&a.push(this[i]);return a},without:function(el){for(var a=[],i=0,l=this.length;l>i;++i)this[i]!==el&&a.push(this[i]);return a},chunk:function(n){for(var chunks=[],lastChunk=[],count=0,i=0,l=this.length;l>i;++i)lastChunk.push(this[i]),++count,count>=n&&(chunks.push(lastChunk),lastChunk=[],count=0);return lastChunk.length&&chunks.push(lastChunk),chunks},rotate:function(offset){var length=this.length;offset=(offset%length+length)%length;var start=this.slice(0,offset),end=this.slice(offset);return Array.prototype.push.apply(end,start),end},average:function(){return this.length?this.total()/this.length:0},normalise:function(){for(var a=[],total=this.total(),i=0;i<this.length;++i)a.push(this[i]/total);return a},variance:function(){for(var length=this.length,mean=this.average(),squaredArr=[],i=0,l=this.length;l>i;++i)squaredArr[i]=FM.square(this[i]-mean);return squaredArr.total()/length},standardDev:function(){return Math.sqrt(this.variance())},median:function(){var sorted=this.clone();sorted.sort(function(a,b){return a-b});var length=sorted.length,index=length/2;return index%1===0?.5*sorted[index-1]+.5*sorted[index]:sorted[Math.floor(index)]},shuffle:function(){for(var j,tmp,a=this.clone(),i=a.length-1;i;--i)j=Math.floor(Math.random()*(i+1)),tmp=a[j],a[j]=a[i],a[i]=tmp;return a},toNumbers:function(){return this.each(function(el){return+el})}}),M.list=function(start,end,step){null==end&&(end=start,start=0),step=step||1;for(var a=[],i=start;end>=i;i+=step)a.push(i);return a},M.include(String,{strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(){return this.trim().replace(/\s+/g," ")},toTitleCase:function(){return this.replace(/\S+/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},words:function(){return this.strip().split(/\s+/)}}),M.isObject=function(obj){return obj===Object(obj)},M.has=function(obj,key){return hasOwnProperty.call(obj,key)},M.keys=function(obj){if(!M.isObject(obj))return[];var keys=[];for(var key in obj)M.has(obj,key)&&keys.push(key);return keys},M.invert=function(obj){for(var result={},keys=M.keys(obj),i=0,l=keys.length;l>i;++i)result[obj[keys[i]]]=keys[i];return result},M.create=Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}(),M.isOneOf=function(x){for(var i=1;i<arguments.length;++i)if(x===arguments[i])return!0;return!1},M.watch=function(obj,prop,handler){var value=obj[prop],getter=function(){return value},setter=function(newVal){return oldVal=value,value=newVal,newVal=handler.call(this,newVal,oldVal)};delete obj[prop]&&Object.defineProperty(obj,prop,{get:getter,set:setter,enumerable:!0,configurable:!0})},M.unwatch=function(obj,prop){var val=obj[prop];delete obj[prop],obj[prop]=val},M.include(Number,{seperators:function(){for(var x=(this+"").split("."),n=x[0],rgx=/(\d+)(\d{3})/;rgx.test(n);)n=n.replace(rgx,"$1,$2");return n+(x.length>1?"."+x[1]:"")},round:function(d){var p=Math.pow(10,d);return Math.round(d*p)/p},bound:function(min,max){return Math.min(max,Math.max(min,this))},between:function(a,b){return this>=a&&b>=this}}),M.toOrdinal=function(number){if(this%100>=11&&13>=number%100)return number+"th";switch(number%10){case 1:return number+"st";case 2:return number+"nd";case 3:return number+"rd";default:return number+"th"}},M.isInteger=function(n){return n%1===0},M.isDate=function(o){return"[object Date]"===Object.prototype.toString.call(o)},M.isNaN=function(o){return o!==o},function(){function toNumberArray(array){for(var newArray=[],i=0,n=array.length;n>i;++i)newArray.push(+array[i]);return newArray}function findInArray(array,x){for(var i=0,n=array.length;n>i;++i)if(array[i]===x)return i;return-1}function concatArray(a1,a2){return Array.prototype.concat.apply(a1,a2)}var FM={};window.FM=window.Fermat=FM,function(){function tabulateWith(fn,vals,args){var result=[];if(1===args.length)for(var i=0;i<args[0];++i)result.push(fn.apply(null,vals.concat([i])));else for(var newArgs=args.clone(),myX=newArgs.pop(),i=0;myX>i;++i)result.push(tabulateWith(fn,vals.concat([i]),newArgs));return result}FM.tabulate=function(fn){var indices=[];return Array.prototype.push.apply(indices,arguments),indices.shift(),tabulateWith(fn,[],indices)}}(),FM.range=function(a,b){var arr=[];if(null==b&&a>=0)for(var i=0;a>i;++i)arr.push(i);else if(null==b)for(var i=0;i>a;--i)arr.push(i);else if(b>=a)for(var i=a;b>=i;++i)arr.push(i);else for(var i=a;i>=b;--i)arr.push(i);return arr},FM.shuffle=function(array){array=[].slice.call(array,0);for(var top=array.length;top>0;top--){var newEnd=Math.floor(Math.random()*top),tmp=array[newEnd];array[newEnd]=array[top-1],array[top-1]=tmp}return array},FM.sort=function(array){return array.slice(0).sort(function(a,b){return a-b})};var TOLERANCE=1e-9;FM.isInt=function(n){return parseFloat(n)===parseInt(n,10)&&!isNaN(n)},FM.equals=function(x,y,tol){return Math.abs(x-y)<(tol||TOLERANCE)},FM.sign=function(x){return FM.equal(x,0)?0:Math.abs(x)/x},FM.square=function(x){return x*x},FM.cube=function(x){return x*x*x},FM.digits=function(n){if(0===n)return[0];for(var digits=[];n>0;)digits.push(n%10),n=Math.floor(n/10);return digits},FM.decimalDigits=function(n){var str=""+Math.abs(n-Math.floor(n));return toNumberArray(str.split(""))},FM.decimalPlaces=function(n){var str=""+Math.abs(n);return str=str.split("."),1===str.length?0:str[1].length},FM.roundTowardsZero=function(x){return 0>x?Math.ceil(x-1e-4):Math.floor(x+1e-4)},FM.round=function(n,precision){var factor=Math.pow(10,precision||0);return Math.round(n*factor)/factor},FM.roundTo=function(n,increment){return increment||(increment=1),Math.round(n/increment)*increment},FM.toFixed=function(n,precision){var fixed=n.toFixed(precision);return FM.equals(n,+fixed)?fixed:"~ "+fixed},FM.toFraction=function(decimal,maxDenominator){maxDenominator=maxDenominator||1e3;for(var n=[1,0],d=[0,1],a=Math.floor(decimal),rem=decimal-a;d[0]<=maxDenominator;){if(FM.equal(n[0]/d[0],decimal))return[n[0],d[0]];n=[a*n[0]+n[1],n[0]],d=[a*d[0]+d[1],d[0]],a=Math.floor(1/rem),rem=1/rem-a}return[decimal,1]};var smallPrimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97];FM.gcd=function gcd(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return gcd(a,gcd.apply(null,rest))}var mod;for(a=Math.abs(a),b=Math.abs(b);b;)mod=a%b,a=b,b=mod;return a},FM.lcm=function lcm(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return lcm(a,lcm.apply(null,rest))}return Math.abs(a*b)/FM.gcd(a,b)},FM.isPrime=function(n){if(1>=n||!FM.isInt(n))return!1;if(101>n)return findInArray(smallPrimes,n)>=0;if(n%2===0)return!1;for(var sqrt=Math.sqrt(n),i=3;sqrt>=i;i+=2)if(n%i===0)return!1;return!0},FM.isOdd=function(n){return n%2===1},FM.isEven=function(n){return n%2===0},FM.primeFactorization=function fact(n){if(1===n)return[];if(FM.isPrime(n))return[n];for(var maxf=Math.sqrt(n),f=2;maxf>=f;++f)if(n%f===0)return concatArray(fact(f),fact(n/f))},FM.getFactors=function(n){return FM.primeFactorization(n).unique()},FM.listPrimes=function(n){if(2>n)return[];for(var result=[2],i=3;n>=i;i++){var notMultiple=!1;for(var j in result)M.has(result,j)&&(notMultiple=notMultiple||0===i%result[j]);notMultiple||result.push(i)}return result};var SQRT5=Math.sqrt(5);FM.fibonacci=function(n){return Math.round(Math.pow(1+SQRT5,n)-Math.pow(1-SQRT5,n))/(Math.pow(2,n)*SQRT5)},FM.random={},FM.random.integer=function(n){return Math.floor(n*Math.random())},FM.random.integerArray=function(n){for(var a=[],i=0;n>i;++i)a.push(i);return a.shuffle()},FM.random.uniformInt=function(a,b){return Math.floor(a+(b-a+1)*Math.random())},FM.random.bernoulli=function(p){return p=Math.max(0,Math.min(1,p)),Math.random()<p?1:0},FM.random.binomial=function(n,p){for(var t=0,i=0;n>i;++i)t+=FM.random.bernoulli(p);return t},FM.random.poisson=function(l){if(0>=l)return 0;for(var L=Math.exp(-l),p=1,k=0;p>L;++k)p*=Math.random();return k-1},FM.random.uniform=function(a,b){return a+(b-a)*Math.random()},FM.random.normal=function(){var u1=Math.random(),u2=Math.random();return Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2)},FM.random.exponential=function(l){return 0>=l?0:-Math.log(Math.random())/l},FM.random.geometric=function(p){return 0>=p||p>0?null:Math.floor(Math.log(Math.random())/Math.log(1-p))},FM.random.cauchy=function(){var rr,v1,v2;do v1=2*Math.random()-1,v2=2*Math.random()-1,rr=v1*v1+v2*v2;while(rr>=1);return v1/v2},FM.factorial=function factorial(x){return 1>=x?x||1:x*factorial(x-1)},FM.binomial=function binomial(n,k){if(0===k)return 1;if(2*k>n)return binomial(n,n-k);for(var coeff=1,i=k;i>0;--i)coeff*=n-i+1,coeff/=i;return coeff},FM.permutations=function(arr){function permute(input){for(var i=0;i<input.length;i++){var term=input.splice(i,1)[0];usedChars.push(term),0===input.length&&permArr.push(usedChars.slice()),permute(input),input.splice(i,0,term),usedChars.pop()}return permArr}var permArr=[],usedChars=[];return permute(arr)},function(){function getSubsets(arr){if(1===arr.length)return[[],arr];for(var last=arr.pop(),subsets=getSubsets(arr),result=[],i=0;i<subsets.length;++i){var a2=subsets[i].clone();a2.push(last),result.push(subsets[i],a2)}return result}FM.subsets=function(arr,length){var myArr=arr.clone(),subsets=getSubsets(myArr);return length&&(subsets=subsets.filter(function(x){return x.length===length})),subsets.sort(function(a,b){return a.length-b.length})}}(),FM.coinFlips=function(n){for(var str="",i=0;n>i;++i)str+=Math.random()>=.5?"H":"T";return str},FM.travellingSalesman=function(dist){var n=dist.length,cities=FM.range(n),minLength=1/0,minPath=null;return FM.permutations(cities).each(function(path){for(var length=0,i=0;n-1>i;++i)if(length+=dist[path[i]][path[i+1]],length>minLength)return;minLength>length&&(minLength=length),minPath=path}),{path:minPath,length:minLength}},FM.travellingSalesmanGreedy=function(){},FM.travellingSalesman2Opt=function(){},FM.sum=function(values){for(var sum=0,i=0,n=values.length;n>i;++i)sum+=values[i]||0;return sum},FM.mean=function(values){return FM.sum(values)/values.length},FM.median=function(values){var sortedInts=FM.sort(values);return values.length%2===0?(sortedInts[values.length/2-1]+sortedInts[values.length/2])/2:sortedInts[Math.floor(values.length/2)]},FM.mode=function(values){for(var mode,numInstances=[],modeInstances=-1,i=0;i<values.length;i++)numInstances[values[i]]?(numInstances[values[i]]+=1,numInstances[values[i]]>modeInstances&&(modeInstances=numInstances[values[i]],mode=values[i])):numInstances[values[i]]=1;for(var i=0;i<numInstances.length;i++)if(numInstances[i]&&i!==mode&&numInstances[i]>=modeInstances)return null;return mode},FM.variance=function(values){for(var mean=FM.mean(values),n=values.length,sum=0,i=0;n>i;++i)sum+=FM.square(values[i]-mean);return sum/(n-1)},FM.stdDev=function(values){return Math.sqrt(FM.variance(values))},FM.covariance=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");for(var n=aX.length,total=0,i=0;n>i;i++)total+=aX[i]*aY[i];return(total-aX.total()*aY.total()/n)/n},FM.correlation=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");var covarXY=FM.covariance(aX,aY),stdDevX=aX.standardDev(),stdDevY=aY.standardDev();return covarXY/(stdDevX*stdDevY)},FM.rSquared=function(source,regression){var residualSumOfSquares=source.each(function(d,i){return FM.square(d-regression[i])}).sum(),totalSumOfSquares=source.each(function(d){return FM.square(d-source.average())}).sum();return 1-residualSumOfSquares/totalSumOfSquares},FM.linearRegression=function(aX,aY){var n=aX.length,sumX=aX.sum(),sumY=aY.sum(),sumXY=aX.each(function(d,i){return d*aY[i]}).sum(),sumXSquared=aX.each(function(d){return d*d}).sum(),meanX=aX.average(),meanY=aY.average(),b=(sumXY-1/n*sumX*sumY)/(sumXSquared-1/n*sumX*sumX),a=meanY-b*meanX;return function(x){return a+b*x}},FM.normalPDF=function(mean,stddev,x){return 1/Math.sqrt(2*Math.PI*stddev*stddev)*Math.exp(-((x-mean)*(x-mean))/(2*stddev*stddev))},FM.Complex=function(re,im){this.re=re,this.im=im},M.extend(FM.Complex,{add:function(addend){return new FM.complex(this.re+addend.re,this.im+addend.im)},subtract:function(subtrahend){return new FM.complex(this.re-subtrahend.im,this.im-subtrahend.im)},multiply:function(multiplier){var re=this.re*multiplier.re-this.im*multiplier.im,im=this.im*multiplier.re+this.re*multiplier.im;return new FM.complex(re,im)},divide:function(divisor){var denominator=divisor.re*divisor.re+divisor.im*divisor.im,re=(this.re*divisor.re+this.im*divisor.im)/denominator,im=(this.im*divisor.re-this.re*divisor.im)/denominator;return new FM.complex(re,im)},magnitude:function(){return Math.sqrt(this.re*this.re+this.im*this.im)},phase:function(){return Math.atan2(this.im,this.re)}}),FM.vector={},FM.vector.add=function(x,y){return[x[0]+y[0],x[1]+y[1]]},FM.vector.diff=function(x,y){return[x[0]-y[0],x[1]-y[1]]},FM.vector.mult=function(x,m){return[x[0]*m,x[1]*m]},FM.vector.dot=function(x,y){if(x.length!==y.length)throw new Error("Vector length mismatch");for(var result=0,i=0;i<x.length;i++)result+=x[i]*y[i];return result},FM.vector.cross=function(x,y){return x[0]*y[1]-x[1]*y[0]},FM.vector.length=function(x){return Math.sqrt(FM.square(x[0])+FM.square(x[1]))},FM.vector.normalise=function(x){return FM.vector.mult(x,1/FM.vector.length(x))},FM.Matrix=function(array){for(var i=0;i<array.length;++i)this[i]=array[i];this.rows=array.length,this.cols=array[0].length},FM.Matrix.prototype.isSquare=function(){return this.rows===this.cols},FM.Matrix.prototype.transpose=function(){for(var result=[],i=0;i<this.rows;i++){result[i]=[];for(var j=0;j<this.cols;j++)result[i][j]=this.array[j][i]}return new FM.matrix(result)},FM.Matrix.prototype.determinant=function(){var row,col,diagLeft,diagRight,det=0;if(!this.isSquare())throw new Error("Not a square matrix.");if(1===this.rows)return this[0][0];if(2===this.rows)return this[0][0]*this[1][1]-this[0][1]*this[1][0];for(col=0;col<this.cols;col++){for(diagLeft=this[0][col],diagRight=this[0][col],row=1;row<this.rows;row++)diagRight*=this[row][((col+row)%this.cols+this.cols)%this.cols],diagLeft*=this[row][((col-row)%this.cols+this.cols)%this.cols];det+=diagRight-diagLeft}return det},FM.Matrix.prototype.scalarMultiply=function(val){for(var result=[],i=0;i<this.rows;i++){result[i]=[];for(var j=0;j<this.cols;j++)result[i][j]=val*this[i][j]}return new FM.matrix(result)},FM.identityMatrix=function(n){for(var result=[],i=0;n>i;i++){result[i]=[];for(var j=0;n>j;j++)result[i][j]=i===j?1:0}return new FM.matrix(result)},FM.matrixAddition=function(m1,m2){if(m1.rows!==m2.rows||m1.cols!==m2.cols)throw new Error("Matrix size mismatch");for(var result=[],i=0;i<m1.length;++i){result[i]=[];for(var j=0;j<m1[i].length;++j)result[i][j]=m1[i][j]+m2[i][j]}return new FM.matrix(result)},FM.matrixMultiplication=function(m1,m2){if(m1.cols!==m2.rows)throw new Error("Matrix size mismatch");for(var result=[],x=0;x<m1.rows;x++)result[x]=[];for(var m2Transpose=m2.transpose(),i=0;i<m1.rows;i++)for(var j=0;j<m2.cols;j++)result[i][j]=FM.dotproduct(m1[i],m2Transpose[j]);return FM.matrix(result)},FM.geo={},FM.geo.distance=function(p1,p2){return Math.sqrt(FM.square(p1[0]-p2[0])+FM.square(p1[1]-p2[1]))},FM.geo.manhatten=function(p1,p2){return Math.abs(p1[0]-p2[0])+Math.abs(p1[1]-p2[1])},FM.geo.intersect=function(a1,a2,b1,b2){var da=FM.vector.diff(a2,a1),db=FM.vector.diff(b2,b1),ab=FM.vector.diff(a1,b1),denominator=FM.vector.cross(db,da);if(0!==denominator){var numeratorA=db[1]*ab[0]-db[0]*ab[1],numeratorB=da[1]*ab[0]-da[0]*ab[1],A=numeratorA/denominator,B=numeratorB/denominator;if(A.between(0,1)&&B.between(0,1)){var intersectionX=a1[0]+A*(a2[0]-a1[0]),intersectionY=a1[1]+B*(a2[1]-a1[1]);return[intersectionX,intersectionY]}}};var LOWER_CASE="abcdefghijklmnopqrstuvwxyz",UPPER_CASE="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ENGLISH_FREQUENCY={a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00154,k:.00772,l:.04024,m:.02406,n:.06749,o:.07507,p:.01929,q:95e-5,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.0236,x:.0015,y:.01974,z:74e-5};FM.caesarCypher=function(msg,shift){for(var cipher="",i=0,len=msg.length;len>i;i++)cipher+=msg[i]>="a"&&msg[i]<="z"?LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26]:msg[i]>="A"&&msg[i]<="Z"?UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26]:msg[i];return cipher},FM.vigenereCypher=function(msg,key){for(var cipher="",shift=0,count=0,k=key.toLowerCase(),i=0,len=msg.length,keyLen=k.length;len>i;i++)shift=LOWER_CASE.indexOf(k[count%keyLen]),msg[i]>="a"&&msg[i]<="z"?(cipher+=LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26],count++):msg[i]>="A"&&msg[i]<="Z"?(cipher+=UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26],count++):cipher+=msg[i];return cipher},FM.letterFreqency=function(letter){return ENGLISH_FREQUENCY[letter.toLowerCase()]},FM.cipherLetterFreq=function(cipher){for(var msg=cipher.toLowerCase(),freq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0,len=msg.length;len>i;++i)msg[i]>="a"&&msg[i]<="z"&&freq[LOWER_CASE.indexOf(msg[i])]++;return freq},FM.bisect=function(fn,precision,l,h){null==precision&&(precision=3);var p=Math.pow(10,-precision),q=Math.pow(10,precision);l||(l=0);var lf=fn(l),ls=Math.sign(lf);if(0===ls)return l;if(null==h){h=.5;do h*=2,hf=fn(h),hs=Math.sign(hf);while(hs===ls);if(0===hs)return h}for(var x=0;Math.abs(lf)>p&&200>x;){var c=(l+h)/2,cf=fn(c),cs=Math.sign(cf);if(0===cs)return c;cs===ls?(l=c,lf=cf):(h=c,hf=cf),++x}return Math.round(l*q)*p}}();var M=M||{};M.browser={width:window.innerWidth,height:window.innerHeight,isMobile:"undefined"!=typeof window.orientation,isRetina:(window.devicePixelRatio||1)>1,isTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,imgExt:(window.devicePixelRatio||1)>1.25?"@2x":"",speechRecognition:"webkitSpeechRecognition"in window},M.redraw=function(){document.body.offsetHeight},M.now=Date.now||function(){return(new Date).getTime()},M.onload=function(fn){window.onload=fn},M.toCamelCase=function(str){return str.toLowerCase().replace(/^-/,"").replace(/-(.)/g,function(match,g){return g.toUpperCase()})},M.is3DTransform=function(){var style=document.createElement("div").style;return"webkitPerspective"in style||"MozPerspective"in style||"OPerspective"in style||"MsPerspective"in style||"perspective"in style}(),M.animationFrame=function(){var rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)};return function(fn){rAF(fn)}}(),M.cssTimeToNumber=function(cssTime){var regex=/^([\-\+]?[0-9]+(\.[0-9]+)?)(m?s)$/,matches=regex.exec(cssTime.trim());return null===matches?null:+matches[1]*("s"===matches[3]?1e3:1)},M.addCSSRule=function(selector,rules){var css=document.styleSheets[document.styleSheets.length-1],index=css.rules.length-1;css.insertRule?css.insertRule(selector+"{"+rules+"}",index):css.addRule(selector,rules,index)},function(){var cache={},style=document.body.style,prefixes={webkit:"webkit",moz:"Moz",ms:"ms"},findCssPrefix=function(name){var rule=M.toCamelCase(name);if(null!=style[rule])return name;rule=rule.toTitleCase();for(var v in prefixes)if(null!=style[prefixes[v]+rule])return"-"+v+"-"+name;return name};M.prefix=function(name){if(cache[name])return cache[name];var rule=findCssPrefix(name);return cache[name]=rule,rule}}(),function(){var hasHistory=!!window.history,id=0,origin=window.location.origin+window.location.port,path=window.location.pathname.replace(origin,""),hash=window.location.hash.replace(/^#/,"");M.History=new M.Class.extend({back:function(){hasHistory&&window.history.back()},forward:function(){hasHistory&&window.history.forward()},go:function(n){hasHistory&&window.history.go(n)},push:function(url,state){++id,state||(state={url:url}),hasHistory&&window.history.pushState({id:id,state:state},"",url)},replace:function(url,state){state||(state={url:url}),hasHistory&&window.history.replaceState(state,"",url)}}),Object.defineProperty(M.History,"hash",{enumerable:!0,configurable:!0,get:function(){return hash},set:function(newHash){++id,hash=newHash,hasHistory?window.history.pushState({id:id,state:{}},"",path+"#"+hash):window.location.hash="#"+hash}});var popped="state"in window.history,initialURL=location.href;window.addEventListener("popstate",function(e){var validPop=popped||location.href===initialURL;if(popped=!0,validPop&&(path=window.location.pathname,hash=window.location.hash.replace(/^#/,""),e.state)){var newId=e.state.id;M.History.trigger("change",e.state.state),id>newId&&M.History.trigger("back",e.state.state),newId>id&&M.History.trigger("forward",e.state.state),id=newId}})}(),M.Cookie={get:function(name){return M.Cookie.has(name)?M.Cookie.list()[name]:null},has:function(name){return new RegExp("(?:;\\s*|^)"+encodeURIComponent(name)+"=").test(document.cookie)},list:function(){for(var pair,pairs=document.cookie.split(";"),result={},i=0,n=pairs.length;n>i;++i)pair=pairs[i].split("="),pair[0]=pair[0].replace(/^\s+|\s+$/,""),result[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]);return result},remove:function(name,options){var opt2={};for(var key in options||{})opt2[key]=options[key];return opt2.expires=new Date(0),opt2.maxAge=-1,M.Cookie.set(name,null,opt2)},set:function(name,value,options){options=options||{};var cookie=[encodeURIComponent(name)+"="+encodeURIComponent(value)];options.path&&cookie.push("path="+options.path),options.domain&&cookie.push("domain="+options.domain),options.maxAge&&cookie.push("max-age="+parseFloat(options.maxAge)),options.expires&&cookie.push("expires="+(M.isDate(options.expires)?options.expires.toUTCString():options.expires)),options.secure&&cookie.push("secure"),document.cookie=cookie.join(";")}},M.storage={},M.storage.set=function(key,value){for(var keys=(key||"").split("."),storage=JSON.parse(window.localStorage.getItem("M")||"{}"),path=storage,i=0;i<keys.length-1;++i)null==path[keys[i]]&&(path[keys[i]]={}),path=path[keys[i]];path[keys.last()]=value,window.localStorage.setItem("M",JSON.stringify(storage))},M.storage.get=function(key){for(var keys=(key||"").split("."),storage=JSON.parse(window.localStorage.getItem("M")||"{}"),path=storage,i=0;i<keys.length-1;++i){if(null==path[keys[i]])return null;path=path[keys[i]]}return key?path[keys.last()]:path},M.storage.clear=function(key){key?M.storage.set(key,null):window.localStorage.setItem("M","")},M.toQueryString=function(data){var pairs=[];return M.each(data,function(value,key){return key=encodeURIComponent(key),null==value?void pairs.push(key):(value=M.isArray(value)?value.join(","):""+value,value=value.replace(/(\r)?\n/g,"\r\n"),value=encodeURIComponent(value),value=value.replace(/%20/g,"+"),void pairs.push(key+"="+value))}),pairs.join("&")},M.fromQueryString=function(string){string=string.replace(/^[?,&]/,"");var pairs=decodeURIComponent(string).split("&"),result={};return pairs.each(function(pair){var x=pair.split("=");result[x[0]]=x[1]}),result},M.ajax=function(url,options){options||(options={});var xhr=new XMLHttpRequest,respond=function(){var status=xhr.status;if(!status&&xhr.responseText||status>=200&&300>status||304===status){if(!options.success)return;if("html"===options.dataType){var doc=document.implementation.createHTMLDocument("");doc.open(),doc.write(xhr.responseText),doc.close(),options.success(doc)}else options.success("json"===options.dataType?JSON.parse(xhr.responseText):xhr.responseText)}else options.error&&options.error(xhr)};xhr.onload?xhr.onload=xhr.onerror=respond:xhr.onreadystatechange=function(){4===xhr.readyState&&respond()},options.url||(options.url=window.location.toString()),("GET"===options.method||"HEAD"===options.method)&&(url+=url.indexOf("?")>=0?"&":"?",options.data&&(url+=M.toQueryString(options.data)+"&"),options.cache===!1&&(url+="_nocache="+Date.now())),null==options.async&&(options.async="true"),xhr.open(options.method?options.method.toUpperCase():"GET",url,options.async,options.user,options.password),options.headers&&xhr.setRequestHeader&&M.each(options.headers,function(header,value){xhr.setRequestHeader(header,value)}),null==options.crossDomain&&(options.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(options.url)&&RegExp.$2!==window.location.host),options.crossDomain&&xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");var postData=null;if(null==options.processData&&(options.processData=!0),null==options.contentType&&(options.contentType="application/x-www-form-urlencoded"),options.data&&("POST"===options.method||"PUT"===options.method)){var postDataInstances=[ArrayBuffer,Blob,Document,FormData];if(!options.processData||postDataInstances.indexOf(options.data.constructor)>=0)postData=options.data;else{var boundary="---------------------------"+Date.now().toString(16);"multipart/form-data"===options.contentType?xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary):xhr.setRequestHeader("Content-Type",options.contentType),postData="";var _data=M.toQueryString(options.data);if("multipart/form-data"===options.contentType){boundary="---------------------------"+Date.now().toString(16),_data=_data.split("&");for(var _newData=[],i=0;i<_data.length;i++)_newData.push('Content-Disposition: form-data; name="'+_data[i].split("=")[0]+'"\r\n\r\n'+_data[i].split("=")[1]+"\r\n");postData="--"+boundary+"\r\n"+_newData.join("--"+boundary+"\r\n")+"--"+boundary+"--\r\n"}else postData="application/x-www-form-urlencoded"===options.contentType?_data:_data.replace(/&/g,"\r\n")}}xhr.send(postData)},M.get=function(url,data,success){return M.ajax(url,{method:"GET",dataType:"html",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.post=function(url,data,success){return M.ajax(url,{method:"POST",dataType:"html",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.getJSON=function(url,data,success){return M.ajax(url,{method:"GET",dataType:"json",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.getScript=function(src,success,error){var script=document.createElement("script");script.type="text/javascript",error&&(script.onerror=error),success&&(script.onload=success),document.head.appendChild(script),script.src=src},M.$=function($el){this.data={},this.$el=$el},M.$.prototype.addClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.add(classes[i])},M.$.prototype.removeClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.remove(classes[i])},M.$.prototype.hasClass=function(className){return(" "+this.$el.className+" ").indexOf(" "+className+" ")>=0},M.$.prototype.toggleClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.toggle(classes[i])},M.$.prototype.setClass=function(className,condition){condition?this.addClass(className):this.removeClass(className)},M.$.prototype.attr=function(attr,value){return null==value?this.$el.getAttribute(attr):void(""===value?this.$el.removeAttribute(attr):this.$el.setAttribute(attr,value))},M.$.prototype.data=function(key,value){if(null==value){var dataAttr=this.$el.getAttribute("data-"+key);return dataAttr?dataAttr:this.data?this.data[key]:void 0}this.data[key]=value},M.$.prototype.value=function(value){return null==value?this.$el.value:void(this.$el.value=value)},M.$.prototype.html=function(html){return null==html?this.$el.innerHTML:void(this.$el.innerHTML=html)},M.$.prototype.text=function(text){return null==text?this.$el.textContent.trim():void(this.$el.textContent=text)},M.$.prototype.width=function(type){return this.$el===window?window.innerWidth:"padding"===type?this.$el.clientWidth:"scroll"===type?this.$el.scrollWidth:"border"===type?this.$el.offsetWidth:"margin"===type?this.$el.offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this.$el.clientWidth-parseFloat(this.css("padding-left"))-parseFloat(this.css("padding-right"))},M.$.prototype.height=function(type){return this.$el===window?window.innerHeight:"padding"===type?this.$el.clientHeight:"scroll"===type?this.$el.scrollHeight:"border"===type?this.$el.offsetHeight:"margin"===type?this.$el.offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this.$el.clientHeight-parseFloat(this.css("padding-bottom"))-parseFloat(this.css("padding-top"))
},M.$.prototype.offset=function($parent){if("parent"===$parent&&($parent=this.parent()),"body"===$parent&&($parent=M.$body),$parent&&$parent.$el===this.$el.offsetParent){var top=this.$el.offsetTop+$parent.$el.clientTop,left=this.$el.offsetLeft+$parent.$el.clientLeft,bottom=top+this.$el.offsetHeight,right=left+this.$el.offsetWidth;return{top:top,left:left,bottom:bottom,right:right}}if($parent){var parentBox=$parent.$el.getBoundingClientRect(),box=this.$el.getBoundingClientRect();return{top:box.top-parentBox.top,left:box.left-parentBox.left,bottom:box.bottom-parentBox.top,right:box.right-parentBox.left}}var box=this.$el.getBoundingClientRect();return{top:box.top,left:box.left,bottom:box.bottom,right:box.right}},M.$.prototype.css=function(props,value){if(1===arguments.length){if("string"==typeof props)return window.getComputedStyle(this.$el,null).getPropertyValue(props);for(var prop in props)M.has(props,prop)&&(this.$el.style[prop]=props[prop])}else 2===arguments.length&&"string"==typeof props&&(this.$el.style[M.toCamelCase(props)]=value)},M.$.prototype.transition=function(property,duration,curve){"string"!=typeof duration&&(duration+="ms"),this.$el.style[M.prefix("transition")]=property+" "+duration+(curve?" "+curve:"")},M.$.prototype.transform=function(transform){this.$el.style[M.prefix("transform")]=transform},M.$.prototype.transformX=function(x){x=Math.round(x),this.$el.style[M.prefix("transform")]=M.is3DTransform?"translate3d("+x+"px,0,0)":"translate("+x+"px,0)"},M.$.prototype.transformY=function(y){y=Math.round(y),this.$el.style[M.prefix("transform")]=M.is3DTransform?"translate3d(0px,"+y+"px,0px)":"translate(0px,"+y+"px)"},M.$.prototype.hide=function(){this.css("display","none"),this.css("visibility","hidden")},M.$.prototype.show=function(){this.css("display","block"),this.css("visibility","visible")},M.$.prototype.is=function(selector){for(var compareWith=document.querySelectorAll(selector),i=0,l=compareWith.length;l>i;++i)if(compareWith[i]===this.$el)return!0;return!1},M.$.prototype.index=function(){for(var i=0,child=this.$el;null!==(child=child.previousSibling);)i++;return i},M.$.prototype.append=function(newChild){var _this=this;if("string"==typeof newChild){var newChildren=$$N(newChild);newChildren.each(function(child){_this.$el.appendChild(child.$el)})}else this.$el.appendChild(newChild.$el)},M.$.prototype.prepend=function(newChild){if("string"==typeof newChild)for(var newChildren=$$N(newChild),j=newChildren.length-1;j>=0;j--)this.$el.insertBefore(newChildren[j],this.$el.childNodes[0]);else this.$el.insertBefore(newChild.$el,this.$el.childNodes[0])},M.$.prototype.insertBefore=function(newChild){var parent=this.parent(),_this=this;if("string"==typeof newChild)for(var newChildren=$$N(newChild),j=newChildren.length-1;j>=0;j--)parent.$el.insertBefore(newChildren[j].$el,_this.$el);else parent.$el.insertBefore(newChild.$el,_this.$el)},M.$.prototype.insertAfter=function(newChild){var _this=this,parent=_this.$el.parentNode;if("string"==typeof newChild){var newChildren=$$N(newChild);newChildren.each(function(){})}else{var next=_this.$el.nextSibling;next?parent.insertBefore(newChild.$el,next):parent.appendChild(newChild.$el)}},M.$.prototype.wrap=function(wrapper){"string"==typeof wrapper&&(wrapper=$(document.createElement(wrapper))),this.insertBefore(wrapper),this.remove(),wrapper.append(this)},M.$.prototype.moveTo=function(newParent,before){this.remove(),before?newParent.prepend(this):newParent.append(this)},M.$.prototype.next=function(){var next=this.$el.nextElementSibling;return next?$(next):!1},M.$.prototype.prev=function(){var prev=this.$el.previousElementSibling;return prev?$(prev):!1},M.$.prototype.find=function(selector){return $$(selector,this)},M.$.prototype.parent=function(){var parent=this.$el.parentNode;return parent?$(parent):!1},M.$.prototype.parents=function(selector){for(var parents=[],parent=this.parent();parent;)(!selector||parent.is(selector))&&parents.push(parent),parent=parent.parent();return parents},M.$.prototype.children=function(selector){var childNodes=this.$el.children;if(!childNodes){childNodes=[];var nodes=this.$el.childNodes;M.each(nodes,function(n){(!n.data||n.data.trim())&&childNodes.push(n)})}if("number"==typeof selector)return $(childNodes[selector]);for(var children=[],i=0,l=childNodes.length;l>i;++i)(!selector||$(childNodes[i]).is(selector))&&children.push($(childNodes[i]));return children},M.$.prototype.remove=function(){this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},M.$.prototype.delete=function(){this.remove(),this.$el=null},M.$.prototype.clear=function(){var _this=this;this.children().each(function($el){_this.$el.removeChild($el.$el)})},M.$.prototype.replace=function(newEl){this.insertAfter(newEl),this.remove()},M.$.prototype.getTransitions=function(){for(var s=window.getComputedStyle(this.$el),delay=s.getPropertyValue("transition-delay").split(","),duration=s.getPropertyValue("transition-duration").split(","),property=s.getPropertyValue("transition-property").split(","),timing=s.getPropertyValue("transition-timing-function").match(/[^\(\),]+(\([^\(\)]*\))?[^\(\),]*/g),result=[],i=0;i<property.length;++i)result.push({css:property[i].trim(),delay:M.cssTimeToNumber(delay[i]),duration:M.cssTimeToNumber(duration[i]),timing:timing[i]});return result},M.$.prototype.setTransitions=function(transitions){var css=[];M.each(transitions,function(options){css.push([options.css,(options.duration||1e3)+"ms",options.timing||"linear",(options.delay||0)+"ms"].join(" "))}),this.css("transition",css.join(", "))},M.$.prototype.animate=function(props,callback){var _this=this;M.isArray(props)||(props=[props]);var s=window.getComputedStyle(this.$el);M.each(props,function(options){"height"===options.css&&this.css("height",parseFloat(s.getPropertyValue("height"))),"width"===options.css&&this.css("width",parseFloat(s.getPropertyValue("width"))),null!=options.from&&_this.css(options.css,options.from)});var oldTransition=s.getPropertyValue(M.prefix("transition"));this.setTransitions(M.merge(this.getTransitions(),props)),M.redraw(),M.each(props,function(options){_this.css(options.css,options.to)}),this.transitionEnd(function(){_this.css(M.prefix("transition"),oldTransition),M.redraw(),callback&&callback()})},M.animate=function(callback,duration){function getFrame(){duration>=time&&M.animationFrame(getFrame),time=+new Date-startTime,callback(time/duration)}var startTime=+new Date,time=0;getFrame()},M.$.prototype.getStrokeLength=function(){if(this.$el.getTotalLength)return this.$el.getTotalLength();var dim=this.$el.getBoundingClientRect();return FM.vector.length([dim.height,dim.width])},M.$.prototype.enter=function(effect,time,delay){if(this.css("visibility","visible"),time)if(effect||(effect="fade"),"fade"===effect)this.animate({css:"opacity",from:0,to:1,duration:time});else if("pop"===effect)this.css("opacity","1"),this.animate({css:M.prefix("transform"),from:"scale(0)",to:"scale(1)",delay:delay,duration:time,timing:"cubic-bezier(0.175, 0.885, 0.32, 1.275)"});else if("draw"===effect){var l=this.getStrokeLength();this.css("stroke-dasharray",l+" "+l),this.animate({css:"stroke-dashoffset",from:l,to:0,delay:delay,duration:time})}},M.$.prototype.exit=function(effect,time,delay){var _this=this;if(!time)return void this.css("visibility","hidden");if(effect||(effect="fade"),"fade"===effect)this.animate({css:"opacity",from:1,to:0,duration:time},function(){_this.css("visibility","hidden")});else if("draw"===effect){var l=this.getStrokeLength();this.css("stroke-dasharray",l+" "+l),this.animate({css:"stroke-dashoffset",from:0,to:l,delay:delay,duration:time})}},M.$.prototype.slideUp=function(callback){var _this=this;this.$el.sliding="up",this.$el.style.height=this.height()+"px",M.redraw(),this.$el.style.height="0px",this.transitionEnd(function(){"up"===_this.$el.sliding&&callback&&callback()})},M.$.prototype.slideDown=function(callback){var _this=this;this.$el.sliding="down",this.$el.style.height=this.children(0).height("margin")+"px",this.transitionEnd(function(){"down"===_this.$el.sliding&&(_this.$el.style.height="auto",callback&&callback())})},M.$.prototype.fadeIn=function(){var _this=this;_this.$el.style.display="block",M.redraw(),this.$el.style.opacity="1"},M.$.prototype.fadeOut=function(){var _this=this;this.$el.style.opacity="0",this.transitionEnd(function(){_this.$el.style.display="none"})},function(){var effects=["pulse","pop","jumpY","jumpX","flash"];effects.each(function(name){M.$.prototype[name]=function(){var _this=this;_this.animationEnd(function(){_this.removeClass("effects-"+name)}),_this.addClass("effects-"+name)}})}(),M.events={},M.events.isSupported=function(event){event="on"+event;var $el=$N("div"),isSupported=event in $el.$el;return isSupported||($el.attr(event,"return;"),isSupported="function"==typeof $el.$el[event]),$el.delete(),isSupported},M.$.prototype.on=function(events,callback){events=events.split(" ");for(var i=0;i<events.length;++i)this.$el.addEventListener(events[i],callback,!1)},M.$.prototype.off=function(events,callback){events=events.split(" ");for(var i=0;i<events.length;++i)this.$el.removeEventListener(events[i],callback,!1)},M.$.prototype.one=function(events,fn){function callback(){_this.off(events,callback),fn(arguments)}var _this=this;this.on(events,callback)},M.$.prototype.trigger=function(eventName,eventData){var evt;try{evt=new CustomEvent(eventName,{detail:eventData,bubbles:!0,cancelable:!0})}catch(e){evt=document.createEvent("Event"),evt.initEvent(eventName,!0,!0),evt.detail=eventData}this.$el.dispatchEvent(evt)},M.events.pointerOffset=function(event,parent){if(event.offsetX)return[event.offsetX,event.offsetY];parent=parent?parent.$el:event.target;var parentXY=parent.getBoundingClientRect(),eventX=event.touches?event.touches[0].clientX:event.clientX,eventY=event.touches?event.touches[0].clientY:event.clientY;return[eventX-parentXY.left,eventY-parentXY.top]},M.events.pointerPosition=function(e){return{x:e.touches?e.touches[0].clientX:e.clientX,y:e.touches?e.touches[0].clientY:e.clientY}},M.events.getWheelDelta=function(e){var delta=0;return e.wheelDelta&&(delta=e.wheelDelta/120),e.detail&&(delta=-e.detail/3),delta},M.events.stop=function(e){e.preventDefault(),e.stopPropagation()},M.$.prototype.pointerStart=function(fn){this.on("mousedown touchstart",fn)},M.$.prototype.pointerMove=function(fn){this.on("mousemove touchmove",fn)},M.$.prototype.pointerEnd=function(fn){this.on("mouseup touchend mousecancel touchcancel",fn)},function(){var checkInside=function($el,event){var c=M.events.pointerPosition(event);return $el.$el===document.elementFromPoint(c.x,c.y)};M.$.prototype.pointerEnter=function(fn,$parent){var _this=this,isInside=null;$parent.pointerEnd(function(){isInside=null}),$parent.pointerMove(function(e){var wasInside=isInside;isInside=checkInside(_this,e),null!=wasInside&&isInside&&!wasInside&&fn(e)})},M.$.prototype.pointerLeave=function(fn,$parent){var _this=this,isInside=null;$parent.pointerMove(function(e){var wasInside=isInside;isInside=checkInside(_this,e),!isInside&&wasInside&&fn(e)})},M.$.prototype.pointerMoveOver=function(fn,$parent){var _this=this;$parent.on("touchmove mousemove",function(e){checkInside(_this,e)&&fn(e)})}}(),M.$.prototype.transitionEnd=function(callback){var events=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"];this.one(events.join(" "),callback)},M.$.prototype.animationEnd=function(callback){function fireCallBack(e){callback.call(_this,e),_this.off(events,fireCallBack)}var events=["webkitAnimationEnd","OAnimationEnd","MSAnimationEnd","animationend"].join(" "),_this=this;this.on(events,fireCallBack)},M.$.prototype.change=function(callback){this.on("propertychange keyup input paste",callback)},M.$.prototype.click=function(callback){var startX,startY,waitForEvent=!1,_this=this,preventMouse=!1;this.on("mousedown",function(e){preventMouse||(waitForEvent=!0,startX=e.clientX,startY=e.clientY)}),this.on("mouseup",function(e){if(preventMouse)return void(preventMouse=!1);if(waitForEvent){var endX=e.clientX,endY=e.clientY;Math.abs(endX-startX)<2&&Math.abs(endY-startY)<2&&callback.call(_this,e)}waitForEvent=!1}),this.on("touchstart",function(e){preventMouse=!0,1===e.touches.length&&(waitForEvent=!0,startX=e.changedTouches[0].clientX,startY=e.changedTouches[0].clientY)}),this.on("touchend",function(e){if(waitForEvent&&1===e.changedTouches.length){var endX=e.changedTouches[0].clientX,endY=e.changedTouches[0].clientY;Math.abs(endX-startX)<5&&Math.abs(endY-startY)<5&&callback.call(_this,e)}waitForEvent=!1}),this.on("touchcancel",function(){waitForEvent=!1})},M.$.prototype.scroll=function(fns){function start(){initialScroll=_this.$el.scrollTop,fns.start&&fns.start(),scrolling=!0}function move(){scrolling||start(),fns.move&&fns.move(),scrollTimeout&&window.clearTimeout(scrollTimeout),scrollTimeout=window.setTimeout(end,100)}function end(){fns.end&&fns.end(),scrolling=!1}function touchEnd(){window.removeEventListener("touchmove",move),window.removeEventListener("touchend",touchEnd)}var _this=this,scrollTimeout=null,scrolling=!1,initialScroll=0,$el=this.$el;this.on("wheel mousewheel DOMMouseScroll",move),this.on("touchstart",function(){var top=$el.scrollTop;0>=top&&($el.scrollTop=1),top+$el.offsetHeight>=$el.scrollHeight&&($el.scrollTop=$el.scrollHeight-$el.offsetHeight-1),start(),window.addEventListener("touchmove",move),window.addEventListener("touchend",touchEnd)})},function(){var shortcuts="blur focus keyup keydown keypress submit".split(" ");shortcuts.each(function(event){M.$.prototype[event]=function(callback){null==callback?this.trigger(event):this.on(event,callback)}})}(),M.activeInput=function(){return document.activeElement===document.body?void 0:document.activeElement},M.keyboardEvent=function(keys,fn){keys instanceof Array||(keys=[keys]),document.addEventListener("keydown",function(e){for(var k=e.keyCode||e.which,i=0;i<keys.length;++i)k!==keys[i]||M.activeInput()||(e.preventDefault(),fn(e))})},M.keyboardMultiEvent=function(key1,key2,fn1,fn2){var key2down=!1;document.addEventListener("keydown",function(e){var k=e.keyCode||e.which;k===key2?key2down=!0:key2down&&k===key1&&!M.activeInput()?(e.preventDefault(),fn2(e)):k!==key1||M.activeInput()||(e.preventDefault(),fn1(e))}),document.addEventListener("keyup",function(e){var k=e.keyCode||e.which;k===key2&&(key2down=!1)})},function(){function easeIn(type,t,s){switch(type){case"quad":return t*t;case"cubic":return t*t*t;case"quart":return t*t*t*t;case"quint":return t*t*t*t*t;case"circ":return 1-Math.sqrt(1-t*t);case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return 0>=t?0:Math.pow(2,10*(t-1));case"back":return null==s&&(s=1.70158),t*t*((s+1)*t-s);case"elastic":return null==s&&(s=.3),-Math.pow(2,10*(t-1))*Math.sin((2*(t-1)/s-.5)*Math.PI);case"bounce":return 1/11>t?1/64-7.5625*(.5/11-t)*(.5/11-t):3/11>t?1/16-7.5625*(2/11-t)*(2/11-t):7/11>t?.25-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}M.easing=function(type,t,s){return 0==t?0:1==t?1:(type=type.split("-"),"in"==type[1]?easeIn(type[0],t,s):"out"==type[1]?1-easeIn(type[0],1-t,s):.5>=t?easeIn(type[0],2*t,s)/2:1-easeIn(type[0],2*(1-t),s)/2)}}(),M.$.prototype.scrollTo=function(pos,time,easing,callback){function setScroll(){t=+new Date-startTime;var x=startPosition+distance*M.easing(easing,t/time);_this.$el.scrollTop=x,callback&&callback(x)}function animate(){!cancel&&time>t&&M.animationFrame(animate),setScroll()}var _this=this;0>pos&&(pos=0),easing||(easing="cubic");var cancel=!1;this.scroll({scroll:function(){cancel=!0}}),this.on("touchstart",function(){cancel=!0});var t=0,startPosition=this.$el.scrollTop,distance=pos-startPosition,startTime=+new Date;animate()},M.$body=$(document.body),M.$html=$(document.getElementsByTagName("html")[0]),M.$window=$(window),M.$html.addClass(M.browser.isTouch?"touch":"no-touch"),M.$html.addClass(M.browser.isMobile?"mobile":"no-mobile"),function(){var events=[[],[],[]],trigger=function(){var size=[window.innerWidth,window.innerHeight];events.each(function(queue){queue.each(function(fn){fn(size)})})};M.resize=function(fn,queue){fn?events[queue||0].push(fn):trigger()},M.offResize=function(fn){var index=events.indexOf(fn);index>=0&&events.splice(index,1)};var timeout=null;M.$window.on("resize",function(){clearTimeout(timeout),timeout=setTimeout(function(){trigger()},100)})}(),M.Gallery=function($panel,options){options||(options={});var $wrapper=$N("div",{"class":"gallery-wrapper"}),$box=$N("div",{"class":"gallery-box"});$panel.wrap($wrapper),$wrapper.wrap($box);var width,slidesPerPage,slideWidth,$slides=$panel.children(),slidesCount=$slides.length,staticSlideWidth=$panel.attr("data-slide-width")||null,activeIndex=0,transformX=0,$next=$N("div",{"class":"gallery-next"},$box),$back=$N("div",{"class":"gallery-back"},$box);$N("div",{"class":"icon"},$next),$N("div",{"class":"icon"},$back);var $dotsBox=$N("div",{"class":"gallery-dots"},$box),$dots=[];$slides.each(function($s){$s.addClass("gallery-slide"),$dots.push($N("div",{"class":"gallery-dot"},$dotsBox))});var animT,animStart,animDistance,animStartTime,setPosition=function(offset){transformX=offset,$panel.transformX(offset)},makeActive=function(newIndex){activeIndex=newIndex,$dots.each(function($d,i){$d.setClass("on",i>=newIndex&&newIndex+slidesPerPage>i)}),options.callback&&options.callback(newIndex),$next.setClass("disabled",newIndex===slidesCount-slidesPerPage),$back.setClass("disabled",0===newIndex)},resize=function(){width=$wrapper.width("border"),slidesPerPage=staticSlideWidth?Math.ceil(width/staticSlideWidth):1,slideWidth=width/slidesPerPage,$slides.each(function($slide){$slide.css("width",slideWidth+"px")}),$panel.css("width",slidesCount*slideWidth+"px"),setPosition(-activeIndex*slideWidth),makeActive(activeIndex)},animTiming="quad",animDuration=500,animCancel=!1,animSetPosition=function(){animT=+new Date-animStartTime,setPosition(animStart+animDistance*M.easing(animTiming,animT/animDuration))},animRender=function(){!animCancel&&animDuration>animT&&M.animationFrame(animRender),animSetPosition()},startAnimationTo=function(newIndex){animCancel=!1,animT=0,animStart=transformX,animDistance=-newIndex*slideWidth-transformX,animStartTime=+new Date,makeActive(newIndex),animRender()},next=function(){animTiming="quad",slidesCount-slidesPerPage>activeIndex&&($next.pulse(),startAnimationTo(activeIndex+1))},back=function(){animTiming="quad",activeIndex>0&&($back.pulse(),startAnimationTo(activeIndex-1))};$next.click(next),$back.click(back);var motionStartPosn=null,pointerStart=null,previousMotionX=null,lastMotionX=null,motionStart=function(){M.$body.on("mousemove touchmove",motionMove),M.$body.on("mouseup mouseleave touchend touchcancel",motionEnd),animCancel=!0,motionStartPosn=transformX,pointerStart=event.touches?event.touches[0].clientX:event.clientX,lastMotionX=previousMotionX=pointerStart},motionMove=function(e){e.preventDefault();var x=event.touches?event.touches[0].clientX:event.clientX;previousMotionX=lastMotionX,lastMotionX=x;var newPosition=motionStartPosn-pointerStart+x,maxScroll=-(slidesCount-slidesPerPage)*slideWidth;setPosition(newPosition>0?newPosition/4:maxScroll>newPosition?maxScroll+(newPosition-maxScroll)/4:newPosition)},motionEnd=function(){M.$body.off("mousemove touchmove",motionMove),M.$body.off("mouseup mouseleave touchend touchcancel",motionEnd),x=event.touches?event.touches[0].clientX:event.clientX;var lastDiff=lastMotionX-previousMotionX,shift=lastDiff>12?1:-12>lastDiff?-1:0;animTiming="quad-out",startAnimationTo(Math.round(-transformX/slideWidth-shift).bound(0,slidesCount-slidesPerPage))};return $wrapper.on("mousedown touchstart",motionStart),resize(),M.resize(resize),{next:next,back:back}},M.Draggable=M.Class.extend({init:function($el,$parent,direction,margin){var width,height,_this=this,moveX="y"!==direction,moveY="x"!==direction,position=[0,0],dragStart=[null,null],getPosn=function(e){return[event.touches?e.touches[0].clientX:e.clientX,event.touches?e.touches[0].clientY:e.clientY]},draw=function(x,y){moveX&&$el.css("left",Math.round(x)+"px"),moveY&&$el.css("top",Math.round(y)+"px"),_this.trigger("change",{x:x,y:y,width:width,height:height})};this.set=function(x,y){draw(x,y),position=[x,y]},this.get=function(){return{x:position[0],y:position[1],width:width,height:height}};var motionStart=function(e){M.$body.on("mousemove touchmove",motionMove),M.$body.on("mouseup mouseleave touchend touchcancel",motionEnd),dragStart=getPosn(e),_this.trigger("start")},motionMove=function(e){e.preventDefault();var newPosition=getPosn(e),x=(position[0]+newPosition[0]-dragStart[0]).bound(0,width),y=(position[1]+newPosition[1]-dragStart[1]).bound(0,height);draw(x,y)},motionEnd=function(e){M.$body.off("mousemove touchmove",motionMove),M.$body.off("mouseup mouseleave touchend touchcancel",motionEnd);var newPosition=getPosn(e);if(newPosition[0]==dragStart[0]&&newPosition[1]==dragStart[1])_this.trigger("click");else{var x=(position[0]+newPosition[0]-dragStart[0]).bound(0,width),y=(position[1]+newPosition[1]-dragStart[1]).bound(0,height);position=[x,y],_this.trigger("end")}};$el.on("mousedown touchstart",motionStart);var resize=function(){var oldWidth=width,oldHeight=height;width=$parent.width("border")-2*margin,height=$parent.height("border")-2*margin,_this.set(width/(oldWidth||width)*position[0],height/(oldHeight||height)*position[1])};resize(),M.resize(resize)}}),M.Slider=M.Class.extend({init:function($track,steps){var _this=this;$track.addClass("slider-track");var $knob=$N("div",{"class":"slider-knob"},$track);$N("div",{"class":"icon"},$knob);var active,slider=new M.Draggable($knob,$track,"x",4);slider.on("start",function(){cancelPlay=!0}),slider.on("change",function(e){var n=Math.floor(e.x/e.width*steps);n!==active&&_this.trigger("move",n),active=n});var cancelPlay=!1;slider.on("click",function(){_this.play()});var animRender=function(){var dim=slider.get();!cancelPlay&&dim.x<dim.width&&M.animationFrame(animRender),slider.set(dim.x+2)};this.play=function(){cancelPlay=!1,$knob.pulse(),animRender()},slider.set(0,0)}}),M.ImageSequence=M.Class.extend({init:function($el){var $wrap=$N("div");$el.wrap($wrap);for(var url=$el.attr("data-src"),pages=Number($el.attr("data-pages"))-1,$track=$N("div",{},$wrap),slider=new M.Slider($track,pages),images=[],i=1;pages>i;++i)images[i]=new Image,images[i].src=url.replace("#",i);slider.on("move",function(n){$el.attr("src",url.replace("#",n))}),slider.trigger("move",0)}}),M.svg={},M.svg.el=function(type,attributes,parent){var _this=this,svgns="http://www.w3.org/2000/svg";this.$el=document.createElementNS(svgns,type),this.data={},M.each(attributes,function(val,key){_this.$el.setAttribute(key,val)}),parent&&parent.append(this)},M.inherit(M.svg.el,M.$),M.svg.el.prototype.setPoints=function(p){this.attr("d",p.length?"M"+p.each(function(x){return x.join(",")}).join("L"):""),this.points=p},M.svg.el.prototype.addPoint=function(p){this.attr("d",this.attr("d")+" L "+p.join(",")),this.points.push(p)},M.svg.el.prototype.getPoints=function(){var points=this.$el.attr("d").replace("M","").split("L");return points.each(function(x){return x.split(",").toNumbers()})},M.colour={red:"#D90000",orange:"#F15A24",yellow:"#edd200",lime:"#b2d300",green:"#00B200",cyan:"#29ABE2",blue:"#006DD9",violet:"#662D91",purple:"#9d0069",pink:"#ED1E79"},M.colour.parse=function(c){return"#"===c[0]?[parseInt(c.substr(1,2),16),parseInt(c.substr(3,2),16),parseInt(c.substr(5,2),16)]:c.indexOf("rgb")>=0?c.replace("rgb(","").replace("rgba(","").replace(")","").split(",").each(function(x){return+x}):null},function(){var pad2=function(str){return 1===str.length?"0"+str:str},makeHex=function(colour){var c=M.colour.parse(colour);return"#"+c.each(function(x){return pad2(Math.round(x).toString(16))}).join("")},makeRgb=function(c){var alpha=c[3]||0===c[3];return"rgb"+(alpha?"a(":"(")+c.slice(0,3).each(function(x){return Math.round(x)}).join(",")+(alpha?","+c[3]:"")+")"};M.colour.toRgb=function(c){return makeRgb(M.colour.parse(c))},M.colour.toHex=function(c){return makeHex(M.colour.parse(c))},M.colour.interpolate=function(c1,c2,p){p=p.bound(0,1),c1=M.colour.parse(c1),c2=M.colour.parse(c2);var alpha=null!=c1[3]||null!=c2[3];return null==c1[3]&&(c1[3]=1),null==c2[3]&&(c2[3]=1),makeRgb([p*c1[0]+(1-p)*c2[0],p*c1[1]+(1-p)*c2[1],p*c1[2]+(1-p)*c2[2],alpha?p*c1[3]+(1-p)*c2[3]:null])}}(),M.colour.getColourAt=function(gradient,p){p=p.bound(0,.999);var r=Math.floor(p*(gradient.length-1)),q=p*(gradient.length-1)-r;return M.colour.interpolate(gradient[r+1],gradient[r],q)},function(){var rainbow=["#D92120","#E6642C","#E68E34","#D9AD3C","#B5BD4C","#7FB972","#63AD99","#55A1B1","#488BC2","#4065B1","#413B93","#781C81"];M.colour.rainbow=function(steps){var scale=(.4+.15*steps).bound(0,1);return FM.tabulate(function(x){return M.colour.getColourAt(rainbow,scale*x/(steps-1))},steps)};var temperature=["#3D52A1","#3A89C9","#77B7E5","#B4DDF7","#E6F5FE","#FFFAD2","#FFE3AA","#F9BD7E","#ED875E","#D24D3E","#AE1C3E"];M.colour.temperature=function(steps){var scale=(.1*steps).bound(0,1);return FM.tabulate(function(x){return M.colour.getColourAt(temperature,(1-scale)/2+scale*x/(steps-1))},steps)};var solar=["#FFFFE5","#FFF7BC","#FEE391","#FEC44F","#FB9A29","#EC7014","#CC4C02","#993404","#662506"];M.colour.solar=function(steps){return FM.tabulate(function(x){return M.colour.getColourAt(solar,x/(steps-1))},steps)}}(),M.Audio={files:{},playing:null,load:function(src,id){return M.Audio.files[id]=new Audio(src),M.Audio.files[id].load(),M.Audio.files[id].addEventListener("timeupdate",function(){M.Audio.playing&&M.Audio.playing.update()}),M.Audio.files[id]}},M.Audio.chunk=M.Class.extend({init:function(file,times){"string"==typeof times&&(times=times.split("|").toNumbers()),this.times=times,this.currentTime=times[0],this.duration=times[1]-times[0],this.player=M.Audio.files[file]||M.Audio.load(file,Math.floor(1e4*Math.random())),this.ended=!1},play:function(){var _this=this;return this.player.readyState<2?void $(this.player).one("canplay seeked",function(){_this.play()}):(M.Audio.playing&&M.Audio.playing.pause(),M.Audio.playing=this,this.ended=!1,this.player.currentTime=this.currentTime,this.player.play(),void this.trigger("play",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime}))},pause:function(){M.Audio.playing===this&&this.player.pause(),this.trigger("pause")},setTime:function(time){this.player.readyState&&(this.player.currentTime=time),this.trigger("timeupdate",{p:(time-this.times[0])/this.duration,t:time})},reset:function(){M.Audio.playing===this&&this.player.pause(),this.player.readyState&&(this.currentTime=this.times[0]),this.ended=!0,this.trigger("reset")},update:function(){return this.ended?void 0:(M.Audio.playing===this&&(this.currentTime=this.player.currentTime),this.currentTime>=this.times[1]?(this.ended=!0,this.pause(),void this.trigger("end")):void this.trigger("timeupdate",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime}))}}),M.speechRecognition=function(){if(!M.browser.speechRecognition)return{start:function(){rec.start()},stop:function(){rec.stop()},addCommand:function(){},removeCommand:function(){},available:!1};var rec=new window.webkitSpeechRecognition;rec.continuous=!0,rec.language="en-US";var commands={},processCommand=function(name){name=name.toLowerCase().trim(),commands[name]&&commands[name]()};rec.onresult=function(event){for(var i=event.resultIndex;i<event.results.length;++i)console.debug("Voice Input: ",event.results[i][0].transcript),processCommand(event.results[i][0].transcript)};var addCommand=function(name,fn){name instanceof Array||(name=[name]);for(var i=0;i<name.length;++i)commands[name[i].toLowerCase()]=fn},removeCommand=function(name){name instanceof Array||(name=[name]);for(var i=0;i<name.length;++i)commands[name[i].toLowerCase()]=void 0};return{start:function(){rec.start()},stop:function(){rec.stop()},addCommand:addCommand,removeCommand:removeCommand,available:!0}},M.piechart=function(percentage,radius,colour){var str;if(percentage>=1)str=['<svg width="',2*radius,'" height="',2*radius,'">','<path fill="',colour,'" stroke="none" d="M',radius,",0C",.5*radius,",0,0,",.5*radius,",0,",radius,"s",.5*radius,",",radius,",",radius,",",radius,"s",radius,"-",.5*radius,",",radius,"-",radius,"S",1.5*radius,",0,",radius,",0","z M",44.6*radius/50,",",76.1*radius/50,"L",19.2*radius/50,",",48.8*radius/50,"l",4*radius/50,"-",4.2*radius/50,"l",19.8*radius/50,",",11.9*radius/50,"l",34.2*radius/50,"-",32.6*radius/50,"l",3.5*radius/50,",",3.5*radius/50,"L",44.6*radius/50,",",76.1*radius/50,'z"/>',"</svg>"].join("");else{var x=radius+radius*Math.sin(2*percentage*Math.PI),y=radius-radius*Math.cos(2*percentage*Math.PI);str=['<svg width="',2*radius,'" height="',2*radius,'">','<circle cx="',radius,'" cy="',radius,'" r="',radius-.5,'" stroke="',colour,'" stroke-width="1" fill="transparent"/>','<path d="M ',radius," ",radius," L ",radius," 0 A ",radius," ",radius," 0 "+(percentage>.5?"1":"0")+" 1 "+x+" "+y+' Z" fill="',colour,'"/>',"</svg>"].join("")}return str},M.draw=function($svg,options){var _this=this;$svg.addClass("m-draw-pointer"),_this.options=options,_this.drawing=!1,_this.paths=[],_this.p=null;var activePath=null;_this.start=function(p){_this.p&&FM.geo.distance(_this.p,p)<20?activePath.addPoint(p):(options.onStart&&options.onStart(p),activePath=new M.svg.el("path",{"class":"m-draw-path",d:"M "+p.join(",")},options.paths||$svg),activePath.points=[p],_this.paths.push(activePath)),_this.drawing=!0,_this.p=p},_this.addPoint=function(p){FM.geo.manhatten(_this.p,p)>4&&(activePath.addPoint(p),_this.p=p,options.onIntersect&&_this.checkForIntersects())},options.noStart||$svg.on("mousedown touchstart",function(e){e.preventDefault(),e.stopPropagation();var p=M.events.pointerOffset(event,$svg);_this.start(p)}),$svg.on("mousemove touchmove",function(e){if(_this.drawing){e.preventDefault(),e.stopPropagation();var p=M.events.pointerOffset(event,$svg);_this.addPoint(p)}}),$svg.on("mouseup touchend mouseleave touchleave",function(){_this.drawing=!1})},M.draw.prototype.checkForIntersects=function(){if(!(this.paths.length<=1))for(var path=this.paths.last(),a1=path.points[path.points.length-2],a2=path.points[path.points.length-1],i=0;i<this.paths.length-1;++i)for(var l=this.paths[i].points.length,j=1;l-2>j;++j){var t=FM.geo.intersect(a1,a2,this.paths[i].points[j],this.paths[i].points[j+1]);if(t)return void this.options.onIntersect(t,path,this.paths[i])}},M.draw.prototype.stop=function(){this.drawing=!1,this.p=null},M.draw.prototype.clear=function(){this.paths.each(function(path){path.remove()}),this.paths=[]};