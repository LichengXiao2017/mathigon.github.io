/* (c) 2014, Mathigon */

!function(){{var M={core:!0},_arrayPush=Array.prototype.push,_arraySlice=Array.prototype.slice,_arrayShift=Array.prototype.shift;Array.prototype.join}"object"==typeof module&&"object"==typeof module.exports?(module.exports=M,global.M=M):"function"==typeof define&&define.amd?define(M):window.M=M,M.noop=function(){},M.trueop=function(){return!0},M.run=function(obj,args,_this){return obj instanceof Function?obj.apply(_this||null,args):obj},M.isOneOf=function(x){for(var i=1;i<arguments.length;++i)if(x===arguments[i])return!0;return!1},function(){function makePrototype(obj,name,fn){Object.defineProperty(obj,name,{enumerable:!1,writable:!0,value:fn})}M.object={},M.has=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)},M.object.keys=Object.keys||function(obj){var keys=[];for(var key in obj)M.has(obj,key)&&keys.push(key);return keys},M.object.invert=function(obj){for(var result={},keys=M.keys(obj),i=0,l=keys.length;l>i;++i)result[obj[keys[i]]]=keys[i];return result},M.object.create=Object.create||function(){function F(){}return function(proto){return F.prototype=proto,new F}}(),M.each=function(collection,fn){var result,i,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1))for(result=[],i=0;l>i;++i)M.has(collection,i)&&result.push(fn(collection[i],i));else{result={};for(i in collection)M.has(collection,i)&&(result[i]=fn(collection[i],i))}return result},M.some=function(collection,fn){var i,x,l=collection.length;if(0===l||l&&collection.hasOwnProperty(l-1)){for(i=0;l>i;++i)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x}else for(i in collection)if(M.has(collection,i)&&(x=fn(collection[i],i),void 0!==x))return x},M.extend=function(obj,properties,nonEnumerable){for(var p in properties)M.has(properties,p)&&(void 0===properties[p]?delete obj[p]:nonEnumerable?makePrototype(obj,p,properties[p]):obj[p]=properties[p])},M.merge=function(){for(var result={},i=0;i<arguments.length;++i)M.each(arguments[i],function(value,property){result[property]=value});return result},M.watch=function(obj,prop,handler){var value=obj[prop],getter=function(){return value},setter=function(newVal){return oldVal=value,value=newVal,newVal=handler.call(this,newVal,oldVal)};delete obj[prop]&&Object.defineProperty(obj,prop,{get:getter,set:setter,enumerable:!0,configurable:!0})},M.unwatch=function(obj,prop){var val=obj[prop];delete obj[prop],obj[prop]=val}}(),function(){var typeCache={},typeRegexp=/\s([a-zA-Z]+)/;M.typeof=function(obj){if(null==obj)return""+obj;if(M.isNaN(obj))return"nan";var type=toString.call(obj);return typeCache[type]||(typeCache[type]=type.match(typeRegexp)[1].toLowerCase())},M.isType=function(x,type){return M.typeof(x)===type},M.isString=function(x){return x instanceof String||"string"==typeof x},M.isArray=Array.isArray||function(x){return"[object Array]"===Object.prototype.toString.call(x)},M.isNumber=function(x){return x instanceof Number||"number"==typeof x},M.isInteger=function(x){return x%1===0},M.isDate=function(x){return"[object Date]"===Object.prototype.toString.call(x)},M.isNaN=function(x){return x!==x},M.isFunction=function(x){return x instanceof Function},M.isBoolean=function(x){return x instanceof Boolean||"boolean"==typeof x},M.isObject=function(x){return x===Object(x)}}(),function(){function deepCopyStoreLookup(obj){for(var i=0;i<deepCopyStore.length;++i)if(deepCopyStore[i][0]===obj)return deepCopyStore[i][1];return null}function deepCopyHelper(obj){var type=typeof obj;if(null==obj||M.isOneOf(type,"number","string","boolean"))return obj;if(obj instanceof Number)return new Number(obj.valueOf());if(obj instanceof String)return new String(obj.valueOf());if(obj instanceof Boolean)return new Boolean(obj.valueOf());if(obj instanceof Date)return new Date(obj.valueOf());if(obj instanceof RegExp)return new RegExp(obj);var x=deepCopyStoreLookup(obj);if(x)return x;var copy=obj;if(M.isArray(obj)){copy=[],deepCopyStore.push([obj,copy]);for(var i=0,l=obj.length;l>i;++i)copy[i]=deepCopyHelper(obj[i])}else if(obj instanceof Object){copy={},deepCopyStore.push([obj,copy]);for(var attr in obj)M.has(obj,attr)&&(copy[attr]=deepCopyHelper(obj[attr]))}return copy}M.shallowCopy=function(obj){var type=typeof obj;return null==obj||M.isOneOf(type,"number","string","boolean")?obj:obj instanceof Number?new Number(obj.valueOf()):obj instanceof String?new String(obj.valueOf()):obj instanceof Boolean?new Boolean(obj.valueOf()):obj instanceof Date?new Date(obj.valueOf()):obj instanceof RegExp?new RegExp(obj):M.each(obj,function(val){return val})};var deepCopyStore=[];M.deepCopy=function(obj){deepCopyStore=[];var copy=deepCopyHelper(obj);return deepCopyStore=[],copy},M.shallowEquals=function(){},M.deepEquals=function(){}}(),function(){M.inherit=function(ChildClass,ParentClass){ChildClass.prototype=new ParentClass,ChildClass.prototype.constructor=this},M.Class=function(){this._events={}},M.extend(M.Class.prototype,{on:function(event,fn){this._events[event]?this._events[event].has(fn)||this._events[event].push(fn):this._events[event]=[fn]},off:function(event,fn){if(this._events[event]){var index=this._events[event].indexOf(fn);index>=0&&this._events.splice(index,1)}},trigger:function(event,args){if(this._events[event]){var _this=this;M.each(this._events[event],function(fn){fn.call(_this,args)})}}}),M.Class.extend=function(props){var parent=this,NewClass=function(){this._events={},props.init&&props.init.apply(this,arguments)};NewClass.prototype={};for(var i in parent.prototype)NewClass.prototype[i]=parent.prototype[i];for(i in props)"init"!==i&&(NewClass.prototype[i]=props[i]);return NewClass.extend=M.Class.extend,NewClass.prototype.constructor=NewClass,NewClass.parent=parent,NewClass}}(),function(){M.extend(String.prototype,{endsWith:function(search){var end=this.length,start=end-search.length;return this.substring(start,end)===search},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},collapse:function(){return this.trim().replace(/\s+/g," ")},toTitleCase:function(){return this.replace(/\S+/g,function(a){return a.charAt(0).toUpperCase()+a.slice(1)})},words:function(){return this.strip().split(/\s+/)}},!0),String.prototype.contains||M.extend(String.prototype,{contains:function(){return-1!==String.prototype.indexOf.apply(this,arguments)}},!0)}(),function(){function getLength(array){return array.length}function tabulateWith(fn,vals,args){if(!args.length)return M.run(fn,vals);for(var newArgs=_arraySlice.call(args,0),x=newArgs.shift(),result=[],i=0;x>i;++i)result.push(tabulateWith(fn,vals.concat([i]),newArgs));return result}M.tabulate=function(fn){var indices=M.toArray(arguments);return _arrayShift.call(indices),tabulateWith(fn,[],indices)},M.list=function(a,b,step){step||(step=1);var i,arr=[];if(null==b&&a>=0)for(i=0;a>i;i+=step)arr.push(i);else if(null==b)for(i=0;i>a;i-=step)arr.push(i);else if(b>=a)for(i=a;b>=i;i+=step)arr.push(i);else for(i=a;i>=b;i-=step)arr.push(i);return arr};var unsliceable=["undefined","null","number","boolean","string","function"];M.toArray=function(obj){return unsliceable.has(M.typeof(obj))?[obj]:Array.prototype.slice.call(obj,0)},M.map=function(fn){var arrays=M.toArray(arguments);_arrayShift.call(arrays);var maxLength=Math.max.apply(Math,M.each(arrays,getLength));return M.tabulate(function(i){return fn.apply(null,M.each(arrays,function(x){return x[i]}))},maxLength)},M.extend(Array.prototype,{each:function(fn,reverse){var i,x=[],n=this.length;if(reverse)for(i=n-1;i>=0;--i)M.has(this,i)&&(x[i]=fn(this[i],i));else for(i=0;n>i;++i)M.has(this,i)&&(x[i]=fn(this[i],i));return x},has:function(x){return-1!==this.indexOf(x)},total:function(){for(var total=0,n=this.length,i=0;n>i;++i)total+=+this[i]||0;return total},first:function(){return this[0]},last:function(){return this[this.length-1]},min:function(){return Math.min.apply(Math,this)},max:function(){return Math.max.apply(Math,this)},range:function(){return[this.min(),this.max()]},clean:function(){for(var b=[],n=this.length,i=0;n>i;++i)null!=this[i]&&b.push(this[i]);return b},unique:function(){for(var b=[],n=this.length,i=0;n>i;++i)-1===b.indexOf(this[i])&&b.push(this[i]);return b},without:function(x){for(var b=[],n=this.length,i=0;n>i;++i)this[i]!==x&&b.push(this[i]);return b},chunk:function(n){for(var chunks=[],lastChunk=[],count=0,l=this.length,i=0;l>i;++i)lastChunk.push(this[i]),++count,count>=n&&(chunks.push(lastChunk),lastChunk=[],count=0);return lastChunk.length&&_arrayPush.call(chunks,lastChunk),chunks},rotate:function(offset){var n=this.length;offset=(offset%n+n)%n;var start=this.slice(0,offset),end=this.slice(offset);return _arrayPush.apply(end,start),end},flatten:function(){for(var flat=_arraySlice.call(this,0);M.isArray(flat[0]);){for(var next=[],i=0,n=flat.length;n>i;++i)next=next.concat.apply(next,flat[i]);flat=next}return flat},sortBy:function(p){return this.sort(function(a,b){return a[p]-b[p]})}},!0)}(),function(){M.Queue=function(){this._toResolve=0,this._flushing=!1,this._stack=[]},M.Queue.prototype.require=function(fn){var _this=this;this._toResolve+=1,fn.call(this,function(){_this._toResolve-=1,_this._toResolve<=0&&_this.flush()})},M.Queue.prototype.unrequire=function(){},M.Queue.prototype.timeout=function(t){this.require(function(resolve){setTimeout(function(){resolve()},t)})},M.Queue.prototype.untimeout=function(){},M.Queue.prototype.flush=function(){if(!this._flushing){this._flushing=!0;for(var i=0;i<this._stack.length;++i)this._stack[i]();this._stack=[],this._flushing=!1}},M.Queue.prototype.wait=function(fn){this._flushing||this._toResolve<=0?fn():this._stack.push(fn)},M.Queue.prototype.unwait=function(){},M.Queue.prototype.clear=function(){}}()}(),function(){function caching(fn){if(fn.memo)return fn.memo;var cache={};return fn.memo=function(){var key=_arrayJoin.call(arguments);return void 0!==cache[key]?cache[key]:cache[key]=fn.apply(this,arguments)},fn.memo}function toNumberArray(array){for(var newArray=[],i=0,n=array.length;n>i;++i)newArray.push(+array[i]);return newArray}function findInArray(array,x){for(var i=0,n=array.length;n>i;++i)if(array[i]===x)return i;return-1}if("object"!=typeof M||!M.core)throw new Error("fermat.js requires core.js.");M.fermat=!0;var EPS=1e-6;M.PHI=1.618033988749895,M.SQRT2=1.4142135623730951,M.setPrecision=function(eps){EPS=eps||1e-6};{var _arrayJoin=Array.prototype.join;Array.prototype.push}!function(){M.nearlyEquals=function(x,y,tolerance){return Math.abs(x-y)<(tolerance||EPS)},M.sign=Math.sign||function(x){return x>0?1:0>x?-1:0},M.square=function(x){return x*x},M.cube=function(x){return x*x*x},M.bound=function(x,min,max){return null==max&&(max=1/0),null==min&&(min=-1/0),Math.min(max,Math.max(min,x))},M.between=function(x,a,b){return x>=a&&b>=x},M.numberFormat=function(x){x=(""+x).split(".");for(var n=x[0],rgx=/(\d+)(\d{3})/;rgx.test(n);)n=n.replace(rgx,"$1,$2");return n+(x.length>1?"."+x[1]:"")},M.toOrdinal=function(x){if(Math.abs(x)%100>=11&&Math.abs(x)%100<=13)return x+"th";switch(x%10){case 1:return x+"st";case 2:return x+"nd";case 3:return x+"rd";default:return x+"th"}},M.digits=function(n){if(0===n)return[0];for(var digits=[];n>0;)digits.push(n%10),n=Math.floor(n/10);return digits},M.fractionalDigits=function(n){var str=""+Math.abs(n-Math.floor(n));return toNumberArray(str.split(""))},M.decimalPlaces=function(n){var str=""+Math.abs(n);return str=str.split("."),1===str.length?0:str[1].length},M.round=function(n,precision){var factor=Math.pow(10,precision||0);return Math.round(n*factor)/factor},M.roundTo=function(n,increment){return increment||(increment=1),Math.round(n/increment)*increment},M.roundTowardsZero=function(x){return 0>x?Math.ceil(x-1e-5):Math.floor(x+1e-5)},M.toFraction=function(decimal,precision){precision=precision||1e-4;for(var n=[1,0],d=[0,1],a=Math.floor(decimal),rem=decimal-a;d[0]<=1/precision;){if(M.nearlyEquals(n[0]/d[0],precision))return[n[0],d[0]];n=[a*n[0]+n[1],n[0]],d=[a*d[0]+d[1],d[0]],a=Math.floor(1/rem),rem=1/rem-a}return[decimal,1]},M.add=function(){for(var sum=0,i=0;i<arguments.length;++i)sum+=+arguments[i]||0;return sum},M.mult=function(){for(var sum=0,i=0;i<arguments.length;++i)sum*=+arguments[i]||1;return sum},M.subtr=function(a,b){return a-b},M.div=function(a,b){return a/b},M.mod=function(a,m){return(a%m+a)%m},M.log=function(x,b){return M.isNumber(b)?Math.log(x)/Math.log(b):Math.log(x)},M.log10=Math.log10||function(x){return Math.log(x)/Math.log(10)},M.log2=Math.log2||function(x){return Math.log(x)/Math.log(2)},M.cosh=Math.cosh||function(x){return(Math.exp(x)+Math.exp(-x))/2},M.sinh=Math.sinh||function(x){return(Math.exp(x)-Math.exp(-x))/2}}(),function(){var smallPrimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97];M.gcd=function gcd(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return gcd(a,gcd.apply(null,rest))}var mod;for(a=Math.abs(a),b=Math.abs(b);b;)mod=a%b,a=b,b=mod;return a},M.lcm=function lcm(a,b){if(arguments.length>2){var rest=[].slice.call(arguments,1);return lcm(a,lcm.apply(null,rest))}return Math.abs(a*b)/M.gcd(a,b)},M.isPrime=function(n){if(1>=n||!M.isInt(n))return!1;if(101>n)return findInArray(smallPrimes,n)>=0;if(n%2===0)return!1;for(var sqrt=Math.sqrt(n),i=3;sqrt>=i;i+=2)if(n%i===0)return!1;return!0},M.isOdd=function(n){return n%2===1},M.isEven=function(n){return n%2===0},M.primeFactorization=function fact(n){if(1===n)return[];if(M.isPrime(n))return[n];for(var maxf=Math.sqrt(n),f=2;maxf>=f;++f)if(n%f===0)return concatArray(fact(f),fact(n/f))},M.primeFactors=function(n){return M.primeFactorization(n).unique()},M.listPrimes=function(n){if(2>n)return[];for(var result=[2],i=3;n>=i;i++){var notMultiple=!1;for(var j in result)M.has(result,j)&&(notMultiple=notMultiple||0===i%result[j]);notMultiple||result.push(i)}return result}}(),function(){function getSubsets(arr){if(1===arr.length)return[[],arr];for(var last=arr.pop(),subsets=getSubsets(arr),result=[],i=0;i<subsets.length;++i){var a2=subsets[i].clone();a2.push(last),result.push(subsets[i],a2)}return result}M.factorial=caching(function(x){return 0>x?0/0:0===x?1:1>=x?x:x*M.factorial(x-1)}),M.binomial=caching(function(n,k){if(0===k)return 1;if(2*k>n)return M.binomial(n,n-k);for(var coeff=1,i=k;i>0;--i)coeff*=n-i+1,coeff/=i;return coeff}),M.permutations=function(arr){function permute(input){for(var i=0;i<input.length;i++){var term=input.splice(i,1)[0];usedChars.push(term),0===input.length&&permArr.push(usedChars.slice()),permute(input),input.splice(i,0,term),usedChars.pop()}return permArr}var permArr=[],usedChars=[];return permute(arr)},M.subsets=function(arr,length){var myArr=arr.clone(),subsets=getSubsets(myArr);return length&&(subsets=subsets.filter(function(x){return x.length===length})),subsets},M.coinFlips=function(n){for(var str="",i=0;n>i;++i)str+=Math.random()>=.5?"H":"T";return str}}(),function(){M.random={},M.random.integer=function(a,b){return(null==b?0:a)+Math.floor((null==b?a:b-a+1)*Math.random())},M.random.integerArray=function(n){for(var a=[],i=0;n>i;++i)a.push(i);return a.shuffle()},M.random.weighted=function(obj,setTotal){var total=0;null==setTotal?M.each(obj,function(x){total+=+x}):total=setTotal;var rand=Math.random()*total,curr=0;return M.some(obj,function(x,i){return curr+=obj[i],curr>=rand?i:void 0})},M.shuffle=function(a){a=_arraySlice.call(a,0);for(var j,tmp,i=a.length-1;i;--i)j=Math.floor(Math.random()*(i+1)),tmp=a[j],a[j]=a[i],a[i]=tmp;return a},M.random.bernoulli=function(p){return null==p&&(p=.5),p=Math.max(0,Math.min(1,p)),Math.random()<p?1:0},M.random.binomial=function(n,p){null==n&&(n=1),null==p&&(p=.5);for(var t=0,i=0;n>i;++i)t+=M.random.bernoulli(p);return t},M.random.poisson=function(l){if(null==l&&(l=1),0>=l)return 0;for(var L=Math.exp(-l),p=1,k=0;p>L;++k)p*=Math.random();return k-1},M.random.uniform=function(a,b){return null==a&&(a=0),null==b&&(b=1),a+(b-a)*Math.random()},M.random.normal=function(m,v){null==m&&(m=0),null==v&&(v=1);var u1=Math.random(),u2=Math.random(),rand=Math.sqrt(-2*Math.log(u1))*Math.cos(2*Math.PI*u2);return rand*Math.sqrt(s)+m},M.random.exponential=function(l){return null==l&&(l=1),0>=l?0:-Math.log(Math.random())/l},M.random.geometric=function(p){return null==p&&(p=.5),0>=p||p>1?null:Math.floor(Math.log(Math.random())/Math.log(1-p))},M.random.cauchy=function(){var rr,v1,v2;do v1=2*Math.random()-1,v2=2*Math.random()-1,rr=v1*v1+v2*v2;while(rr>=1);return v1/v2},M.normalPDF=function(x,m,v){return Math.exp(-M.square(x-m)/(2*v))/Math.sqrt(2*Math.PI*v)}}(),function(){M.mean=M.average=function(a){return a.length?M.total(a)/a.length:0},M.median=function(values){var n=values.length;if(!n)return 0;var sorted=values.slice(0).sort();return len%2===1?sorted[Math.floor(n/2)]:(sorted[n/2-1]+sorted[n/2])/2},M.mode=function(values){for(var mode,numInstances=[],modeInstances=-1,i=0;i<values.length;i++)numInstances[values[i]]?(numInstances[values[i]]+=1,numInstances[values[i]]>modeInstances&&(modeInstances=numInstances[values[i]],mode=values[i])):numInstances[values[i]]=1;for(i=0;i<numInstances.length;i++)if(numInstances[i]&&i!==mode&&numInstances[i]>=modeInstances)return null;return mode},M.variance=function(values){var n=values.length;if(!n)return 0;for(var mean=M.mean(values),sum=0,i=0;n>i;++i)sum+=M.square(values[i]-mean);return sum/(n-1)},M.stdDev=function(values){return Math.sqrt(M.variance(values))},M.covariance=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");for(var n=aX.length,total=0,i=0;n>i;i++)total+=aX[i]*aY[i];return(total-aX.total()*aY.total()/n)/n},M.correlation=function(aX,aY){if(aX.length!==aY.length)throw new Error("Array length mismatch");var covarXY=M.covariance(aX,aY),stdDevX=aX.standardDev(),stdDevY=aY.standardDev();return covarXY/(stdDevX*stdDevY)},M.rSquared=function(source,regression){var residualSumOfSquares=source.each(function(d,i){return M.square(d-regression[i])}).sum(),totalSumOfSquares=source.each(function(d){return M.square(d-source.average())}).sum();return 1-residualSumOfSquares/totalSumOfSquares},M.linearRegression=function(aX,aY){var n=aX.length,sumX=aX.sum(),sumY=aY.sum(),sumXY=aX.each(function(d,i){return d*aY[i]}).sum(),sumXSquared=aX.each(function(d){return d*d}).sum(),meanX=aX.average(),meanY=aY.average(),b=(sumXY-1/n*sumX*sumY)/(sumXSquared-1/n*sumX*sumX),a=meanY-b*meanX;return function(x){return a+b*x}}}(),function(){M.Complex=function(re,im){this.re=re||0,this.im=im||0},M.extend(M.Complex.prototype,{toString:function(){return this.real?this.imaginary?this.real+" + "+this.imaginary+"i":this.real:this.imaginary+"i"},magnitude:function(){return Math.sqrt(this.re*this.re+this.im*this.im)},phase:function(){return Math.atan2(this.im,this.re)},conjugate:function(){return new M.complex(this.re,-this.im)}},!0),M.complex={},M.complex.add=function(c1,c2){return c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),new M.Complex(c1.re+c2.re,c1.im+c2.im)},M.complex.subtr=function(c1,c2){return c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),new M.Complex(c1.re-c2.re,c1.im-c2.im)},M.complex.mult=function(c1,c2){c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0));var re=c1.re*c2.re-c1.im*c2.im,im=c1.im*c2.re+c1.re*c2.im;return new M.complex(re,im)},M.complex.div=function(c1,c2){if(c1 instanceof M.Complex||(c1=new M.Complex(c1,0)),c2 instanceof M.Complex||(c2=new M.Complex(c2,0)),Math.abs(c2.re)<EPS&&Math.abs(c2.im)<EPS)return new M.Complex(1/0,1/0);var denominator=c2.re*c2.re+c2.im*c2.im,re=(c1.re*c2.re+c1.im*c2.im)/denominator,im=(c1.im*c2.re-c1.re*c2.im)/denominator;return new M.Complex(re,im)}}(),function(){var setPrototype=Object.setPrototypeOf||function(obj,proto){obj.__proto__=proto};M.Vector=function(a,b){var array;if(Array.isArray(a))array=a.slice(0);else{array=[],void 0===b&&(b=null);for(var i=0;a>i;++i)array.push(b)}return setPrototype(array,M.Vector.prototype),array},M.Vector.prototype=new Array,M.extend(M.Vector.prototype,{total:function(){return M.total(this)},average:function(){return this.total()/this.length},norm:function(){for(var n=0,i=0;i<this.length;++i)n+=M.square(this[i]);return Math.sqrt(n)},normalize:function(){for(var a=[],n=this.length,total=this.norm(),i=0;n>i;++i)a.push(a[i]/total);return M.Vector(a)},toString:function(){return"("+_arrayJoin.call(this,", ")+")"}},!0),M.vector={},M.vector.dot=function(v1,v2){for(var n=Math.max(v1.length,v2.length),d=0,i=0;n>i;++i)d+=(v1[i]||0)*(v2[i]||0);return d},M.vector.cross2D=function(x,y){return x[0]*y[1]-x[1]*y[0]},M.vector.cross=function(v1,v2){return M.Vector([v1[1]*v2[2]-v1[2]*v2[1],v1[2]*v2[0]-v1[0]*v2[2],v1[0]*v2[1]-v1[1]*v2[0]])}}(),function(){M.Matrix=function(a,b,c){if(!(this instanceof M.Matrix))return new M.Matrix(a,b,c);var isArray=M.isArray(a);this.rows=isArray?a.length:a,this.columns=isArray?Math.max.call(Math,a.map(function(x){return x.length})):null!=b?b:a;for(var i=0;i<this.rows;++i){this[i]=[];for(var j=0;j<this.columns;++j){var val=isArray?a[i][j]:c;this[i][j]=null!=val?val:null}}},M.Matrix.prototype.isSquare=function(){return this.rows===this.cols},M.Matrix.prototype.row=function(i){return new M.Vector(this[i])},M.Matrix.prototype.column=function(j){for(var c=[],i=0;i<this.rows;++i)c.push(this[i][j]);return new M.Vector(c)},M.Matrix.prototype.transpose=function(){for(var newMatrix=[],i=0;i<this.columns;++i){this[i]=[];for(var j=0;j<this.rows;++j)newMatrix[i][j]=this[j][i]}return new M.Matrix(newMatrix)},M.Matrix.prototype.determinant=function(){if(!this.isSquare())throw new Error("Not a square matrix.");var n=this.rows,det=0;if(1===n)return this[0][0];if(2===n)return this[0][0]*this[1][1]-this[0][1]*this[1][0];for(var col=0;cols>col;++col){for(var diagLeft=this[0][col],diagRight=this[0][col],row=1;rows>row;++row)diagRight*=this[row][M.mod(col+row,n)],diagLeft*=this[row][M.mod(col-row,n)];det+=diagRight-diagLeft}return det},M.Matrix.prototype.scalarMultiply=function(val){for(var result=[],i=0;i<this.rows;i++){result[i]=[];for(var j=0;j<this.columns;j++)result[i][j]=val*this[i][j]}return M.Matrix(result)},M.Matrix.prototype.inverse=function(){},M.matrix={},M.matrix.identity=function(n){for(var x=new M.Matrix(n,m,0),i=0;i<Math.min(n,m);++i)x[i][i]=1;return x},M.matrix.add=function(m1,m2){if(m1.rows!==m2.rows||m1.cols!==m2.cols)throw new Error("Matrix size mismatch");for(var result=[],i=0;i<m1.length;++i){result[i]=[];for(var j=0;j<m1[i].length;++j)result[i][j]=m1[i][j]+m2[i][j]}return M.Matrix(result)},M.matrix.rotation=function(){},M.matrix.shear=function(){},M.matrix.reflection=function(){},M.matrix.projection=function(){};var vMultM=function(v,m){return mMultV(m.transpose(),v)},mMultV=function(){},mMultM=function(){};M.matrix.mult=function(a,b){if(a instanceof M.Vector&&b instanceof M.Matrix)return vMultM(a,b);if(a instanceof M.Matrix&&b instanceof M.Vector)return mMultV(a,b);if(a instanceof M.Matrix&&b instanceof M.Matrix)return mMultM(a,b);throw new Error("Can't multiply two vectors; use .dot or .cross instead.")}}(),function(){M.geo={},M.geo.Point=function(x,y){this.x=this[0]=+x||0,this.y=this[1]=+y||0,this.length=2},M.geo.Line=function(p1,p2){this.p1=p1,this.p2=p2},M.geo.Curve=function(p1,p2,q1,q2){null==q1&&(q1=p1),null==q2&&(q1=p2),this.p1=p1,this.p2=p2,this.q1=q1,this.q2=q2},M.geo.Circle=function(c,r){this.c=null==r?new M.Point(0,0):c,this.r=null==r?1:r},M.geo.Rect=function(x,y,w,h){this.x=x||0,this.y=y||0,this.w=null==w?w:1,this.h=null==h?h:1},M.geo.Polygon=function(points){this.points=points};var getGeoType=function(x){return x instanceof M.geo.Point?"point":x instanceof M.geo.Line?"line":x instanceof M.geo.Circle?"circle":x instanceof M.geo.Rect?"rect":x instanceof M.geo.Polygon?"polygon":""};M.geo.angle=function(a,b,c){var phiA=Math.atan2(a.y-b.y,a.x-b.x),phiC=Math.atan2(c.y-b.y,c.x-b.x),phi=phiC-phiA;return 0>phi&&(phi+=2*Math.PI),phi},M.geo.Rect.prototype.toPolygon=function(){var a=new M.geo.Point(this.x,this.y),b=new M.geo.Point(this.x+w,this.y),c=new M.geo.Point(this.x+w,this.y+h),d=new M.geo.Point(this.x,this.y+h);return new M.geo.Polygon([a,b,c,d])},M.geo.isParallel=function(l1,l2){var x1=l1.p2.x-l1.p1.x,y1=l1.p2.y-l1.p1.y,x2=l2.p2.x-l2.p1.x,y2=l2.p2.y-l2.p1.y;return 0===x1&&0===x2||0===y1&&0===y2||M.nearlyEquals(y1/x1,y2/x2)},M.geo.Line.prototype.contains=function(p){var grad1=(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x),grad2=(p.y-this.p1.y)/(p-this.p1.x);return M.nearlyEquals(grad1,grad2)},M.geo.Line.prototype.normalVector=function(){var l=this.length(),x=(this.p2.x-this.p1.x)/l,y=(this.p2.y-this.p1.y)/l;return new M.Point(x,y)},M.geo.project=function(p,l){var k=M.vector.dot(M.vector.subtr(p,l.p1),l.normalVector());return new Point(l.p1.x+k.x,l.p1.y+k.y)},M.geo.lineToPointDistance=function(p,l){return M.geo.distance(p,M.gep.project(p,l))},M.geo.Polygon.prototype.centroid=function(){},M.geo.Line.prototype.at=function(t){var x=t*p1.x+(1-t)*p2.x,y=t*p1.y+(1-t)*p2.y;return new M.geo.Point(x,y)},M.geo.Circle.prototype.at=function(){},M.geo.Rect.prototype.at=function(){},M.geo.Polygon.prototype.at=function(){},M.geo.Curve.prototype.at=function(t){var x=M.cube(1-t)*this.p1.x+3*t*(1-t)*(1-t)*q1.x+3*t*t*(1-t)*q2.x+M.cube(t)*this.p2.x,y=M.cube(1-t)*this.p1.y+3*t*(1-t)*(1-t)*q1.y+3*t*t*(1-t)*q2.y+M.cube(t)*this.p2.y;return new M.geo.Point(x,y)},M.geo.distance=function(p1,p2){return Math.sqrt(M.square(p1.x-p2.x)+M.square(p1.y-p2.y))},M.geo.manhatten=function(p1,p2){return Math.abs(p1.x-p2.x)+Math.abs(p1.y-p2.y)},M.geo.Line.prototype.length=function(){return M.geo.distance(this.p1,this.p2)},M.geo.Curve.prototype.length=function(){},M.geo.Circle.prototype.circumference=function(){return 2*Math.PI*this.r},M.geo.Rect.prototype.circumference=function(){return 2*w+2*h},M.geo.Polygon.prototype.circumference=function(){for(var C=0,p=this.points,n=p.length,i=1;n>i;++i)C+=M.geo.distance(p[i-1],p[i]);return C+=M.geo.distance(p[n-1],p[0])},M.geo.Circle.prototype.area=function(){return Math.PI*M.square(this.r)},M.geo.Rect.prototype.area=function(){return Math.abs(this.w*this.h)},M.geo.Polygon.prototype.area=function(){for(var p=this.points,n=p.length,A=p[0].x*p[n-1].y-p[n-1].x*p[0].y,i=1;n>i;++i)A+=p[i-1].x*p[i].y-p[i].x*p[i-1].y;return Math.abs(A/2)};var same={point:function(p1,p2){return M.nearlyEquals(p1.x,p2.x)&&M.nearlyEquals(p1.y,p2.y)},line:function(l1,l2,unoriented){return same.point(l1.p1,l2.p1)&&same.point(l1.p2,l2.p2)||unoriented&&same.point(l1.p1,l2.p2)&&same.point(l1.p2,l2.p1)},rect:function(){},circle:function(){},polygon:function(){}};M.geo.same=function same(a,b,unOriented){var type=getGeoType(a);if(type!==getGeoType(b))return!1;var sameFn=same[type];return sameFn?sameFn(a,b,unOriented):void 0};var scalePoint=function(p,sx,sy){return new M.geo.Point(p.x*sx,p.y*sy)};M.geo.scale=function(x,sx,sy){null==sy&&(sy=sx),x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return scalePoint(x,sx,sy);case"line":return new M.geo.Line(scalePoint(x.p1,sx,sy),scalePoint(x.p2,sx,sy));case"circle":return new M.geo.Circle(scalePoint(x.c,sx,sy),x.r*(sx+sy)/2);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return scalePoint(p,sx,sy)}))}};var reflectPoint=function(p,l){var v=l.p2.x-l.p1.x,w=l.p2.y-l.p1.y,x0=p.x-p1.x,y0=p.y-p1.y,mu=(v*y0-w*x0)/(v*v+w*w),x=p.x+2*mu*w,y=p.y-2*mu*v;return new M.geo.Point(x,y)};M.geo.reflection=function(x,l){x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return reflectPoint(x,l);case"line":return new M.geo.Line(reflectPoint(x.p1,l),reflectPoint(x.p2,l));case"circle":return new M.geo.Circle(reflectPoint(x.c,l),x.r);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return reflectPoint(p,l)}))}};var rotatePoint=function(p,c,phi){var x0=p.x-c.x,y0=p.y-c.y,cos=Math.cos(phi),sin=Math.sin(phi),x=x0*cos-y0*sin+c.x,y=x0*sin+y0*cos+c.y;return new M.geo.Point(x,y)};M.geo.rotation=function(x,c,phi){x instanceof M.geo.Rect&&(x=x.toPolygon());var type=getGeoType(x);switch(type){case"point":return rotatePoint(x,c,phi);case"line":return new M.geo.Line(rotatePoint(x.p1,c,phi),rotatePoint(x.p2,c,phi));case"circle":return new M.geo.Circle(rotatePoint(x.c,c,phi),x.r);case"polygon":return new M.geo.Polygon(x.points.map(function(p){return rotatePoint(p,c,phi)}))}},M.geo.angleBisector=function(a,b,c){var phiA=Math.atan2(a.y-b.y,a.x-b.x),phiC=Math.atan2(c.y-b.y,c.x-b.x),phi=(phiA+phiC)/2;phiA>phiC&&(phi+=Math.PI);var x=Math.cos(phi)+b.x,y=Math.sin(phi)+b.y;return new M.geo.Point(x,y)},M.geo.perpendicular=function(l,p){var dx,dy;if(M.geo.same(p,l.p1))dx=l.p2.y-l.p1.y,dy=l.p1.x-l.p2.x;else if(M.geo.same(p===l.p2))dx=l.p1.y-l.p2.y,dy=l.p2.x-l.p1.x;else if(l.contains(p))dx=l.p1.y-p.y,dy=p.x-l.p1.x;else{var b=M.geo.project(p,l);dx=b.x,dy=b.y}return new M.geo.Line(new M.geo.Point(p.x,p.y),new M.geo.Point(p.x+dx,p.y+dy))},M.geo.sortVertices=function(){},M.geo.convexHull=function(){},M.geo.travellingSalesman=function(dist){var n=dist.length,cities=M.list(n),minLength=1/0,minPath=null;return M.permutations(cities).each(function(path){for(var length=0,i=0;n-1>i;++i)if(length+=dist[path[i]][path[i+1]],length>minLength)return;minLength>length&&(minLength=length),minPath=path}),{path:minPath,length:minLength}};var lineLineIntersect=function(l1,l2){var d1=M.map(M.subtr,l1.p2,l1.p1),d2=M.map(M.subtr,l2.p2,l2.p1),d=M.map(M.subtr,l2.p1,l1.p1),denominator=M.vector.cross2D(d2,d1);if(0!==denominator){var n1=M.vector.cross2D(d1,d),n2=M.vector.cross2D(d2,d),x=n2/denominator,y=n1/denominator;if(M.bound(x,0,1)&&M.bound(y,0,1)){var intersectionX=l1.p1.x+x*(l1.p2.x-l1.p1.x),intersectionY=l1.p1.y+y*(l1.p2.y-l1.p1.y);return[intersectionX,intersectionY]}}},lineCircleIntersect=function(){},linePolygonIntersect=function(){},rectRectIntersect=function(){},polygonPolygonIntersect=function(){};M.geo.intersect=function(x,y){if(arguments.length>2){var rest=_arraySlice.call(arguments,1);return lcm(x,M.geo.intersect.apply(null,rest))}if(x instanceof M.geo.Rect&&y instanceof M.geo.Rect)return rectRectIntersect(x,y);switch(x instanceof M.geo.Rect&&(x=x.toPolygon()),y instanceof M.geo.Rect&&(y=y.toPolygon()),getGeoType(x)+"-"+getGeoType(y)){case"line-line":return lineLineIntersect(x,y);case"line-circle":return lineCircleIntersect(x,y);case"line-polygon":return linePolygonIntersect(x,y);case"circle-line":return lineCircleIntersect(y,x);case"polygon-line":return linePolygonIntersect(y,x);case"polygon-polygon":return polygonPolygonIntersect(x,y)}throw new Error("Can't intersect "+typeX+"s and "+typeY+".")}}(),function(){var LOWER_CASE="abcdefghijklmnopqrstuvwxyz",UPPER_CASE="ABCDEFGHIJKLMNOPQRSTUVWXYZ",ENGLISH_FREQUENCY={a:.08167,b:.01492,c:.02782,d:.04253,e:.12702,f:.02228,g:.02015,h:.06094,i:.06966,j:.00154,k:.00772,l:.04024,m:.02406,n:.06749,o:.07507,p:.01929,q:95e-5,r:.05987,s:.06327,t:.09056,u:.02758,v:.00978,w:.0236,x:.0015,y:.01974,z:74e-5};M.caesarCypher=function(msg,shift){for(var cipher="",i=0,len=msg.length;len>i;i++)cipher+=msg[i]>="a"&&msg[i]<="z"?LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26]:msg[i]>="A"&&msg[i]<="Z"?UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26]:msg[i];return cipher},M.vigenereCypher=function(msg,key){for(var cipher="",shift=0,count=0,k=key.toLowerCase(),i=0,len=msg.length,keyLen=k.length;len>i;i++)shift=LOWER_CASE.indexOf(k[count%keyLen]),msg[i]>="a"&&msg[i]<="z"?(cipher+=LOWER_CASE[(LOWER_CASE.indexOf(msg[i])+shift)%26],count++):msg[i]>="A"&&msg[i]<="Z"?(cipher+=UPPER_CASE[(UPPER_CASE.indexOf(msg[i])+shift)%26],count++):cipher+=msg[i];return cipher},M.letterFreqency=function(letter){return ENGLISH_FREQUENCY[letter.toLowerCase()]},M.cipherLetterFreq=function(cipher){for(var msg=cipher.toLowerCase(),freq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0,len=msg.length;len>i;++i)msg[i]>="a"&&msg[i]<="z"&&freq[LOWER_CASE.indexOf(msg[i])]++;return freq}}(),function(){M.bisect=function(fn,precision,l,h){null==precision&&(precision=3);var p=Math.pow(10,-precision),q=Math.pow(10,precision);l||(l=0);var lf=fn(l),ls=Math.sign(lf);if(0===ls)return l;var hf,hs;if(null==h){h=.5;
do h*=2,hf=fn(h),hs=Math.sign(hf);while(hs===ls);if(0===hs)return h}for(var x=0;Math.abs(lf)>p&&200>x;){var c=(l+h)/2,cf=fn(c),cs=Math.sign(cf);if(0===cs)return c;cs===ls?(l=c,lf=cf):(h=c,hf=cf),++x}return Math.round(l*q)*p}}(),function(){var prefixes={da:{name:"deca",value:10},h:{name:"hecto",value:100},k:{name:"kilo",value:1e3},M:{name:"mega",value:1e6},G:{name:"giga",value:1e9},T:{name:"tera",value:1e12},P:{name:"peta",value:1e15},E:{name:"exa",value:1e18},Z:{name:"zetta",value:1e21},Y:{name:"yotta",value:1e24},d:{name:"deci",value:.1},c:{name:"centi",value:.01},m:{name:"milli",value:.001},u:{name:"micro",value:1e-6},n:{name:"nano",value:1e-9},p:{name:"pico",value:1e-12},f:{name:"femto",value:1e-15},a:{name:"atto",value:1e-18},z:{name:"zepto",value:1e-21},y:{name:"yocto",value:1e-24}},units={m:{name:"meter",type:"length",value:1},"in":{name:"inch",type:"length",value:.0254},ft:{name:"foot",type:"length",value:.3048},yd:{name:"yard",type:"length",value:.9144},mi:{name:"mile",type:"length",value:1609.344},AA:{name:"angstrom",type:"length",value:1e-10},m2:{name:"m2",type:"surface",power:2,value:1},sqin:{name:"sqin",type:"surface",power:2,value:64516e-8},sqft:{name:"sqft",type:"surface",power:2,value:.09290304},sqyd:{name:"sqyd",type:"surface",power:2,value:.83612736},sqmi:{name:"sqmi",type:"surface",power:2,value:2589988.110336},m3:{name:"m3",type:"volume",value:1},l:{name:"litre",type:"volume",value:.001},cup:{name:"cup",type:"volume",value:.0002365882},pint:{name:"pint",type:"volume",value:.0004731765},quart:{name:"quart",type:"volume",value:.0009463529},gallon:{name:"gallon",type:"volume",value:.003785412},barrel:{name:"barrel",type:"volume",value:.1589873},g:{name:"gram",type:"mass",value:.001},ton:{name:"ton",type:"mass",value:907.18474},oz:{name:"ounce",type:"mass",value:.028349523125},lbm:{name:"pound",type:"mass",value:.45359237},s:{name:"second",type:"time",value:1},min:{name:"minute",type:"time",value:60},h:{name:"hour",type:"time",value:3600},d:{name:"day",type:"time",value:86400},w:{name:"week",type:"time",value:604800},mon:{name:"month",type:"time",value:2629740},y:{name:"year",type:"time",value:31556900},rad:{name:"rad",type:"angle",value:1},deg:{name:"deg",type:"angle",value:.017453292519943295},grad:{name:"grad",type:"angle",value:.015707963267948967},cyc:{name:"cycle",type:"angle",value:6.283185307179586},A:{name:"ampere",type:"current",value:1},K:{name:"kelvin",type:"temperature",value:1},degC:{name:"celsius",type:"temperature",value:1,offset:273.15},degF:{name:"fahrenheit",type:"temperature",value:1/1.8,offset:459.67},mol:{name:"mole",type:"substance",value:1},N:{name:"newton",type:"force",value:1},lbf:{name:"poundforce",type:"force",value:4.4482216152605},b:{name:"bits",type:"data",value:1},B:{name:"bytes",type:"data",value:8}};M.unit={};var prefixRegexp=M.object.keys(prefixes).join("|"),unitRegexp=M.object.keys(units).join("|"),regexp=new RegExp("^("+prefixRegexp+")?("+unitRegexp+")$");M.unit.to=function(val,from,to){var f=from.match(regexp),prefix=f[1],unit=f[2],prefixValue=prefix?prefixes[prefix].value||0:1,unitValue=units[unit].value||1,unitOffset=units[unit].offset||0,newVal=(val*unitValue+unitOffset)*prefixValue;return null==to?newVal:(f=to.match(regexp),prefix=f[1],unit=f[2],prefixValue=prefix?prefixes[prefix].value||0:1,unitValue=units[unit].value||1,unitOffset=units[unit].offset||0,(newVal/prefixValue-unitOffset)/unitValue)},M.unit.define=function(unit){unit=unit.match(regexp);var prefix=unit[1]?prefixes[unit[1]].name:"",name=units[unit[2]].name;return prefix+name}}(),function(){function bracketsMatch(a,b){return brackets[a]===b||brackets[b]===a}function ExpressionParser(){this.current="",this.result=[],this.currentParser=null,this.currentBracket=null,this.currentFn=null}function Expression(fn,args){1===arguments.length?(this.isVal=!0,this.val=fn):(this.fn=fn,this.args=args)}var brackets={"(":")","[":"]","{":"}","|":"|"};ExpressionParser.prototype.send=function(x){if('"'===this.currentBracket&&'"'!==x)this.current+=x;else if(this.currentBracket||'"'!==x)if('"'===this.currentBracket&&'"'===x)this.result.push(new Expression('"',[this.current]));else{if("@&\\?<>=~`±§".contains(x))throw new Error('Unexpected "'+x+'".');if(this.currentParser)if(")]}|".contains(x)&&this.currentParser.isReady()){if(!bracketsMatch(x,this.currentBracket))throw new Error('Unexpected "'+x+'".');var completed=this.currentParser.complete();if(this.currentFn)this.result.push(new Expression(this.currentFn,completed));else if("]"===x)this.result.push(new Expression("[]",completed));else if("|"===x)this.result.push(new Expression("abs",completed));else{if(1!==completed.length)throw new Error('Unexpected ",".');this.result.push(new Expression(completed[i]))}this.current="",this.currentBracket=this.currentParser=this.currentFn=null}else this.currentParser.send(x);else"([{|".contains(x)?("("===x&&isNaN(+this.current)&&!"+-*/!^%,".contains(this.current)?(this.currentFn=this.current,this.current=""):this.pushCurrent(),this.currentParser=new ExpressionParser,this.currentBracket=x):"+-*/!^%,".contains(x)?(this.pushCurrent(),","!==x&&this.result.push(x)):x.match(/\s\n\t/)?this.pushCurrent():this.current+=x.trim()}else this.pushCurrent(),this.currentBracket='"'},ExpressionParser.prototype.isReady=function(){return null==this.currentParser},ExpressionParser.prototype.pushCurrent=function(){if(this.current){var num=+this.current;this.result.push(new Expression(num===num?num:this.current)),this.current=""}},ExpressionParser.prototype.complete=function(){for(this.pushCurrent(),i=0;i<this.result.length;++i)"!"===this.result[i]?(this.result.splice(i-1,2,new Expression("!",[this.result[i-1]])),i-=1):"%"===this.result[i]&&(this.result.splice(i-1,2,new Expression("/",[this.result[i-1],100])),i-=1);for(i=0;i<this.result.length;++i)"^"===this.result[i]&&(this.result.splice(i-1,3,new Expression("^",[this.result[i-1],this.result[i+1]])),i-=2);for("-"===this.result[0]&&this.result.splice(0,2,new Expression("-",[this.result[1]])),i=0;i<this.result.length;++i)"/"===this.result[i]?(this.result.splice(i-1,3,new Expression("/",[this.result[i-1],this.result[i+1]])),i-=2):"*"===this.result[i]&&(this.result.splice(i-1,3,new Expression("*",[this.result[i-1],this.result[i+1]])),i-=2);for(i=0;i<this.result.length;++i)"-"===this.result[i]?(this.result.splice(i-1,3,new Expression("-",[this.result[i-1],this.result[i+1]])),i-=2):"+"===this.result[i]&&(this.result.splice(i-1,3,new Expression("+",[this.result[i-1],this.result[i+1]])),i-=2);return this.result},Expression.prototype.simplify=function(){return this},Expression.prototype.toString=function(){if(this.isVal)return this.val.toString();for(var newArgs=[],i=0;i<this.args.length;++i)newArgs.push(this.args[i].toString());var fn=strings[this.fn];return fn?fn.apply(null,args):this.fn+"("+this.args.join(", ")+")"},Expression.prototype.evaluate=function(vars){if(null==vars&&(vars={}),this.isVal)return console.log(this.val),void 0===vars[this.val]?this.val:vars[this.val];for(var newArgs=[],i=0;i<this.args.length;++i){var newArg=this.args[i].evaluate();if(newArg instanceof Expression)return this;newArgs.push(newArg)}var fn=vars[this.fn]||functions[this.fn]||Math[this.fn]||M[this.fn];return console.log.apply(null,newArgs),fn instanceof Function?fn.apply(null,newArgs):this};var functions={"+":function(a,b){return a+b},"-":function(a,b){return void 0===b?-a:a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"!":function(n){return M.factorial(n)},"^":function(a,b){return Math.pow(a,b)},"[]":function(){return arguments},'"':function(str){return""+str},mod:function(a,b){return M.mod(a,b)}},strings={"+":function(){return arguments.join(" + ")},"-":function(a,b){return void 0===b?"-"+a:a+" - "+b},"*":function(){return arguments.join(" * ")},"/":function(a,b){return a+" / "+b},"!":function(n){return n+"!"},"^":function(a,b){return a+" ^ "+b},"[]":function(){return"["+arguments.join(", ")+"]"},'"':function(str){return'"'+str+'"'},mod:function(a,b){return a+" mod "+b}};M.expression={},M.expression.parse=function(str){for(var parser=new ExpressionParser,n=str.length,i=0;n>i;++i)parser.send(str[i]);return parser.complete()[0].simplify()}}()}(),function(){if("object"!=typeof M||!M.core||!M.fermat)throw new Error("boost.js requires core.js and fermat.js.");M.boost=!0,function(){M.browser={width:window.innerWidth,height:window.innerHeight,isMobile:"undefined"!=typeof window.orientation,isRetina:(window.devicePixelRatio||1)>1,isTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,imgExt:(window.devicePixelRatio||1)>1.25?"@2x":"",speechRecognition:"webkitSpeechRecognition"in window},M.redraw=function(){document.body.offsetHeight},M.now=Date.now||function(){return(new Date).getTime()},M.toCamelCase=function(str){return str.toLowerCase().replace(/^-/,"").replace(/-(.)/g,function(match,g){return g.toUpperCase()})},M.uid=function(){return Math.random().toString(36).substr(2,10)},M.is3DTransform=function(){var style=document.createElement("div").style;return"webkitPerspective"in style||"MozPerspective"in style||"OPerspective"in style||"MsPerspective"in style||"perspective"in style}();var loadQueue=[],loaded=!1;window.onload=function(){loaded=!0;for(var i=0;i<loadQueue.length;++i)loadQueue[i]()},M.onload=function(fn){loaded?fn():loadQueue.push(fn)},M.cssTimeToNumber=function(cssTime){var regex=/^([\-\+]?[0-9]+(\.[0-9]+)?)(m?s)$/,matches=regex.exec(cssTime.trim());return null===matches?null:+matches[1]*("s"===matches[3]?1e3:1)},M.addCSSRule=function(selector,rules){var css=document.styleSheets[document.styleSheets.length-1],index=css.rules.length-1;css.insertRule?css.insertRule(selector+"{"+rules+"}",index):css.addRule(selector,rules,index)};var style,cache={},prefixes={webkit:"webkit",moz:"Moz",ms:"ms"};M.onload(function(){style=document.body.style});var findCssPrefix=function(name){var rule=M.toCamelCase(name);if(null!=style[rule])return name;rule=rule.toTitleCase();for(var v in prefixes)if(null!=style[prefixes[v]+rule])return"-"+v+"-"+name;return name};M.prefix=function(name){if(cache[name])return cache[name];var rule=findCssPrefix(name);return cache[name]=rule,rule}}(),M.toQueryString=function(data){var pairs=[];return M.each(data,function(value,key){return key=encodeURIComponent(key),null==value?void pairs.push(key):(value=M.isArray(value)?value.join(","):""+value,value=value.replace(/(\r)?\n/g,"\r\n"),value=encodeURIComponent(value),value=value.replace(/%20/g,"+"),void pairs.push(key+"="+value))}),pairs.join("&")},M.fromQueryString=function(string){string=string.replace(/^[?,&]/,"");var pairs=decodeURIComponent(string).split("&"),result={};return pairs.each(function(pair){var x=pair.split("=");result[x[0]]=x[1]}),result},M.ajax=function(url,options){options||(options={});var xhr=new XMLHttpRequest,respond=function(){var status=xhr.status;if(!status&&xhr.responseText||status>=200&&300>status||304===status){if(!options.success)return;if("html"===options.dataType){var doc=document.implementation.createHTMLDocument("");doc.open(),doc.write(xhr.responseText),doc.close(),options.success(doc)}else options.success("json"===options.dataType?JSON.parse(xhr.responseText):xhr.responseText)}else options.error&&options.error(xhr)};xhr.onload?xhr.onload=xhr.onerror=respond:xhr.onreadystatechange=function(){4===xhr.readyState&&respond()},options.url||(options.url=window.location.toString()),("GET"===options.method||"HEAD"===options.method)&&(url+=url.indexOf("?")>=0?"&":"?",options.data&&(url+=M.toQueryString(options.data)+"&"),options.cache===!1&&(url+="_nocache="+Date.now())),null==options.async&&(options.async="true"),xhr.open(options.method?options.method.toUpperCase():"GET",url,options.async,options.user,options.password),options.headers&&xhr.setRequestHeader&&M.each(options.headers,function(header,value){xhr.setRequestHeader(header,value)}),null==options.crossDomain&&(options.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(options.url)&&RegExp.$2!==window.location.host),options.crossDomain&&xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");var postData=null;if(null==options.processData&&(options.processData=!0),null==options.contentType&&(options.contentType="application/x-www-form-urlencoded"),options.data&&("POST"===options.method||"PUT"===options.method)){var postDataInstances=[ArrayBuffer,Blob,Document,FormData];if(!options.processData||postDataInstances.indexOf(options.data.constructor)>=0)postData=options.data;else{var boundary="---------------------------"+Date.now().toString(16);"multipart/form-data"===options.contentType?xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary):xhr.setRequestHeader("Content-Type",options.contentType),postData="";var _data=M.toQueryString(options.data);if("multipart/form-data"===options.contentType){boundary="---------------------------"+Date.now().toString(16),_data=_data.split("&");for(var _newData=[],i=0;i<_data.length;i++)_newData.push('Content-Disposition: form-data; name="'+_data[i].split("=")[0]+'"\r\n\r\n'+_data[i].split("=")[1]+"\r\n");postData="--"+boundary+"\r\n"+_newData.join("--"+boundary+"\r\n")+"--"+boundary+"--\r\n"}else postData="application/x-www-form-urlencoded"===options.contentType?_data:_data.replace(/&/g,"\r\n")}}xhr.send(postData)},M.get=function(url,data,success){return M.ajax(url,{method:"GET",dataType:"html",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.post=function(url,data,success){return M.ajax(url,{method:"POST",dataType:"html",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.getJSON=function(url,data,success){return M.ajax(url,{method:"GET",dataType:"json",data:"function"==typeof data?null:data,success:"function"==typeof data?data:success})},M.getScript=function(src,success,error){var script=document.createElement("script");script.type="text/javascript",error&&(script.onerror=error),success&&(script.onload=success),document.head.appendChild(script),script.src=src},function(){M.colour={red:"#D90000",orange:"#F15A24",yellow:"#edd200",lime:"#b2d300",green:"#00B200",cyan:"#29ABE2",blue:"#006DD9",violet:"#662D91",purple:"#9d0069",pink:"#ED1E79"},M.colour.parse=function(c){return"#"===c[0]?[parseInt(c.substr(1,2),16),parseInt(c.substr(3,2),16),parseInt(c.substr(5,2),16)]:c.indexOf("rgb")>=0?c.replace("rgb(","").replace("rgba(","").replace(")","").split(",").each(function(x){return+x}):null};var pad2=function(str){return 1===str.length?"0"+str:str},makeHex=function(colour){var c=M.colour.parse(colour);return"#"+c.each(function(x){return pad2(Math.round(x).toString(16))}).join("")},makeRgb=function(c){var alpha=c[3]||0===c[3];return"rgb"+(alpha?"a(":"(")+c.slice(0,3).each(function(x){return Math.round(x)}).join(",")+(alpha?","+c[3]:"")+")"};M.colour.toRgb=function(c){return makeRgb(M.colour.parse(c))},M.colour.toHex=function(c){return makeHex(M.colour.parse(c))},M.colour.interpolate=function(c1,c2,p){p=p.bound(0,1),c1=M.colour.parse(c1),c2=M.colour.parse(c2);var alpha=null!=c1[3]||null!=c2[3];return null==c1[3]&&(c1[3]=1),null==c2[3]&&(c2[3]=1),makeRgb([p*c1[0]+(1-p)*c2[0],p*c1[1]+(1-p)*c2[1],p*c1[2]+(1-p)*c2[2],alpha?p*c1[3]+(1-p)*c2[3]:null])},M.colour.getColourAt=function(gradient,p){p=p.bound(0,.999);var r=Math.floor(p*(gradient.length-1)),q=p*(gradient.length-1)-r;return M.colour.interpolate(gradient[r+1],gradient[r],q)};var rainbow=["#D92120","#E6642C","#E68E34","#D9AD3C","#B5BD4C","#7FB972","#63AD99","#55A1B1","#488BC2","#4065B1","#413B93","#781C81"];M.colour.rainbow=function(steps){var scale=(.4+.15*steps).bound(0,1);return FM.tabulate(function(x){return M.colour.getColourAt(rainbow,scale*x/(steps-1))},steps)};var temperature=["#3D52A1","#3A89C9","#77B7E5","#B4DDF7","#E6F5FE","#FFFAD2","#FFE3AA","#F9BD7E","#ED875E","#D24D3E","#AE1C3E"];M.colour.temperature=function(steps){var scale=(.1*steps).bound(0,1);return FM.tabulate(function(x){return M.colour.getColourAt(temperature,(1-scale)/2+scale*x/(steps-1))},steps)};var solar=["#FFFFE5","#FFF7BC","#FEE391","#FEC44F","#FB9A29","#EC7014","#CC4C02","#993404","#662506"];M.colour.solar=function(steps){return FM.tabulate(function(x){return M.colour.getColourAt(solar,x/(steps-1))},steps)}}(),M.cookie={get:function(name){return M.cookie.has(name)?M.cookie.list()[name]:null},has:function(name){return new RegExp("(?:;\\s*|^)"+encodeURIComponent(name)+"=").test(document.cookie)},list:function(){for(var pair,pairs=document.cookie.split(";"),result={},i=0,n=pairs.length;n>i;++i)pair=pairs[i].split("="),pair[0]=pair[0].replace(/^\s+|\s+$/,""),result[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1]);return result},remove:function(name,options){return options||(options={}),options.expires=new Date(0),options.maxAge=-1,M.cookie.set(name,null,options)},set:function(name,value,options){options=options||{};var cookie=[encodeURIComponent(name)+"="+encodeURIComponent(value)];options.path&&cookie.push("path="+options.path),options.domain&&cookie.push("domain="+options.domain),options.maxAge&&cookie.push("max-age="+options.maxAge),options.expires&&cookie.push("expires="+(M.isDate(options.expires)?options.expires.toUTCString():options.expires)),options.secure&&cookie.push("secure"),document.cookie=cookie.join(";")}},function(){var hasHistory=!!window.history,id=0,root=window.location.origin+window.location.port,path=window.location.pathname.replace(root,""),hash=window.location.hash.replace(/^#/,""),History=M.Class.extend({back:function(){hasHistory&&window.history.back()},forward:function(){hasHistory&&window.history.forward()},go:function(n){hasHistory&&window.history.go(n)},push:function(url,state){++id,state||(state={url:url}),hasHistory&&window.history.pushState({id:id,state:state},"",url)},replace:function(url,state){state||(state={url:url}),hasHistory&&window.history.replaceState(state,"",url)}});M.history=new History,Object.defineProperty(M.history,"hash",{enumerable:!0,configurable:!0,get:function(){return hash},set:function(newHash){++id,hash=newHash,hasHistory?window.history.pushState({id:id,state:{}},"",path+"#"+hash):window.location.hash="#"+hash}});var popped="state"in window.history,initialURL=location.href;window.addEventListener("popstate",function(e){var validPop=popped||location.href===initialURL;if(popped=!0,validPop&&(path=window.location.pathname,hash=window.location.hash.replace(/^#/,""),e.state)){var newId=e.state.id;M.history.trigger("change",e.state.state),id>newId&&M.history.trigger("back",e.state.state),newId>id&&M.history.trigger("forward",e.state.state),id=newId}})}(),function(){M.storage={},M.storage.set=function(key,value){for(var keys=(key||"").split("."),storage=JSON.parse(window.localStorage.getItem("M")||"{}"),path=storage,i=0;i<keys.length-1;++i)null==path[keys[i]]&&(path[keys[i]]={}),path=path[keys[i]];path[keys.last()]=value,window.localStorage.setItem("M",JSON.stringify(storage))},M.storage.get=function(key){for(var keys=(key||"").split("."),storage=JSON.parse(window.localStorage.getItem("M")||"{}"),path=storage,i=0;i<keys.length-1;++i){if(null==path[keys[i]])return null;path=path[keys[i]]}return key?path[keys.last()]:path},M.storage.clear=function(key){key?M.storage.set(key,null):window.localStorage.setItem("M","")}}(),function(){M.$=function($el){this._data=$el?$el._mdata||($el._mdata={}):{},this._events=$el?$el._mevents||($el._mevents={}):{},this.$el=$el},window.$=function(selector,context){if("string"==typeof selector){context=context?context.$el||context:document;var $el=context.querySelector(selector);return $el?new M.$($el):null}return selector instanceof Node||selector===window?new M.$(selector):void 0},window.$I=function(selector,parent){parent&&parent.getElementById||(parent=document);var $el=parent.getElementById(selector);return $el?new M.$($el):null},window.$C=function(selector,context){context=context?context.$el||context:document;var $els=context.getElementsByClassName(selector);return $els.length?new M.$($els[0]):null},window.$T=function(selector,context){context=context?context.$el||context:document;var $els=context.getElementsByTagName(selector);return $els.length?new M.$($els[0]):null},window.$$=function(selector,context){context=context?context.$el||context:document;var $els=context.querySelectorAll(selector);return M.each($els,function($el){return new M.$($el)})},window.$$C=function(selector,context){context=context?context.$el||context:document;var $els=context.getElementsByClassName(selector);return M.each($els,function($el){return new M.$($el)})},window.$$T=function(selector,context){context=context?context.$el||context:document;var $els=context.getElementsByTagName(selector);return M.each($els,function($el){return new M.$($el)})},window.$N=function(tag,attributes,parent){var t=document.createElement(tag);for(var a in attributes)"id"===a?t.id=attributes.id:"class"===a?t.className=attributes.class:"html"===a?t.innerHTML=attributes.html:t.setAttribute(a,attributes[a]);var $el=new M.$(t);return parent&&parent.append($el),$el},window.$$N=function(html){var tempDiv=$N("div",{html:html});return tempDiv.children()},M.$.prototype.addClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.add(classes[i])},M.$.prototype.removeClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.remove(classes[i])},M.$.prototype.hasClass=function(className){return(" "+this.$el.className+" ").indexOf(" "+className.trim()+" ")>=0},M.$.prototype.toggleClass=function(className){for(var classes=className.split(" "),i=0;i<classes.length;++i)this.$el.classList.toggle(classes[i])},M.$.prototype.setClass=function(className,condition){condition?this.addClass(className):this.removeClass(className)},M.$.prototype.attr=function(attr,value){return null==value?this.$el.getAttribute(attr):void(null===value?this.$el.removeAttribute(attr):this.$el.setAttribute(attr,value))},M.$.prototype.data=function(key,value){if(null==value){var dataAttr=this.$el.getAttribute("data-"+key);return dataAttr?dataAttr:this.data?this.data[key]:void 0}this.data[key]=value},M.$.prototype.value=function(value){return null==value?this.$el.value:void(this.$el.value=value)},M.$.prototype.html=function(html){return null==html?this.$el.innerHTML:void(this.$el.innerHTML=html)},M.$.prototype.text=function(text){return null==text?this.$el.textContent.trim():void(this.$el.textContent=text)},M.$.prototype.width=function(type){return this.$el===window?window.innerWidth:"padding"===type?this.$el.clientWidth:"scroll"===type?this.$el.scrollWidth:"border"===type?this.$el.offsetWidth:"margin"===type?this.$el.offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this.$el.clientWidth-parseFloat(this.css("padding-left"))-parseFloat(this.css("padding-right"))},M.$.prototype.height=function(type){return this.$el===window?window.innerHeight:"padding"===type?this.$el.clientHeight:"scroll"===type?this.$el.scrollHeight:"border"===type?this.$el.offsetHeight:"margin"===type?this.$el.offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this.$el.clientHeight-parseFloat(this.css("padding-bottom"))-parseFloat(this.css("padding-top"))},M.$.prototype.offset=function($parent){"parent"===$parent&&($parent=this.parent()),"body"===$parent&&($parent=M.$body);var box;if($parent&&$parent.$el===this.$el.offsetParent){var top=this.$el.offsetTop+$parent.$el.clientTop,left=this.$el.offsetLeft+$parent.$el.clientLeft,bottom=top+this.$el.offsetHeight,right=left+this.$el.offsetWidth;return{top:top,left:left,bottom:bottom,right:right}}if($parent){var parentBox=$parent.$el.getBoundingClientRect();return box=this.$el.getBoundingClientRect(),{top:box.top-parentBox.top,left:box.left-parentBox.left,bottom:box.bottom-parentBox.top,right:box.right-parentBox.left}}return box=this.$el.getBoundingClientRect(),{top:box.top,left:box.left,bottom:box.bottom,right:box.right}},M.$.prototype.css=function(props,value){if(1===arguments.length){if("string"==typeof props)return window.getComputedStyle(this.$el,null).getPropertyValue(props);for(var prop in props)M.has(props,prop)&&(this.$el.style[prop]=props[prop])}else 2===arguments.length&&"string"==typeof props&&(this.$el.style[M.toCamelCase(props)]=value)},M.$.prototype.transition=function(property,duration,curve){1===arguments.length&&(this.$el.style[M.prefix("transition")]=property),"string"!=typeof duration&&(duration+="ms"),this.$el.style[M.prefix("transition")]=property+" "+duration+(curve?" "+curve:"")},M.$.prototype.transform=function(transform){this.$el.style[M.prefix("transform")]=transform||""},M.$.prototype.translateX=function(x){x=Math.round(+x||0),this.$el.style[M.prefix("transform")]="translate("+x+"px,0)"},M.$.prototype.translateY=function(y){y=Math.round(+y||0),this.$el.style[M.prefix("transform")]="translate(0px,"+y+"px)"},M.$.prototype.hide=function(){this.css("display","none"),this.css("visibility","hidden")},M.$.prototype.show=function(){this.css("display","block"),this.css("visibility","visible")},M.$.prototype.manipulate=function(fn){var next=this.$el.nextSibling,parent=this.$el.parentNode,frag=document.createDocumentFragment(),returned=fn.call(frag.appendChild(element))||element;next?parent.insertBefore(returned,next):parent.appendChild(returned)},M.$.prototype.is=function(selector){for(var compareWith=document.querySelectorAll(selector),i=0,l=compareWith.length;l>i;++i)if(compareWith[i]===this.$el)return!0;return!1},M.$.prototype.index=function(){for(var i=0,child=this.$el;null!==(child=child.previousSibling);)i++;return i},M.$.prototype.append=function(newChild){var _this=this;if("string"==typeof newChild){var newChildren=$$N(newChild);newChildren.each(function(child){_this.$el.appendChild(child.$el)})}else this.$el.appendChild(newChild.$el)},M.$.prototype.prepend=function(newChild){if("string"==typeof newChild)for(var newChildren=$$N(newChild),j=newChildren.length-1;j>=0;j--)this.$el.insertBefore(newChildren[j],this.$el.childNodes[0]);else this.$el.insertBefore(newChild.$el,this.$el.childNodes[0])},M.$.prototype.insertBefore=function(newChild){var parent=this.parent(),_this=this;if("string"==typeof newChild)for(var newChildren=$$N(newChild),j=newChildren.length-1;j>=0;j--)parent.$el.insertBefore(newChildren[j].$el,_this.$el);else parent.$el.insertBefore(newChild.$el,_this.$el)},M.$.prototype.insertAfter=function(newChild){var _this=this,parent=_this.$el.parentNode;if("string"==typeof newChild){var newChildren=$$N(newChild);newChildren.each(function(){})}else{var next=_this.$el.nextSibling;next?parent.insertBefore(newChild.$el,next):parent.appendChild(newChild.$el)}},M.$.prototype.wrap=function(wrapper){"string"==typeof wrapper&&(wrapper=$(document.createElement(wrapper))),this.insertBefore(wrapper),this.remove(),wrapper.append(this)},M.$.prototype.moveTo=function(newParent,before){this.remove(),before?newParent.prepend(this):newParent.append(this)},M.$.prototype.next=function(){var next=this.$el.nextSibling;return next?$(next):!1},M.$.prototype.prev=function(){var prev=this.$el.previousSibling;return prev?$(prev):!1},M.$.prototype.find=function(selector){return $$(selector,this)},M.$.prototype.parent=function(){var parent=this.$el.parentNode;return parent?$(parent):!1},M.$.prototype.parents=function(selector){for(var parents=[],parent=this.parent();parent;)(!selector||parent.is(selector))&&parents.push(parent),parent=parent.parent();return parents},M.$.prototype.children=function(selector){var childNodes=this.$el.children;if(!childNodes){childNodes=[];var nodes=this.$el.childNodes;M.each(nodes,function(n){(!n.data||n.data.trim())&&childNodes.push(n)})}if("number"==typeof selector)return $(childNodes[selector]);for(var children=[],i=0,l=childNodes.length;l>i;++i)(!selector||$(childNodes[i]).is(selector))&&children.push($(childNodes[i]));return children},M.$.prototype.remove=function(){this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},M.$.prototype.delete=function(){this.remove(),this.$el=null},M.$.prototype.clear=function(){var _this=this;this.children().each(function($el){_this.$el.removeChild($el.$el)})},M.$.prototype.replace=function(newEl){this.insertAfter(newEl),this.remove()},M.$body=$(document.body),M.$html=$T("html"),M.$window=$(window),M.$doc=$(window.document.documentElement),M.$html.addClass(M.browser.isTouch?"is-touch":"not-touch"),M.$html.addClass(M.browser.isMobile?"is-mobile":"not-mobile")}(),function(){function easeIn(type,t,s){switch(type){case"quad":return t*t;case"cubic":return t*t*t;case"quart":return t*t*t*t;case"quint":return t*t*t*t*t;case"circ":return 1-Math.sqrt(1-t*t);case"sine":return 1-Math.cos(t*Math.PI/2);case"exp":return 0>=t?0:Math.pow(2,10*(t-1));case"back":return null==s&&(s=1.70158),t*t*((s+1)*t-s);case"elastic":return null==s&&(s=.3),-Math.pow(2,10*(t-1))*Math.sin((2*(t-1)/s-.5)*Math.PI);case"bounce":return 1/11>t?1/64-7.5625*(.5/11-t)*(.5/11-t):3/11>t?1/16-7.5625*(2/11-t)*(2/11-t):7/11>t?.25-7.5625*(5/11-t)*(5/11-t):1-7.5625*(1-t)*(1-t);default:return t}}M.animationFrame=function(){var rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return window.setTimeout(callback,20)};return function(fn){return rAF(fn)}}(),M.cancelAnimationFrame=function(){window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout;return function(id){return cancel(id)}}(),M.animate=function(callback,duration){function getFrame(){running&&(!duration||duration>=time)&&M.animationFrame(getFrame),time=+new Date-startTime,callback(duration?time/duration:time)}var startTime=+new Date,time=0,running=!0;return getFrame(),{cancel:function(){running=!1}}},M.$.prototype.getTransitions=function(){for(var s=window.getComputedStyle(this.$el),delay=s.getPropertyValue("transition-delay").split(","),duration=s.getPropertyValue("transition-duration").split(","),property=s.getPropertyValue("transition-property").split(","),timing=s.getPropertyValue("transition-timing-function").match(/[^\(\),]+(\([^\(\)]*\))?[^\(\),]*/g),result=[],i=0;i<property.length;++i)result.push({css:property[i].trim(),delay:M.cssTimeToNumber(delay[i]),duration:M.cssTimeToNumber(duration[i]),timing:timing[i]});return result},M.$.prototype.setTransitions=function(transitions){var css=[];M.each(transitions,function(options){css.push([options.css,(options.duration||1e3)+"ms",options.timing||"linear",(options.delay||0)+"ms"].join(" "))}),this.css("transition",css.join(", "))},M.$.prototype.animate=function(props,callback){var _this=this;M.isArray(props)||(props=[props]);var s=window.getComputedStyle(this.$el);M.each(props,function(options){"height"===options.css&&this.css("height",parseFloat(s.getPropertyValue("height"))),"width"===options.css&&this.css("width",parseFloat(s.getPropertyValue("width"))),null!=options.from&&_this.css(options.css,options.from)});var oldTransition=s.getPropertyValue(M.prefix("transition"));this.setTransitions(M.merge(this.getTransitions(),props)),M.redraw(),M.each(props,function(options){_this.css(options.css,options.to)}),this.transitionEnd(function(){_this.css(M.prefix("transition"),oldTransition),M.redraw(),callback&&callback.call(_this)})},M.$.prototype.getStrokeLength=function(){if(this.$el.getTotalLength)return this.$el.getTotalLength();var dim=this.$el.getBoundingClientRect();return 2*dim.height+2*dim.width},M.$.prototype.enter=function(effect,time,delay){if(this.css("visibility","visible"),time)if(effect||(effect="fade"),"fade"===effect)this.animate({css:"opacity",from:0,to:1,duration:time});else if("pop"===effect)this.css("opacity","1"),this.animate({css:M.prefix("transform"),from:"scale(0)",to:"scale(1)",delay:delay,duration:time,timing:"cubic-bezier(0.175, 0.885, 0.32, 1.275)"});else if("draw"===effect){var l=this.getStrokeLength();this.css("stroke-dasharray",l+" "+l),this.animate({css:"stroke-dashoffset",from:l,to:0,delay:delay,duration:time})
}},M.$.prototype.exit=function(effect,time,delay){var _this=this;if(!time)return void this.css("visibility","hidden");if(effect||(effect="fade"),"fade"===effect)this.animate({css:"opacity",from:1,to:0,duration:time},function(){_this.css("visibility","hidden")});else if("draw"===effect){var l=this.getStrokeLength();this.css("stroke-dasharray",l+" "+l),this.animate({css:"stroke-dashoffset",from:0,to:l,delay:delay,duration:time})}},M.$.prototype.fadeIn=function(time){this.show(),this.animate({css:"opacity",from:0,to:1,duration:time})},M.$.prototype.fadeOut=function(time){this.animate({css:"opacity",from:1,to:0,duration:time},function(){this.hide()})};var effects=["pulseDown","pulseUp","flash","bounceUp","bounceRight"];effects.each(function(name){M.$.prototype[name]=function(){var _this=this;_this.animationEnd(function(){_this.removeClass("effects-"+name)}),_this.addClass("effects-"+name)}}),M.easing=function(type,t,s){return 0===t?0:1===t?1:(type=type.split("-"),"in"===type[1]?easeIn(type[0],t,s):"out"===type[1]?1-easeIn(type[0],1-t,s):.5>=t?easeIn(type[0],2*t,s)/2:1-easeIn(type[0],2*(1-t),s)/2)}}(),function(){function makeClickEvent($el){if(!$el._events._click){$el._events._click=!0;var startX,startY,waitForEvent=!1,preventMouse=!1;$el.addEventListener("click",function(e){e.preventDefault()}),$el.addEventListener("mousedown",function(e){preventMouse||(waitForEvent=!0,startX=e.clientX,startY=e.clientY)}),$el.addEventListener("mouseup",function(e){if(preventMouse)return void(preventMouse=!1);if(waitForEvent){var endX=e.clientX,endY=e.clientY;Math.abs(endX-startX)<2&&Math.abs(endY-startY)<2&&$el.trigger("click",e)}waitForEvent=!1}),$el.addEventListener("touchstart",function(e){preventMouse=!0,1===e.touches.length&&(waitForEvent=!0,startX=e.changedTouches[0].clientX,startY=e.changedTouches[0].clientY)}),$el.addEventListener("touchend",function(e){if(waitForEvent&&1===e.changedTouches.length){var endX=e.changedTouches[0].clientX,endY=e.changedTouches[0].clientY;Math.abs(endX-startX)<5&&Math.abs(endY-startY)<5&&$el.trigger("click",e)}waitForEvent=!1}),$el.addEventListener("touchcancel",function(){waitForEvent=!1})}}function makePointerPositionEvents($el){if(!$el._events._pointer){$el._events._pointer=!0;var $parent=$el.$el.offsetParent,isInside=null;$parent.on("pointerEnd",function(){isInside=null}),$parent.on("pointerMove",function(e){var wasInside=isInside;isInside=checkInside($el,e),null!=wasInside&&isInside&&!wasInside&&$el.trigger("pointerEnter",e),!isInside&&wasInside&&$el.trigger("pointerLeave",e),isInside&&$el.trigger("pointerOver",e)})}}function makeScrollEvents($el){function start(){initialScroll=_this.$el.scrollTop,$el.trigger("scrollstart",{}),scrolling=!0}function move(){scrolling||start(),$el.trigger("scroll",{top:$el.$el.scrollTop,left:$el.$el.scrollLeft}),scrollTimeout&&window.clearTimeout(scrollTimeout),scrollTimeout=window.setTimeout(end,100)}function end(){$el.trigger("scrollend",{}),scrolling=!1}function touchEnd(){window.removeEventListener("touchmove",move),window.removeEventListener("touchend",touchEnd)}if(!$el._events._scroll){$el._events._scroll=!0;var scrollTimeout=null,scrolling=!1,initialScroll=0;$el.addEventListener("wheel mousewheel DOMMouseScroll",move),$el.fixOverflowScroll(),$el.on("touchstart",function(){start(),window.addEventListener("touchmove",move),window.addEventListener("touchend",touchEnd)})}}function createEvent($el,event,fn,useCapture){var custom=customEvents[name];return M.isString(custom)?void $el.on(custom,fn,useCapture):(custom?custom($el):$el.$el.addEventListener(event,fn,!!useCapture),void($el._events[event]?$el._events[event].has(fn)||$el._events[event].push(fn):$el._events[event]=[fn]))}function removeEvent($el,event,fn,useCapture){var custom=customEvents[name];return M.isString(custom)?void $el.off(custom,fn,useCapture):(custom||$el.$el.removeEventListener(event,fn,!!useCapture),void($el._events[event]&&($el._events[event]=$el._events[event].without(fn))))}M.events={},M.events.isSupported=function(event){event="on"+event;var $el=$N("div"),isSupported=event in $el.$el;return isSupported||($el.attr(event,"return;"),isSupported="function"==typeof $el.$el[event]),$el.delete(),isSupported},M.events.pointerOffset=function(event,parent){if(event.offsetX)return[event.offsetX,event.offsetY];parent=parent?parent.$el:event.target;var parentXY=parent.getBoundingClientRect(),eventX=event.touches?event.touches[0].clientX:event.clientX,eventY=event.touches?event.touches[0].clientY:event.clientY;return[eventX-parentXY.left,eventY-parentXY.top]},M.events.pointerPosition=function(e){return{x:e.touches?e.touches[0].clientX:e.clientX,y:e.touches?e.touches[0].clientY:e.clientY}},M.events.getWheelDelta=function(e){var delta=0;return e.wheelDelta&&(delta=e.wheelDelta/40),e.detail&&(delta=-e.detail/3.5),delta},M.events.stop=function(e){e.preventDefault(),e.stopPropagation()};var checkInside=function($el,event){var c=M.events.pointerPosition(event);return $el.$el===document.elementFromPoint(c.x,c.y)};M.$.prototype.fixOverflowScroll=function(){this._events.fixOverflowScroll||(this._events.fixOverflowScroll=!0,_this=this,this.addEventListener("touchstart",function(){var top=_this.$el.scrollTop,bottom=_this.$el.scrollHeight-_this.$el.offsetHeight;0>=top&&(_this.$el.scrollTop=1),top>=bottom&&(_this.$el.scrollTop=bottom-1)}))},M.$.prototype.scrollTo=function(pos,time,easing,force){var _this=this;0>pos&&(pos=0),null==time&&(time=1e3),easing||(easing="cubic");var startPosition=this.$el.scrollTop,distance=pos-startPosition,callback=function(t){var x=startPosition+distance*M.easing(easing,t);_this.$el.scrollTop=x,_this.trigger("scroll",{top:x})};_this.trigger("scrollstart",{});var animation=M.animate(callback,time);force||(this.on("scroll",function(){animation.cancel()}),this.on("touchstart",function(){animation.cancel()}))};var customEvents={pointerStart:"mousedown touchstart",pointerMove:"mousemove touchmove",pointerEnd:"mouseup touchend mousecancel touchcancel",animationEnd:"webkitAnimationEnd oAnimationEnd animationend",transitionEnd:"webkitTransitionEnd oTransitionEnd transitionend",change:"propertychange keyup input paste",scrollwheel:"DOMMouseScroll mousewheel",click:makeClickEvent,pointerEnter:makePointerPositionEvents,pointerLeave:makePointerPositionEvents,pointerOver:makePointerPositionEvents,scrollStart:makeScrollEvents,scroll:makeScrollEvents,scrollEnd:makeScrollEvents},shortcuts="click scroll change transitionEnd".split(" ");shortcuts.each(function(event){M.$.prototype[event]=function(callback){null==callback?this.trigger(event):this.on(event,callback)}}),M.$.prototype.on=function(type,fn,useCapture){var _this=this;arguments.length>1?type.words().each(function(event){createEvent(_this,event,fn,useCapture)}):M.each(type,function(callback,event){createEvent(_this,event,callback)})},M.$.prototype.one=function(events,fn,useCapture){function callback(){_this.off(events,callback,useCapture),fn(arguments)}var _this=this;this.on(events,callback,useCapture)},M.$.prototype.off=function(type,fn,useCapture){var _this=this;type.words().each(function(event){removeEvent(_this,event,fn,useCapture)})},M.$.prototype.trigger=function(name,args){if(this._events[event]){var _this=this;M.each(this._events[event],function(fn){fn.call(_this,args)})}},M.activeInput=function(){return document.activeElement===document.body?void 0:document.activeElement},M.keyboardEvent=function(keys,fn){keys instanceof Array||(keys=[keys]),document.addEventListener("keydown",function(e){for(var k=e.keyCode||e.which,i=0;i<keys.length;++i)k!==keys[i]||M.activeInput()||(e.preventDefault(),fn(e))})},M.keyboardMultiEvent=function(key1,key2,fn1,fn2){var key2down=!1;document.addEventListener("keydown",function(e){var k=e.keyCode||e.which;k===key2?key2down=!0:key2down&&k===key1&&!M.activeInput()?(e.preventDefault(),fn2(e)):k!==key1||M.activeInput()||(e.preventDefault(),fn1(e))}),document.addEventListener("keyup",function(e){var k=e.keyCode||e.which;k===key2&&(key2down=!1)})};var events=[[],[],[]],trigger=function(){var size=[window.innerWidth,window.innerHeight];events.each(function(queue){queue.each(function(fn){fn.call(null,size)})})};M.resize=function(fn,queue){fn?events[queue||0].push(fn):trigger()};var timeout=null;M.$window.on("resize",function(){clearTimeout(timeout),timeout=setTimeout(function(){trigger()},50)})}()}(),function(){M.audio={files:{},playing:null,load:function(src,id){return M.Audio.files[id]=new Audio(src),M.Audio.files[id].load(),M.Audio.files[id].addEventListener("timeupdate",function(){M.Audio.playing&&M.Audio.playing.update()}),M.Audio.files[id]}},M.audio.Chunk=M.Class.extend({init:function(file,times){M.isString(times)&&(times=times.split("|").toNumbers()),this.times=times,this.currentTime=times[0],this.duration=times[1]-times[0],this.player=M.Audio.files[file]||M.Audio.load(file,Math.floor(1e4*Math.random())),this.ended=!1},play:function(){var _this=this;return this.player.readyState<2?void $(this.player).one("canplay seeked",function(){_this.play()}):(M.Audio.playing&&M.Audio.playing.pause(),M.Audio.playing=this,this.ended=!1,this.player.currentTime=this.currentTime,this.player.play(),void this.trigger("play",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime}))},pause:function(){M.Audio.playing===this&&this.player.pause(),this.trigger("pause")},setTime:function(time){this.player.readyState&&(this.player.currentTime=time),this.trigger("timeupdate",{p:(time-this.times[0])/this.duration,t:time})},reset:function(){M.Audio.playing===this&&this.player.pause(),this.player.readyState&&(this.currentTime=this.times[0]),this.ended=!0,this.trigger("reset")},update:function(){return this.ended?void 0:(M.Audio.playing===this&&(this.currentTime=this.player.currentTime),this.currentTime>=this.times[1]?(this.ended=!0,this.pause(),void this.trigger("end")):void this.trigger("timeupdate",{p:(this.currentTime-this.times[0])/this.duration,t:this.currentTime}))}}),M.speechRecognition=function(){if(!M.browser.speechRecognition)return{start:function(){rec.start()},stop:function(){rec.stop()},addCommand:function(){},removeCommand:function(){},available:!1};var rec=new window.webkitSpeechRecognition;rec.continuous=!0,rec.language="en-US";var commands={},processCommand=function(name){name=name.toLowerCase().trim(),commands[name]&&commands[name]()};rec.onresult=function(event){for(var i=event.resultIndex;i<event.results.length;++i)console.debug("Voice Input: ",event.results[i][0].transcript),processCommand(event.results[i][0].transcript)};var addCommand=function(name,fn){name instanceof Array||(name=[name]);for(var i=0;i<name.length;++i)commands[name[i].toLowerCase()]=fn},removeCommand=function(name){name instanceof Array||(name=[name]);for(var i=0;i<name.length;++i)commands[name[i].toLowerCase()]=void 0};return{start:function(){rec.start()},stop:function(){rec.stop()},addCommand:addCommand,removeCommand:removeCommand,available:!0}},M.Bubble=function($popup,chapter){var _this=this,$bubble=$C("popup-bubble",$popup)[0];if($bubble){var $bubbleBox=$C("bubble-box",$bubble)[0];$N("span",{"class":"bubble-arrow"},$bubble),_this.open=function(){chapter.activePopup&&chapter.activePopup.close(),$bubble.css("display","block");var bounds=$bubble.$el.getBoundingClientRect(),top=bounds.top-bounds.height,left=bounds.left-bounds.width/2,right=bounds.right+bounds.width/2,pageLeft=chapter.$container.offset().left,pageRight=M.browser.width;pageLeft+10>left&&$bubbleBox.transformX(pageLeft+10-left),right>pageRight-54&&$bubbleBox.transformX(pageRight-54-right),M.redraw(),27>top&&chapter.scrollBy(top-27),$popup.addClass("on"),chapter.activePopup=_this},_this.close=function(){$popup.removeClass("on"),chapter.activePopup=null,setTimeout(function(){$bubble.css("display","none")},200)},_this.delete=function(){$popup.off("click",click)};var click=function(e){e.preventDefault(),e.stopPropagation(),$popup.hasClass("on")?_this.close():_this.open()};$bubble.click(function(e){e.stopPropagation()}),$popup.click(click)}},M.Gallery=function($panel,options){options||(options={});var $wrapper=$N("div",{"class":"gallery-wrapper"}),$box=$N("div",{"class":"gallery-box"});$panel.wrap($wrapper),$wrapper.wrap($box);var width,slidesPerPage,slideWidth,$slides=$panel.children(),slidesCount=$slides.length,staticSlideWidth=$panel.attr("data-slide-width")||null,activeIndex=0,transformX=0,$next=$N("div",{"class":"gallery-next"},$box),$back=$N("div",{"class":"gallery-back"},$box);$N("div",{"class":"icon"},$next),$N("div",{"class":"icon"},$back);var $dotsBox=$N("div",{"class":"gallery-dots"},$box),$dots=[];$slides.each(function($s){$s.addClass("gallery-slide"),$dots.push($N("div",{"class":"gallery-dot"},$dotsBox))});var animT,animStart,animDistance,animStartTime,setPosition=function(offset){transformX=offset,$panel.transformX(offset)},makeActive=function(newIndex){activeIndex=newIndex,$dots.each(function($d,i){$d.setClass("on",i>=newIndex&&newIndex+slidesPerPage>i)}),options.callback&&options.callback(newIndex),$next.setClass("disabled",newIndex===slidesCount-slidesPerPage),$back.setClass("disabled",0===newIndex)},resize=function(){width=$wrapper.width("border"),slidesPerPage=staticSlideWidth?Math.ceil(width/staticSlideWidth):1,slideWidth=width/slidesPerPage,$slides.each(function($slide){$slide.css("width",slideWidth+"px")}),$panel.css("width",slidesCount*slideWidth+"px"),setPosition(-activeIndex*slideWidth),makeActive(activeIndex)},animTiming="quad",animDuration=500,animCancel=!1,animSetPosition=function(){animT=M.now()-animStartTime,setPosition(animStart+animDistance*M.easing(animTiming,animT/animDuration))},animRender=function(){!animCancel&&animDuration>animT&&M.animationFrame(animRender),animSetPosition()},startAnimationTo=function(newIndex){animCancel=!1,animT=0,animStart=transformX,animDistance=-newIndex*slideWidth-transformX,animStartTime=M.now(),makeActive(newIndex),animRender()},next=function(){animTiming="quad",slidesCount-slidesPerPage>activeIndex&&($next.pulse(),startAnimationTo(activeIndex+1))},back=function(){animTiming="quad",activeIndex>0&&($back.pulse(),startAnimationTo(activeIndex-1))};$next.click(next),$back.click(back);var motionStartPosn=null,pointerStart=null,previousMotionX=null,lastMotionX=null,motionStart=function(){M.$body.on("mousemove touchmove",motionMove),M.$body.on("mouseup mouseleave touchend touchcancel",motionEnd),animCancel=!0,motionStartPosn=transformX,pointerStart=event.touches?event.touches[0].clientX:event.clientX,lastMotionX=previousMotionX=pointerStart},motionMove=function(e){e.preventDefault();var x=event.touches?event.touches[0].clientX:event.clientX;previousMotionX=lastMotionX,lastMotionX=x;var newPosition=motionStartPosn-pointerStart+x,maxScroll=-(slidesCount-slidesPerPage)*slideWidth;setPosition(newPosition>0?newPosition/4:maxScroll>newPosition?maxScroll+(newPosition-maxScroll)/4:newPosition)},motionEnd=function(){M.$body.off("mousemove touchmove",motionMove),M.$body.off("mouseup mouseleave touchend touchcancel",motionEnd),x=event.touches?event.touches[0].clientX:event.clientX;var lastDiff=lastMotionX-previousMotionX,shift=lastDiff>12?1:-12>lastDiff?-1:0;animTiming="quad-out",startAnimationTo(Math.round(-transformX/slideWidth-shift).bound(0,slidesCount-slidesPerPage))};return $wrapper.on("mousedown touchstart",motionStart),resize(),M.resize(resize),{next:next,back:back}},M.Lightbox=function($container,chapter){function add($img){var src=$img.attr("src"),$wrap=$N("div",{"class":"lightbox"});$img.wrap($wrap),$N("div",{"class":"lightbox-zoom"},$wrap),$wrap.click(function(){open($wrap,src)})}function open($img,src){activeImg=$img,$lightbox.css("display","block");var newX=$img.$el.getBoundingClientRect(),oldX=$lightboxImg.$el.getBoundingClientRect(),X=newX.left+newX.width/2-oldX.left-oldX.width/2,Y=newX.top+newX.height/2-oldX.top-oldX.height/2,S=Math.max(newX.width/oldX.width,newX.height/oldX.height);transform={X:X,Y:Y,S:S},$lightboxImg.css("background-image","url("+src.replace(/\.(?=[^.]*$)/,"-large.")+"), url("+src+")"),$lightboxImg.transform("translate("+X+"px,"+Y+"px) scale("+S+")"),M.redraw(),$lightboxImg.addClass("transitions"),M.redraw(),$img.css("visibility","hidden"),chapter.$toolbar.addClass("off"),$lightbox.addClass("on"),$lightboxImg.transform("scale(1) translate(0,0)")}function close(){$lightbox.removeClass("on"),$lightboxImg.transform("translate("+transform.X+"px,"+transform.Y+"px) scale("+transform.S+")"),chapter.$toolbar.removeClass("off"),setTimeout(function(){activeImg.css("visibility","visible"),$lightbox.css("display","none"),$lightboxImg.transform("none"),$lightboxImg.transform("none"),$lightboxImg.removeClass("transitions")},400)}var activeImg,$lightbox=$N("div",{"class":"lightbox-overlay"},$container),$lightboxImg=$N("div",{"class":"lightbox-img"},$lightbox),transform=($N("div",{"class":"lightbox-caption"},$lightbox),{});return $lightbox.click(function(){close()}),{add:add,open:open,close:close}},function(){M.scrollReveal=function($els,$parent){function getHeight(){viewportHeight=isWindow?window.innerHeight:parentEl.clientHeight}function getScroll(){viewportScroll=isWindow?window.pageYOffset:parentEl.scrollTop}function isInViewport($el,factor){var elTop=$el.$el.offsetTop,elHeight=$el.$el.offsetHeight;return elTop+elHeight>=viewportScroll+factor*viewportHeight&&viewportScroll+(1-factor)*viewportHeight>=elTop}function makeElement($el){function show(){isShown=!0,$el.css("opacity","1"),$el.transform("translate"+axis+"(0)")}function hide(){isShown=!1,$el.css("opacity","0"),$el.transform("translate"+axis+"("+direction+distance+")")}var isShown=!1,options=($el.attr("data-scroll")||"").split("|"),axis=M.isOneOf(options[0],"left","right")?"X":"Y",direction=M.isOneOf(options[0],"top","left")?"-":"",distance=options[1]||"24px",duration=options[2]||".5s",delay=options[3]||"0s",factor=M.isNaN(+options[4])?.25:+options[4];return hide(),M.redraw(),$el.transition(["opacity",duration,delay,",",M.prefix("transform"),duration,delay].join(" ")),function(){!isShown&&isInViewport($el,factor)&&show(),isShown&&!isInViewport($el,0)&&hide()}}function updatePage(){getScroll();for(var i=0;n>i;++i)updateFns[i]()}var isWindow=!$parent,parentEl=isWindow?window.document.documentElement:$parent.$el;isWindow&&($parent=M.$window);var viewportHeight;M.resize(getHeight),getHeight();var viewportScroll,updateFns=$els.each(function($el){return makeElement($el)}),n=updateFns.length;$parent.scroll(updatePage),M.resize(updatePage),updatePage()}}(),M.Draggable=M.Class.extend({init:function($el,$parent,direction,margin){var width,height,_this=this,moveX="y"!==direction,moveY="x"!==direction,position=[0,0],dragStart=[null,null],getPosn=function(e){return[event.touches?e.touches[0].clientX:e.clientX,event.touches?e.touches[0].clientY:e.clientY]},draw=function(x,y){moveX&&$el.css("left",Math.round(x)+"px"),moveY&&$el.css("top",Math.round(y)+"px"),_this.trigger("change",{x:x,y:y,width:width,height:height})};this.set=function(x,y){draw(x,y),position=[x,y]},this.get=function(){return{x:position[0],y:position[1],width:width,height:height}};var motionStart=function(e){M.$body.on("mousemove touchmove",motionMove),M.$body.on("mouseup mouseleave touchend touchcancel",motionEnd),dragStart=getPosn(e),_this.trigger("start")},motionMove=function(e){e.preventDefault();var newPosition=getPosn(e),x=(position[0]+newPosition[0]-dragStart[0]).bound(0,width),y=(position[1]+newPosition[1]-dragStart[1]).bound(0,height);draw(x,y)},motionEnd=function(e){M.$body.off("mousemove touchmove",motionMove),M.$body.off("mouseup mouseleave touchend touchcancel",motionEnd);var newPosition=getPosn(e);if(newPosition[0]===dragStart[0]&&newPosition[1]===dragStart[1])_this.trigger("click");else{var x=(position[0]+newPosition[0]-dragStart[0]).bound(0,width),y=(position[1]+newPosition[1]-dragStart[1]).bound(0,height);position=[x,y],_this.trigger("end")}};$el.on("mousedown touchstart",motionStart);var resize=function(){var oldWidth=width,oldHeight=height;width=$parent.width("border")-2*margin,height=$parent.height("border")-2*margin,_this.set(width/(oldWidth||width)*position[0],height/(oldHeight||height)*position[1])};resize(),M.resize(resize)}}),M.Slider=M.Class.extend({init:function($track,steps){var _this=this;$track.addClass("slider-track");var $knob=$N("div",{"class":"slider-knob"},$track);$N("div",{"class":"icon"},$knob);var active,slider=new M.Draggable($knob,$track,"x",4);slider.on("start",function(){cancelPlay=!0}),slider.on("change",function(e){var n=Math.floor(e.x/e.width*steps);n!==active&&_this.trigger("move",n),active=n});var cancelPlay=!1;slider.on("click",function(){_this.play()});var animRender=function(){var dim=slider.get();!cancelPlay&&dim.x<dim.width&&M.animationFrame(animRender),slider.set(dim.x+2)};this.play=function(){cancelPlay=!1,$knob.pulse(),animRender()},slider.set(0,0)}}),M.ImageSequence=M.Class.extend({init:function($el){var $wrap=$N("div");$el.wrap($wrap);for(var url=$el.attr("data-src"),pages=Number($el.attr("data-pages"))-1,$track=$N("div",{},$wrap),slider=new M.Slider($track,pages),images=[],i=1;pages>i;++i)images[i]=new Image,images[i].src=url.replace("#",i);slider.on("move",function(n){$el.attr("src",url.replace("#",n))}),slider.trigger("move",0)}}),M.makeVariable=function($i,section){var vars=section.varValues,fn=new Function("_vars","with(_vars){ return "+$i.html()+"; }"),v={$el:$i,fn:fn},callbackAttr=$i.attr("data-fn"),callback=callbackAttr?new Function("_vars","with(_vars){ "+callbackAttr+" }"):null;if(section.varEvals.push(v),$i.attr("data-var")){$i.addClass("var");var t=$i.attr("data-var").split("|"),name=t[0],init=t[1],type=t[2],info=t[3]?t[3].split(","):[];if($i.html(""),"slider"===type){vars[name]=Number(init),$i.addClass("var-slider"),info[0]=Number(info[0]),info[1]=Number(info[1]),info[2]=Number(info[2]),v.$el=$N("span",{"class":"var-slider-text"},$i),$N("span",{"class":"left"},$i),$N("span",{"class":"right"},$i);var $bubble=$N("span",{"class":"var-slider-bubble"},$i),$box=$N("span",{"class":"var-slider-bubble-box "},$bubble),$progress=$N("span",{"class":"var-slider-progress"},$box);$N("span",{"class":"var-slider-bubble-arrow"},$bubble),$progress.css("width",116*(vars[name]-info[0])/(info[1]-info[0])+"px");var startPosition=0,startValue=0,distance=0,sense=Math.sqrt(info[2]/(info[1]-info[0])*1e3)+(M.browser.isTouch?10:2),slideStart=function(event){event.stopPropagation(),event.preventDefault(),startPosition=event.pageX||event.originalEvent.touches[0].pageX,startValue=vars[name],$bubble.css("display","block"),M.redraw(),$bubble.addClass("on"),M.$body.on("touchmove mousemove",slideMove),M.$body.on("touchend touchcancel mouseup",slideEnd)},slideMove=function(event){event.stopPropagation(),event.preventDefault(),distance=(event.pageX||event.originalEvent.touches[0].pageX)-startPosition;var old=vars[name];vars[name]=Math.round(Math.max(info[0],Math.min(info[1],startValue+distance/sense))/info[2])*info[2],$progress.css("width",116*(vars[name]-info[0])/(info[1]-info[0])+"px"),old!==vars[name]&&(section.evalVariables(),callback&&callback(section.varValues))},slideEnd=function(){$bubble.removeClass("on"),setTimeout(function(){$bubble.css("display","none")},200),M.$body.off("touchmove mousemove",slideMove),M.$body.off("touchend touchcancel mouseup",slideEnd)};$i.on("touchstart mousedown",slideStart)}else if("bolean"===type)vars[name]=!!Number(init),$i.click(function(){vars[name]=!!vars[name],section.evalVariables(),callback&&callback(section.varValues)});else if("switch"===type){vars[name]=init;var activeSwitch=0,maxSwitch=info.length-1;$i.click(function(){maxSwitch>activeSwitch?++activeSwitch:activeSwitch=0,vars[name]=info[activeSwitch],section.evalVariables(),callback&&callback(section.varValues)})}return callback||null}},M.svg={},M.svg.el=function(type,attributes,parent){var _this=this,svgns="http://www.w3.org/2000/svg";this.$el=document.createElementNS(svgns,type),this.data={},M.each(attributes,function(val,key){_this.$el.setAttribute(key,val)}),parent&&parent.append(this)},M.inherit(M.svg.el,M.$),M.svg.el.prototype.setPoints=function(p){this.attr("d",p.length?"M"+p.each(function(x){return x.join(",")}).join("L"):""),this.points=p},M.svg.el.prototype.addPoint=function(p){this.attr("d",this.attr("d")+" L "+p.join(",")),this.points.push(p)},M.svg.el.prototype.getPoints=function(){var points=this.$el.attr("d").replace("M","").split("L");return points.each(function(x){return x.split(",").toNumbers()})},M.piechart=function(percentage,radius,colour){var str;if(percentage>=1)str=['<svg width="',2*radius,'" height="',2*radius,'">','<path fill="',colour,'" stroke="none" d="M',radius,",0C",.5*radius,",0,0,",.5*radius,",0,",radius,"s",.5*radius,",",radius,",",radius,",",radius,"s",radius,"-",.5*radius,",",radius,"-",radius,"S",1.5*radius,",0,",radius,",0","z M",44.6*radius/50,",",76.1*radius/50,"L",19.2*radius/50,",",48.8*radius/50,"l",4*radius/50,"-",4.2*radius/50,"l",19.8*radius/50,",",11.9*radius/50,"l",34.2*radius/50,"-",32.6*radius/50,"l",3.5*radius/50,",",3.5*radius/50,"L",44.6*radius/50,",",76.1*radius/50,'z"/>',"</svg>"].join("");else{var x=radius+radius*Math.sin(2*percentage*Math.PI),y=radius-radius*Math.cos(2*percentage*Math.PI);str=['<svg width="',2*radius,'" height="',2*radius,'">','<circle cx="',radius,'" cy="',radius,'" r="',radius-.5,'" stroke="',colour,'" stroke-width="1" fill="transparent"/>','<path d="M ',radius," ",radius," L ",radius," 0 A ",radius," ",radius," 0 "+(percentage>.5?"1":"0")+" 1 "+x+" "+y+' Z" fill="',colour,'"/>',"</svg>"].join("")}return str},M.draw=function($svg,options){var _this=this;$svg.addClass("m-draw-pointer"),_this.options=options,_this.drawing=!1,_this.paths=[],_this.p=null;var activePath=null;_this.start=function(p){_this.p&&FM.geo.distance(_this.p,p)<20?activePath.addPoint(p):(options.onStart&&options.onStart(p),activePath=new M.svg.el("path",{"class":"m-draw-path",d:"M "+p.join(",")},options.paths||$svg),activePath.points=[p],_this.paths.push(activePath)),_this.drawing=!0,_this.p=p},_this.addPoint=function(p){FM.geo.manhatten(_this.p,p)>4&&(activePath.addPoint(p),_this.p=p,options.onIntersect&&_this.checkForIntersects())},options.noStart||$svg.on("mousedown touchstart",function(e){e.preventDefault(),e.stopPropagation();var p=M.events.pointerOffset(event,$svg);_this.start(p)}),$svg.on("mousemove touchmove",function(e){if(_this.drawing){e.preventDefault(),e.stopPropagation();var p=M.events.pointerOffset(event,$svg);_this.addPoint(p)}}),$svg.on("mouseup touchend mouseleave touchleave",function(){_this.drawing=!1})},M.draw.prototype.checkForIntersects=function(){if(!(this.paths.length<=1))for(var path=this.paths.last(),a1=path.points[path.points.length-2],a2=path.points[path.points.length-1],i=0;i<this.paths.length-1;++i)for(var l=this.paths[i].points.length,j=1;l-2>j;++j){var t=FM.geo.intersect(a1,a2,this.paths[i].points[j],this.paths[i].points[j+1]);if(t)return void this.options.onIntersect(t,path,this.paths[i])}},M.draw.prototype.stop=function(){this.drawing=!1,this.p=null},M.draw.prototype.clear=function(){this.paths.each(function(path){path.remove()}),this.paths=[]}}();